<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPS 5-15 Intermediate Category Mock Test 4</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.promise.then(() => {
                        console.log('MathJax 3 is loaded and ready.');
                    });
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

    <style>
        :root {
            --primary-color: #5A67D8;
            --primary-dark: #434190;
            --secondary-color: #48BB78;
            --secondary-dark: #38A169;
            --accent-color: #F6AD55;
            --accent-dark: #ED8936;
            --warning-color: #ECC94B;
            --danger-color: #F56565;
            --text-color: #2D3748;
            --light-text-color: #718096;
            --bg-color: #F7FAFC;
            --card-bg: #FFFFFF;
            --border-color: #E2E8F0;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --border-radius: 16px;
            --input-bg: #FFFFFF;
            --hover-bg-light: rgba(0, 0, 0, 0.05);
            --calc-bg: #2D3748;
            --calc-border: #1A202C;
            --calc-btn-bg: #4A5568;
            --calc-btn-hover: #606F82;
            --calc-btn-operator-bg: var(--accent-color);
            --calc-btn-operator-hover: var(--accent-dark);
            --calc-btn-clear-bg: #2C5282;
            --calc-btn-clear-hover: #2B6CB0;
            --calc-display-bg: #1A202C;
            --calc-display-text: white;
            --scratchpad-bg: #FFFFFF;
            --scratchpad-border: #E2E8F0;
        }

        body.dark-mode {
            --primary-color: #7F9CF5;
            --primary-dark: #667EEA;
            --secondary-color: #68D391;
            --secondary-dark: #48BB78;
            --accent-color: #FBD38D;
            --accent-dark: #F6AD55;
            --warning-color: #F6E05E;
            --danger-color: #FC8181;
            --text-color: #E2E8F0;
            --light-text-color: #A0AEC0;
            --bg-color: #1A202C;
            --card-bg: #2D3748;
            --border-color: #4A5568;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            --input-bg: #4A5568;
            --hover-bg-light: rgba(255, 255, 255, 0.1);
            --calc-bg: #2D3748;
            --calc-border: #1A202C;
            --calc-btn-bg: #4A5568;
            --calc-btn-hover: #606F82;
            --calc-btn-operator-bg: var(--accent-color);
            --calc-btn-operator-hover: var(--accent-dark);
            --calc-btn-clear-bg: #2C5282;
            --calc-btn-clear-hover: #2B6CB0;
            --calc-display-bg: #1A202C;
            --calc-display-text: white;
            --scratchpad-bg: #2D3748;
            --scratchpad-border: #4A5568;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-color); display: flex; flex-direction: column; min-height: 100vh; transition: background-color 0.4s ease, color 0.4s ease; overflow-x: hidden; font-size: 16px; }

        .page-header { width: 100%; background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-dark) 100%); color: white; padding: 20px 40px; text-align: center; font-weight: 700; font-size: 1.4em; box-shadow: var(--shadow); flex-shrink: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; border-bottom: 1px solid rgba(255,255,255,0.2); }
        .page-header h1 { font-size: 1.4em; margin: 0; flex-grow: 1; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .mode-toggle { cursor: pointer; font-size: 1.7em; color: white; padding: 10px; border-radius: 50%; transition: background-color 0.3s, transform 0.3s; display: flex; align-items: center; justify-content: center; }
        .mode-toggle:hover { background-color: rgba(255, 255, 255, 0.25); transform: scale(1.1); }
        .page-footer { font-size: 0.9em; padding: 15px 20px; margin-top: auto; background-color: var(--primary-dark); color: white; box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.15); text-align: center; }
        .page-footer a { color: inherit; text-decoration: none; font-weight: 500; }
        .page-footer a:hover { text-decoration: underline; }

        .container { width: 100%; max-width: 1100px; background-color: var(--card-bg); border-radius: var(--border-radius); box-shadow: var(--shadow); overflow: hidden; margin: 30px auto; flex-grow: 1; display: flex; flex-direction: column; border: 1px solid var(--border-color); }
        .screen { padding: 50px; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .screen h2 { margin-bottom: 30px; font-size: 2.5em; color: var(--primary-color); font-weight: 800; text-shadow: 1px 1px 3px rgba(0,0,0,0.05); }
        .screen p { font-size: 1.15em; color: var(--light-text-color); margin-bottom: 35px; line-height: 1.7; max-width: 700px; }

        #password-screen .input-group { position: relative; margin-bottom: 30px; width: 90%; max-width: 450px; }
        #password-input { width: 100%; padding: 16px 50px 16px 25px; border: 2px solid var(--border-color); border-radius: 12px; font-size: 1.1em; background-color: var(--input-bg); color: var(--text-color); transition: border-color 0.3s, background-color 0.3s, box-shadow 0.3s; }
        #password-input:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 5px rgba(90, 103, 216, 0.3); }
        .toggle-password { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--light-text-color); font-size: 1.2em; transition: color 0.2s; }
        .toggle-password:hover { color: var(--text-color); }
        .password-notice { font-size: 0.95em; color: var(--text-color); margin-top: -15px; margin-bottom: 25px; line-height: 1.5; max-width: 450px; text-align: center; }
        .password-notice a { color: var(--primary-color); font-weight: 600; text-decoration: none; }
        .password-notice a:hover { text-decoration: underline; }

        #instructions-screen { text-align: left; }
        #instructions-screen ul { list-style: none; margin-left: 0; padding-left: 0; margin-bottom: 40px; color: var(--text-color); max-width: 800px; }
        #instructions-screen ul li { display: flex; align-items: flex-start; margin-bottom: 15px; font-size: 1.1em; line-height: 1.6; }
        #instructions-screen ul li::before { content: '\f058'; font-family: 'Font Awesome 5 Free'; font-weight: 900; margin-right: 10px; color: var(--secondary-color); font-size: 1.2em; flex-shrink: 0; display: inline-flex; justify-content: center; align-items: center; padding-right: 5px; box-sizing: content-box; }
        #instructions-screen ul li span { flex-grow: 1; }
        #instructions-screen .btn { margin-top: 20px; }

        #test-screen { padding: 0; display: flex; flex-direction: column; flex-grow: 1; }
        .test-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; background-color: var(--bg-color); border-bottom: 1px solid var(--border-color); flex-wrap: wrap; gap: 20px; }
        #question-counter, #timer { font-weight: 700; font-size: 1.2em; background: linear-gradient(45deg, var(--primary-color), var(--primary-dark)); color: white; padding: 12px 22px; border-radius: 30px; min-width: 160px; text-align: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); transition: background-color 0.3s; }
        #timer.time-low { background: linear-gradient(45deg, var(--danger-color), #D64545); }
        .progress-container { width: 100%; background-color: var(--border-color); height: 12px; border-radius: 6px; margin-top: 15px; overflow: hidden; box-shadow: inset 0 2px 5px rgba(0,0,0,0.08); }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--secondary-color), var(--secondary-dark)); border-radius: 6px; transition: width 0.5s ease-out; }

        .test-body { padding: 40px; flex-grow: 1; display: flex; flex-direction: column; }
        #question-container { font-size: 1.5em; margin-bottom: 35px; line-height: 1.7; font-weight: 600; color: var(--text-color); }
        .reading-passage { background-color: var(--bg-color); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 25px; margin-bottom: 30px; box-shadow: inset 0 2px 8px rgba(0,0,0,0.05); }
        .reading-passage h3 { color: var(--primary-color); font-size: 1.3em; margin-bottom: 15px; font-weight: 700; }
        .reading-passage p { font-size: 1em; line-height: 1.8; color: var(--light-text-color); margin-bottom: 0; }
        .options-container { display: flex; flex-direction: column; gap: 18px; }
        .option { padding: 18px 25px; border: 2px solid var(--border-color); border-radius: 12px; cursor: pointer; transition: background-color 0.2s, border-color 0.2s, transform 0.1s, box-shadow 0.2s; font-size: 1.15em; text-align: left; background-color: var(--card-bg); color: var(--text-color); display: flex; align-items: center; gap: 15px; }
        .option::before { content: ''; display: inline-block; width: 20px; height: 20px; border: 2px solid var(--light-text-color); border-radius: 50%; background-color: var(--card-bg); transition: all 0.2s; flex-shrink: 0; }
        .option:hover { background-color: var(--hover-bg-light); border-color: var(--primary-color); transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        .option.selected { background-color: var(--primary-color); color: white; border-color: var(--primary-color); box-shadow: 0 6px 15px rgba(0,0,0,0.2); }
        /* UPDATED: Filled radio button effect */
        .option.selected::before { background-color: white; border-color: white; box-shadow: inset 0 0 0 4px var(--primary-color); }
        body.dark-mode .option.selected { color: var(--card-bg); }
        body.dark-mode .option.selected::before { box-shadow: inset 0 0 0 4px var(--primary-color); }

        .test-footer { display: flex; justify-content: space-between; align-items: center; padding: 30px 40px; border-top: 1px solid var(--border-color); flex-wrap: wrap; gap: 25px; background-color: var(--bg-color); }
        .test-footer .left-controls, .test-footer .right-controls { display: flex; gap: 20px; flex-wrap: wrap; }
        .btn-flag { background-color: var(--card-bg); color: var(--primary-color); border: 2px solid var(--primary-color); padding: 12px 20px; font-size: 1em; box-shadow: none; transition: background-color 0.2s, color 0.2s, transform 0.2s, box-shadow 0.2s; }
        .btn-flag:hover { background-color: var(--primary-color); color: white; transform: translateY(-3px); box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .btn-flag.flagged { background-color: var(--warning-color); color: var(--text-color); border-color: var(--warning-color); box-shadow: 0 2px 8px rgba(255,193,7,0.4); }
        body.dark-mode .btn-flag.flagged { color: #333; }
        .btn-submit { background: linear-gradient(45deg, var(--secondary-color), var(--secondary-dark)); color: white; border: none; padding: 16px 40px; border-radius: var(--border-radius); cursor: pointer; font-size: 1.1em; font-weight: 600; transition: all 0.3s ease-in-out; display: inline-flex; align-items: center; justify-content: center; gap: 12px; box-shadow: 0 6px 15px rgba(0,0,0,0.2); }
        .btn-submit:hover { background: linear-gradient(45deg, var(--secondary-dark), #38A169); transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.3); }
        .btn-submit:active { transform: translateY(0); box-shadow: none; }

        #question-palette { display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 15px; padding: 30px 40px; border-top: 1px solid var(--border-color); background-color: var(--bg-color); scrollbar-width: thin; scrollbar-color: var(--primary-color) transparent; }
        #question-palette::-webkit-scrollbar { height: 8px; }
        #question-palette::-webkit-scrollbar-thumb { background-color: var(--primary-color); border-radius: 4px; }
        #question-palette::-webkit-scrollbar-track { background-color: var(--border-color); }
        .palette-btn { width: 55px; height: 55px; flex-shrink: 0; display: flex; justify-content: center; align-items: center; border-radius: 12px; background-color: var(--card-bg); border: 2px solid var(--border-color); cursor: pointer; font-weight: 600; transition: background-color 0.2s, border-color 0.2s, transform 0.1s, box-shadow 0.2s; color: var(--text-color); font-size: 1.1em; box-shadow: 0 3px 8px rgba(0,0,0,0.08); }
        .palette-btn:hover { background-color: var(--hover-bg-light); transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        .palette-btn.current { background: linear-gradient(45deg, var(--primary-color), var(--primary-dark)); color: white; border-color: var(--primary-color); box-shadow: 0 5px 15px rgba(0,0,0,0.3); transform: scale(1.08); }
        .palette-btn.answered { background-color: var(--secondary-color); color: white; border-color: var(--secondary-color); }
        .palette-btn.not-answered { background-color: var(--warning-color); color: var(--text-color); border-color: var(--warning-color); }
        body.dark-mode .palette-btn.not-answered { color: #333; }
        .palette-btn.flagged { position: relative; box-shadow: 0 0 0 4px var(--danger-color); }
        .palette-btn.flagged::after { content: '\f024'; font-family: 'Font Awesome 5 Free'; font-weight: 900; position: absolute; top: 4px; right: 4px; font-size: 0.8em; color: var(--danger-color); background-color: var(--card-bg); border-radius: 50%; padding: 3px; line-height: 1; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        body.dark-mode .palette-btn.flagged::after { background-color: var(--card-bg); }

        #result-screen { padding: 50px; text-align: center; }
        #result-summary { margin-bottom: 50px; padding: 40px; border-radius: var(--border-radius); background-color: var(--bg-color); box-shadow: inset 0 0 20px rgba(0,0,0,0.08); border: 1px solid var(--border-color); width: 100%; }
        #result-summary h2 { margin-top: 0; color: var(--primary-color); }
        .score-circle { width: 200px; height: 200px; border-radius: 50%; background: linear-gradient(45deg, var(--secondary-color), var(--secondary-dark)); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; margin: auto; margin-bottom: 30px; font-weight: 700; box-shadow: var(--shadow); }
        .score-circle span:first-child { font-size: 4.5em; font-weight: 800; line-height: 1; }
        .score-circle span:last-child { font-size: 1.3em; margin-top: 5px; }
        .score-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; margin-top: 40px; }
        .score-details div { padding: 20px; background-color: var(--card-bg); border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 1px solid var(--border-color); }
        .score-details p { margin: 0; font-size: 1.1em; }
        .score-details p:first-child { color: var(--light-text-color); font-weight: 500; margin-bottom: 8px; }
        .score-details p:last-child { font-weight: 700; font-size: 1.3em; color: var(--primary-color); }
        .score-details div:nth-child(4) p:last-child { color: var(--secondary-color); }
        .score-details div:nth-child(5) p:last-child { color: var(--danger-color); }

        .result-question { margin-bottom: 30px; padding: 25px; border-radius: var(--border-radius); border: 1px solid var(--border-color); text-align: left; background-color: var(--card-bg); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .result-question p { font-weight: 600; margin-bottom: 15px; font-size: 1.2em; line-height: 1.6; color: var(--text-color); }
        .result-option { margin-bottom: 10px; font-size: 1.05em; color: var(--light-text-color); display: flex; align-items: center; gap: 10px; }
        .result-option::before { content: ''; display: inline-block; width: 20px; height: 20px; border-radius: 50%; background-color: var(--light-text-color); flex-shrink: 0; text-align: center; line-height: 20px; font-size: 1.1em; }
        .result-option.correct { color: var(--secondary-color); font-weight: 700; }
        .result-option.correct::before { content: '\f058'; font-family: 'Font Awesome 5 Free'; font-weight: 900; background: none; color: var(--secondary-color); }
        .result-option.incorrect.user-answer { color: var(--danger-color); font-weight: 700; }
        .result-option.incorrect.user-answer::before { content: '\f057'; font-family: 'Font Awesome 5 Free'; font-weight: 900; background: none; color: var(--danger-color); }
        .result-option.user-answer.correct::before { content: '\f058'; font-family: 'Font Awesome 5 Free'; font-weight: 900; background: none; color: var(--secondary-color); }
        .not-attempted-text { color: var(--light-text-color); font-style: italic; margin-left: 30px; margin-top: 15px; font-size: 0.95em; }

        .btn { padding: 16px 40px; border: none; border-radius: 12px; cursor: pointer; font-size: 1.05em; font-weight: 600; transition: all 0.3s ease-in-out; display: inline-flex; align-items: center; justify-content: center; gap: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.15); }
        .btn:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.25); }
        .btn:active { transform: translateY(0); box-shadow: none; }
        .btn-primary { background: linear-gradient(45deg, var(--primary-color), var(--primary-dark)); color: white; }
        .btn-primary:hover { background: linear-gradient(45deg, var(--primary-dark), #434190); }
        .btn-secondary { background-color: var(--light-text-color); color: white; }
        .btn-secondary:hover { background-color: #5A67D8; }
        .btn-danger { background: linear-gradient(45deg, var(--danger-color), #D64545); color: white; }
        .btn-danger:hover { background: linear-gradient(45deg, #D64545, #C53030); }

        #result-screen .controls { display: flex; justify-content: center; flex-wrap: wrap; gap: 25px; margin-bottom: 40px; padding: 0 20px; }

        .modal { position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.75); display: flex; justify-content: center; align-items: center; backdrop-filter: blur(8px); animation: fadeInOverlay 0.3s ease-out; }
        .modal.hidden { display: none !important; }
        .modal-content { background-color: var(--card-bg); padding: 45px; border-radius: var(--border-radius); width: 90%; max-width: 550px; box-shadow: var(--shadow); text-align: center; position: relative; animation: slideIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); border: 1px solid var(--border-color); }
        .modal-content h3 { margin-bottom: 28px; color: var(--primary-color); font-size: 2em; font-weight: 800; }
        .modal-content p { font-size: 1.15em; line-height: 1.6; color: var(--text-color); }
        .modal-buttons { display: flex; justify-content: center; gap: 20px; margin-top: 35px; }
        @keyframes fadeInOverlay { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-100px) scale(0.8); } to { opacity: 1; transform: translateY(0) scale(1); } }

        #review-summary-modal .modal-content { max-width: 750px; text-align: left; }
        #review-summary-modal h3 { text-align: center; }
        #review-summary-modal .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        #review-summary-modal .summary-item { background-color: var(--bg-color); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color); text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.05); }
        #review-summary-modal .summary-item strong { display: block; font-size: 1.8em; margin-bottom: 8px; color: var(--primary-color); font-weight: 700; }
        #review-summary-modal .summary-item span { color: var(--light-text-color); font-size: 1em; }
        #review-summary-modal .summary-item.answered strong { color: var(--secondary-color); }
        #review-summary-modal .summary-item.not-answered strong { color: var(--warning-color); }
        #review-summary-modal .summary-item.flagged strong { color: var(--danger-color); }

        .hidden { display: none !important; }
        .flex-center { display: flex; justify-content: center; align-items: center; }

        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); z-index: 2000; display: none; flex-direction: column; justify-content: center; align-items: center; color: white; font-size: 1.4em; backdrop-filter: blur(10px); }
        .spinner { border: 10px solid rgba(255,255,255,0.2); border-top: 10px solid var(--primary-color); border-radius: 50%; width: 80px; height: 80px; animation: spin 1s linear infinite; margin-bottom: 30px; }
        #loading-overlay p { color: white; font-weight: 600; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .floating-tool-trigger { position: fixed; bottom: 25px; right: 25px; background: linear-gradient(45deg, var(--primary-color), var(--primary-dark)); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 2em; cursor: pointer; box-shadow: var(--shadow); transition: background-color 0.3s, transform 0.3s; z-index: 999; }
        .floating-tool-trigger:hover { background: linear-gradient(45deg, var(--primary-dark), #434190); transform: scale(1.1); }
        .floating-tool-container { position: fixed; background-color: var(--calc-bg); border: 1px solid var(--calc-border); border-radius: 20px; box-shadow: var(--shadow); z-index: 998; overflow: hidden; display: flex; flex-direction: column; padding: 0; top: 50%; left: 50%; transform: translate(-50%, -50%); cursor: grab; min-width: 320px; min-height: 200px; }
        .floating-tool-container.hidden { display: none !important; }
        .floating-tool-header { background-color: var(--calc-display-bg); color: var(--calc-display-text); padding: 12px 20px; border-top-left-radius: 18px; border-top-right-radius: 18px; display: flex; justify-content: space-between; align-items: center; font-weight: 600; font-size: 1.2em; cursor: grab; }
        .floating-tool-header .close-btn { background: none; border: none; color: white; font-size: 1.3em; cursor: pointer; padding: 5px; transition: transform 0.2s; }
        .floating-tool-header .close-btn:hover { transform: scale(1.3); }

        #calculator-tool { width: 340px; height: 520px; resize: none; }
        #calculator { height: 100%; display: flex; flex-direction: column; }
        #calculator .display { background-color: var(--calc-display-bg); color: var(--calc-display-text); font-size: 3.8em; text-align: right; padding: 25px; flex-shrink: 0; overflow-x: auto; white-space: nowrap; scrollbar-width: thin; scrollbar-color: var(--primary-color) transparent; border-top-left-radius: 18px; border-top-right-radius: 18px; }
        #calculator .display::-webkit-scrollbar { height: 8px; }
        #calculator .display::-webkit-scrollbar-thumb { background-color: var(--primary-color); border-radius: 4px; }
        #calculator .display::-webkit-scrollbar-track { background-color: transparent; }
        #calculator .buttons { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(5, 1fr); gap: 2px; flex-grow: 1; background-color: var(--calc-border); padding-top: 2px; }
        #calculator .button { background-color: var(--calc-btn-bg); color: var(--calc-display-text); border: none; font-size: 2em; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: background-color 0.2s, transform 0.1s; user-select: none; -webkit-tap-highlight-color: transparent; }
        #calculator .button:hover { background-color: var(--calc-btn-hover); }
        #calculator .button.operator { background-color: var(--calc-btn-operator-bg); }
        #calculator .button.operator:hover { background-color: var(--calc-btn-operator-hover); }
        #calculator .button.clear-btn, #calculator .button.plus-minus, #calculator .button.percentage { background-color: var(--calc-btn-clear-bg); }
        #calculator .button.clear-btn:hover, #calculator .button.plus-minus:hover, #calculator .button.percentage:hover { background-color: var(--calc-btn-clear-hover); }
        #calculator .button.zero { grid-column: span 2; border-bottom-left-radius: 18px; }
        #calculator .button:nth-last-child(1) { border-bottom-right-radius: 18px; }

        #scratchpad-tool { width: 450px; height: 350px; resize: both; display: flex; flex-direction: column; border-radius: 20px; background-color: var(--scratchpad-bg); border: 1px solid var(--scratchpad-border); }
        #scratchpad-tool .floating-tool-header { background: linear-gradient(90deg, var(--primary-color), var(--primary-dark)); border-bottom: 1px solid var(--primary-dark); }
        body.dark-mode #scratchpad-tool .floating-tool-header { background: linear-gradient(90deg, var(--primary-color), var(--primary-dark)); border-bottom: 1px solid var(--primary-dark); }
        #scratchpad-textarea { width: 100%; flex-grow: 1; border: none; padding: 20px; font-size: 1.05em; font-family: 'Inter', sans-serif; resize: none; outline: none; background-color: var(--scratchpad-bg); color: var(--text-color); line-height: 1.7; tab-size: 4; -moz-tab-size: 4; white-space: pre-wrap; word-wrap: break-word; }
        #scratchpad-textarea::placeholder { color: var(--light-text-color); }

        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1001; display: flex; flex-direction: column; gap: 10px; align-items: center; }
        .toast { background-color: rgba(45, 55, 72, 0.95); color: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); font-size: 0.95em; opacity: 0; transform: translateY(-20px); animation: toastIn 0.5s forwards, toastOut 0.5s forwards 2.5s; min-width: 250px; text-align: center; display: flex; align-items: center; gap: 10px; }
        .toast.success { background-color: rgba(76, 175, 80, 0.95); }
        .toast.error { background-color: rgba(244, 67, 54, 0.95); }
        .toast.info { background-color: rgba(33, 150, 243, 0.95); }
        @keyframes toastIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes toastOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-20px); } }

        @media (max-width: 768px) {
            .page-header, .test-header, .test-footer { padding: 15px 25px; flex-direction: column; text-align: center; gap: 15px; }
            .page-header h1 { font-size: 1.2em; }
            .mode-toggle { position: absolute; top: 10px; right: 10px; padding: 8px; font-size: 1.5em; }
            #question-counter, #timer { font-size: 1.1em; padding: 10px 18px; min-width: unset; width: 100%; }
            .container { margin: 20px auto; border-radius: 12px; }
            .screen { padding: 30px; }
            .screen h2 { font-size: 2em; margin-bottom: 25px; }
            .screen p { font-size: 1em; }
            #instructions-screen ul { padding-left: 0; margin-left: 0; }
            #instructions-screen ul li { font-size: 1em; margin-bottom: 10px; align-items: flex-start; line-height: 1.5; }
            #instructions-screen ul li::before { font-size: 1.1em; margin-right: 8px; padding-right: 3px; }
            #question-container { font-size: 1.3em; margin-bottom: 30px; }
            .option { padding: 15px 20px; font-size: 1.05em; }
            .option::before { width: 18px; height: 18px; }
            .btn { width: 100%; margin-bottom: 10px; padding: 14px 30px; font-size: 1em; }
            .test-footer .left-controls, .test-footer .right-controls { flex-direction: column; width: 100%; gap: 15px; }
            #question-palette { gap: 10px; padding: 20px 25px; }
            .palette-btn { width: 50px; height: 50px; font-size: 1em; border-radius: 10px; }
            .palette-btn.flagged::after { font-size: 0.7em; top: 2px; right: 2px; }
            #result-screen { padding: 30px; }
            #result-summary { padding: 25px; }
            .score-circle { width: 160px; height: 160px; margin-bottom: 25px; }
            .score-circle span:first-child { font-size: 3.5em; }
            .score-circle span:last-child { font-size: 1.1em; }
            .score-details { grid-template-columns: 1fr; gap: 20px; }
            .modal-content { padding: 35px 25px; }
            .modal-content h3 { font-size: 1.8em; }
            .modal-content p { font-size: 1.05em; }
            .modal-buttons { flex-direction: column; gap: 15px; }
            .floating-tool-trigger { width: 55px; height: 55px; font-size: 1.8em; bottom: 20px; right: 20px; }
            #calculator-tool, #scratchpad-tool { width: 90%; max-width: 340px; height: auto; max-height: 90vh; top: 50%; left: 50%; transform: translate(-50%, -50%); }
            #calculator .display { font-size: 3em; padding: 20px; }
            #calculator .button { font-size: 1.8em; }
        }
        @media (max-width: 480px) {
            .page-header { padding-top: 55px; }
            .screen { padding: 20px; }
            .test-body { padding: 20px; }
            .test-footer { padding: 20px; }
            #question-palette { padding: 15px 20px; }
            .palette-btn { width: 45px; height: 45px; font-size: 0.9em; }
        }
        @media print {
            body > *:not(.container) { display: none !important; }
            .container { box-shadow: none !important; margin: 0 !important; padding: 0 !important; width: 100% !important; max-width: none !important; border-radius: 0 !important; border: none !important; }
            #result-screen { padding: 20px !important; text-align: left !important; }
            #result-summary { box-shadow: none !important; border: none !important; padding: 20px !important; background-color: white !important; }
            .score-circle { box-shadow: none !important; background: none !important; color: var(--primary-color) !important; border: 2px solid var(--primary-color); }
            .score-circle span:first-child { color: var(--primary-color) !important; }
            .score-details div { box-shadow: none !important; border: 1px solid var(--border-color) !important; background-color: white !important; }
            .controls { display: none !important; }
            #answer-review-container { display: block !important; width: 100% !important; margin-top: 0 !important; }
            .result-question { box-shadow: none !important; border: 1px solid var(--border-color) !important; background-color: white !important; padding: 15px !important; margin-bottom: 15px !important; }
            .result-option { margin-bottom: 5px !important; }
            .not-attempted-text { margin-left: 0 !important; }
            body.dark-mode .result-option.correct { color: var(--secondary-color) !important; }
            body.dark-mode .result-option.incorrect.user-answer { color: var(--danger-color) !important; }
            body.dark-mode .result-option.correct::before, body.dark-mode .result-option.incorrect.user-answer::before { color: inherit !important; }
            body.dark-mode #result-summary, body.dark-mode .score-details div, body.dark-mode .result-question { background-color: white !important; color: var(--text-color) !important; }
            body.dark-mode .score-circle { color: var(--primary-color) !important; }
            body.dark-mode .score-circle span:first-child { color: var(--primary-color) !important; }
            body.dark-mode .score-details p:last-child { color: var(--primary-color) !important; }
            body.dark-mode .score-details div:nth-child(3) p:last-child { color: var(--secondary-color) !important; }
            body.dark-mode .score-details div:nth-child(4) p:last-child { color: var(--danger-color) !important; }
        }
    </style>
</head>
<body>
    <header class="page-header">
        <h1>BPS 5-15 Intermediate Category Mock Test 4</h1>
        <div class="mode-toggle" id="mode-toggle" title="Toggle Dark/Light Mode">
            <i class="fas fa-moon"></i>
        </div>
    </header>

    <main class="container">
        <section id="password-screen" class="screen">
            <h2>Enter Password to Start</h2>
            <p>Please enter the provided password to begin your mock test. This ensures the integrity of the test environment.</p>
            <div class="input-group">
                <input type="password" id="password-input" placeholder="Enter password">
                <span class="toggle-password" id="toggle-password">
                    <i class="fas fa-eye"></i>
                </span>
            </div>
            <button class="btn btn-primary" id="start-button">Start Test</button>
        </section>

        <section id="instructions-screen" class="screen hidden">
            <h2>Instructions</h2>
            <ul>
                <li><span>The test consists of <strong>100 Multiple Choice Questions (MCQs)</strong> across various sections.</span></li>
                <li><span>You have <strong>60 minutes</strong> to complete the test. The timer will start once you begin.</span></li>
                <li><span>The passing score for this test is <strong>40 marks</strong>.</span></li>
                <li><span>Each question has only <strong>one correct answer</strong>.</span></li>
                <li><span>You can navigate between questions using the "Previous" and "Next" buttons, or by using the question palette at the bottom.</span></li>
                <li><span>You can "Flag" questions for review and come back to them later.</span></li>
                <li><span>Your progress (answered, not answered, flagged) will be visible in the question palette.</span></li>
                <li><span>A calculator and a scratchpad are available as floating tools for your convenience.</span></li>
                <li><span>Once you click "Submit Test," you will not be able to change your answers.</span></li>
                <li><span>Ensure you have a stable internet connection.</span></li>
                <li><span>Good luck!</span></li>
            </ul>
            <button class="btn btn-primary" id="begin-test-button">Begin Test</button>
        </section>

        <section id="test-screen" class="hidden">
            <div class="test-header">
                <div id="question-counter">Question: 1 / 100</div>
                <div id="timer">Time Left: 60:00</div>
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
            </div>

            <div class="test-body">
                <p id="question-section" style="font-size: 1.1em; color: var(--primary-color); margin-bottom: 10px; font-weight: 600;"></p>
                <div id="reading-passage-container" class="reading-passage hidden">
                    <h3>Reading Passage</h3>
                    <p id="reading-passage-text"></p>
                </div>
                <div id="question-container"></div>
                <div class="options-container" id="options-container"></div>
            </div>

            <div class="test-footer">
                <div class="left-controls">
                    <button class="btn btn-flag" id="flag-button"><i class="fas fa-flag"></i> Flag for Review</button>
                    <button class="btn btn-secondary hidden" id="prev-button"><i class="fas fa-arrow-left"></i> Previous</button>
                </div>
                <div class="right-controls">
                    <button class="btn btn-primary" id="next-button">Next <i class="fas fa-arrow-right"></i></button>
                    <button class="btn btn-submit hidden" id="submit-test-button">Submit Test <i class="fas fa-check"></i></button>
                </div>
            </div>

            <div class="question-palette" id="question-palette"></div>
        </section>

        <section id="result-screen" class="screen hidden">
            <h2>Test Results</h2>
            <div id="result-summary">
                <div class="score-circle">
                    <span id="final-score">0</span>
                    <span id="total-marks-summary">/ 100 Marks</span>
                </div>
                <div class="score-details">
                    <div>
                        <p>Total Questions</p>
                        <p id="total-questions-summary">100</p>
                    </div>
                    <div>
                        <p>Attempted Questions</p>
                        <p id="attempted-questions-summary">0</p>
                    </div>
                    <div>
                        <p>Status</p>
                        <p id="pass-fail-status" style="font-weight: 700;">-</p>
                    </div>
                    <div>
                        <p>Correct Answers</p>
                        <p id="correct-answers-summary">0</p>
                    </div>
                    <div>
                        <p>Incorrect Answers</p>
                        <p id="incorrect-answers-summary">0</p>
                    </div>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-secondary" id="review-answers-button"><i class="fas fa-eye"></i> Review Answers</button>
                <button class="btn btn-primary" id="print-result-button"><i class="fas fa-print"></i> Print Result</button>
                <button class="btn btn-secondary" id="retake-test-button"><i class="fas fa-redo"></i> Retake Test</button>
            </div>

            <div id="answer-review-container" class="hidden" style="width: 100%; text-align: left; margin-top: 30px;"></div>
        </section>
    </main>

    <footer class="page-footer">
        <p>&copy; 2025 BPS 5-15 Intermediate Category Mock Test Series. All rights reserved. Crafted with dedication by <a href="https://mock-test-hub.netlify.app" target="_blank" rel="noopener noreferrer">Mock Test Hub</a></p>
    </footer>

    <div id="confirm-submit-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Confirm Submission</h3>
            <p>Are you sure you want to submit the test? You will not be able to change your answers after submission.</p>
            <div class="modal-buttons">
                <button class="btn btn-danger" id="confirm-submit-yes">Yes, Submit</button>
                <button class="btn btn-secondary" id="confirm-submit-no">No, Go Back</button>
            </div>
        </div>
    </div>

    <div id="review-summary-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Test Summary</h3>
            <div class="summary-grid">
                <div class="summary-item answered">
                    <strong id="summary-answered-count">0</strong>
                    <span>Answered</span>
                </div>
                <div class="summary-item not-answered">
                    <strong id="summary-not-answered-count">0</strong>
                    <span>Not Answered</span>
                </div>
                <div class="summary-item flagged">
                    <strong id="summary-flagged-count">0</strong>
                    <span>Flagged</span>
                </div>
            </div>
            <p>You have <span id="unanswered-flagged-message"></span></p>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="summary-continue-test">Continue Test</button>
                <button class="btn btn-danger" id="summary-submit-test">Submit Anyway</button>
            </div>
        </div>
    </div>

    <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
        <p>Generating PDF...</p>
    </div>

    <div id="toast-container"></div>

    <div class="floating-tool-trigger" id="calculator-trigger" title="Open Calculator">
        <i class="fas fa-calculator"></i>
    </div>
    <div class="floating-tool-trigger" id="scratchpad-trigger" style="bottom: 95px;" title="Open Scratchpad">
        <i class="fas fa-pencil-alt"></i>
    </div>

    <div class="floating-tool-container hidden" id="calculator-tool">
        <div class="floating-tool-header">
            <span>Calculator</span>
            <button class="close-btn" data-tool="calculator"><i class="fas fa-times"></i></button>
        </div>
        <div id="calculator">
            <div class="display" id="calculator-display">0</div>
            <div class="buttons">
                <button class="button clear-btn">AC</button>
                <button class="button plus-minus">Â±</button>
                <button class="button percentage">%</button>
                <button class="button operator" data-operator="/">Ã·</button>
                <button class="button">7</button>
                <button class="button">8</button>
                <button class="button">9</button>
                <button class="button operator" data-operator="*">Ã—</button>
                <button class="button">4</button>
                <button class="button">5</button>
                <button class="button">6</button>
                <button class="button operator" data-operator="-">-</button>
                <button class="button">1</button>
                <button class="button">2</button>
                <button class="button">3</button>
                <button class="button operator" data-operator="+">+</button>
                <button class="button zero">0</button>
                <button class="button decimal">.</button>
                <button class="button operator equal" data-operator="=">=</button>
            </div>
        </div>
    </div>

    <div class="floating-tool-container hidden" id="scratchpad-tool">
        <div class="floating-tool-header">
            <span>Scratchpad</span>
            <button class="close-btn" data-tool="scratchpad"><i class="fas fa-times"></i></button>
        </div>
        <textarea id="scratchpad-textarea" placeholder="Write your notes here..."></textarea>
    </div>

    <script>
        const PASSWORD = "stsibatest2025"; 
        
        // --- Reading Passage (UPDATED) ---
        const passage = "As the sun set over the horizon, John looked out at the vast expanse of the ocean. He had always been fascinated by the sea, by its power and its beauty. But tonight, as he stood alone on the beach, he felt a sense of unease. There was something different about the ocean tonight, something ominous.\n\nHe couldn't quite put his finger on it, but he knew that something was not right. The waves seemed to be getting higher and higher, crashing against the shore with more force than he had ever seen before. The wind was picking up too, blowing sand into his face and making it difficult to stand upright.\n\nSuddenly, he saw a flash of lightning in the distance, followed by the low rumble of thunder. He knew then that he needed to get off the beach, to find some shelter before the storm hit in full force. As he turned to leave, he saw a figure in the distance, walking towards him. He couldn't make out who it was, but he knew that he needed to get away, and fast.";

        // --- Quiz Data (UPDATED) ---
        const quizData = [
          // --- PART-I (ENGLISH) ---
          {
            question: "What is John's fascination?",
            section: "English - Reading Comprehension",
            passage: true,
            options: ["The desert", "The ocean", "The mountains", "The forest"],
            correctAnswer: 1 // B
          },
          {
            question: "How does John feel about the ocean tonight?",
            section: "English - Reading Comprehension",
            passage: true,
            options: ["Excited", "Happy", "Unease", "Relaxed"],
            correctAnswer: 2 // C
          },
          {
            question: "What is John's location in the passage?",
            section: "English - Reading Comprehension",
            passage: true,
            options: ["In a forest", "On a mountain", "In a desert", "On a beach"],
            correctAnswer: 3 // D
          },
          {
            question: "What is the weather like in the passage?",
            section: "English - Reading Comprehension",
            passage: true,
            options: ["Sunny", "Cloudy", "Rainy", "Stormy"],
            correctAnswer: 3 // D
          },
          {
            question: "What does John see in the distance?",
            section: "English - Reading Comprehension",
            passage: true,
            options: ["A boat", "A figure", "A building", "A tree"],
            correctAnswer: 1 // B
          },
          {
            question: "What is John's reaction to the figure he sees?",
            section: "English - Reading Comprehension",
            passage: true,
            options: ["He is happy to see them", "He is scared and wants to get away", "He is curious and approaches them", "He doesn't notice them"],
            correctAnswer: 1 // B
          },
          {
            question: "What does John hear after he sees the lightning?",
            section: "English - Reading Comprehension",
            passage: true,
            options: ["Music", "Thunder", "Birds", "People talking"],
            correctAnswer: 1 // B
          },
          {
            question: "What does the wind do to John's face?",
            section: "English - Reading Comprehension",
            passage: true,
            options: ["It cools it down", "It warms it up", "It blows sand into it", "It makes it wet"],
            correctAnswer: 2 // C
          },
          {
            question: "What is John's main goal?",
            section: "English - Reading Comprehension",
            passage: true,
            options: ["To find shelter", "To find the figure", "To watch the storm", "To swim in the ocean"],
            correctAnswer: 0 // A
          },
          {
            question: "What is the mood of the passage?",
            section: "English - Reading Comprehension",
            passage: true,
            options: ["Happy", "Sad", "Scary", "Exciting"],
            correctAnswer: 2 // C
          },
          // Section: Synonyms (Q11-Q15)
          {
            question: "These days we have more money and more leisure to enjoy it.",
            section: "English - Synonyms",
            passage: false,
            options: ["Free time", "have nothing especial to do", "Time that is spent doing what you enjoy", "no hurry"],
            correctAnswer: 0 // A
          },
          {
            question: "He was proud of himself for not giving up.",
            section: "English - Synonyms",
            passage: false,
            options: ["Arrogant", "Feeling pleased and satisfied", "Strong enough", "Conceited"],
            correctAnswer: 1 // B
          },
          {
            question: "She gave me a bright smile.",
            section: "English - Synonyms",
            passage: false,
            options: ["Intelligent", "Cheerful and lively", "Strong and easy", "full of light"],
            correctAnswer: 1 // B
          },
          {
            question: "I was cross with him for being late.",
            section: "English - Synonyms",
            passage: false,
            options: ["Mad", "Going with somebody from one place to another", "Quite angry", "Showed reaction"],
            correctAnswer: 2 // C
          },
          {
            question: "How can anyone live on such a miserable wage?",
            section: "English - Synonyms",
            passage: false,
            options: ["Depressing", "Paltry", "Grumpy", "Uncomfortably"],
            correctAnswer: 1 // B
          },
          // Section: Antonyms (Q16-Q20)
          {
            question: "He has spoken very well.",
            section: "English - Antonyms",
            passage: false,
            options: ["Good", "Bad", "Badly", "In a badly manner"],
            correctAnswer: 2 // C
          },
          {
            question: "I left the island with a light heart.",
            section: "English - Antonyms",
            passage: false,
            options: ["Heavy", "Shallow", "Sad", "Deep"],
            correctAnswer: 0 // A
          },
          {
            question: "It was a significant smile that she had had at me.",
            section: "English - Antonyms",
            passage: false,
            options: ["Unimportant", "Meaningless", "Tiny", "Trivial"],
            correctAnswer: 0 // A
          },
          {
            question: "The jargon in his talk was opaque to me.",
            section: "English - Antonyms",
            passage: false,
            options: ["Meaningful", "Clear", "Transparent", "Absurd"],
            correctAnswer: 2 // C 
          },
          {
            question: "It was a cowardly attack on a defenseless man.",
            section: "English - Antonyms",
            passage: false,
            options: ["Courageously", "Bravely", "Brave", "Boldly"],
            correctAnswer: 2 // C 
          },
          // Section: Error Detection (Q21-Q25)
          {
            question: "I have been cleaning three rooms since lunch time.",
            section: "English - Error Detection",
            passage: false,
            options: ["I", "have been cleaning", "since", "lunch time"],
            correctAnswer: 3 // D 
          },
          {
            question: "He is one of the best man I have ever seen in my life.",
            section: "English - Error Detection",
            passage: false,
            options: ["one of", "best man", "ever seen", "in my life"],
            correctAnswer: 1 // B 
          },
          {
            question: "I am looking forward to reply to you very soon.",
            section: "English - Error Detection",
            passage: false,
            options: ["am", "looking forward", "to reply", "very soon"],
            correctAnswer: 2 // C 
          },
          {
            question: "I am used to go to school everyday.",
            section: "English - Error Detection",
            passage: false,
            options: ["am", "used to", "go", "everyday"],
            correctAnswer: 2 // C 
          },
          {
            question: "He has told me everything word by word.",
            section: "English - Error Detection",
            passage: false,
            options: ["He", "told me", "everything", "word by word"],
            correctAnswer: 3 // D 
          },
          // Section: Preposition & Structure (Q26-Q40)
          {
            question: "She is busy ____ her work.",
            section: "English - Prepositions",
            passage: false,
            options: ["in", "with", "besides", "at"],
            correctAnswer: 1 // B
          },
          {
            question: "I face a lot of difficulties ____ this new project.",
            section: "English - Prepositions",
            passage: false,
            options: ["in", "on", "at", "with"],
            correctAnswer: 0 // A
          },
          {
            question: "I don't need ____ your comments, thank you.",
            section: "English - Prepositions",
            passage: false,
            options: ["for", "of", "about", "None of these"],
            correctAnswer: 3 // D 
          },
          {
            question: "A working party has been set up to look ____ the problem.",
            section: "English - Prepositions",
            passage: false,
            options: ["in", "into", "at", "for"],
            correctAnswer: 1 // B
          },
          {
            question: "He showed great ability........ Mathematics.",
            section: "English - Prepositions",
            passage: false,
            options: ["in", "for", "at", "about"],
            correctAnswer: 0 // A
          },
          {
            question: "He is......................",
            section: "English - Sentence Structure",
            passage: false,
            options: ["too intelligent to answer the questions", "enough intelligent to answer the questions", "intelligent enough to answer questions", "so intelligent to answer the questions"],
            correctAnswer: 2 // C
          },
          {
            question: "....................., I have had different jobs since.",
            section: "English - Sentence Structure",
            passage: false,
            options: ["I am leaving school", "I have left school", "I left school", "I had left school"],
            correctAnswer: 2 // C
          },
          {
            question: "He is one of the best men ....................",
            section: "English - Sentence Structure",
            passage: false,
            options: ["I ever see in my life", "I am seeing in my life", "I saw in my life", "I have ever seen in my life"],
            correctAnswer: 3 // D
          },
          {
            question: "The ..................., the more you learn.",
            section: "English - Sentence Structure",
            passage: false,
            options: ["more you study books", "more books you will study", "more books you study", "more you will study books"],
            correctAnswer: 2 // C 
          },
          {
            question: "He is not .................... as you think.",
            section: "English - Sentence Structure",
            passage: false,
            options: ["such an intelligent", "too intelligent", "so intelligent", "as intelligent"],
            correctAnswer: 3 // D
          },
          {
            question: "Correct spelling:",
            section: "English - Spelling",
            passage: false,
            options: ["consensus", "concensus", "consencus", "concensus"],
            correctAnswer: 0 // A
          },
          {
            question: "Correct spelling:",
            section: "English - Spelling",
            passage: false,
            options: ["meantainance", "mantainance", "maintenance", "maintainance"],
            correctAnswer: 2 // C
          },
          {
            question: "Correct spelling:",
            section: "English - Spelling",
            passage: false,
            options: ["occassion", "ocasion", "ocassion", "occasion"],
            correctAnswer: 3 // D
          },
          {
            question: "Correct spelling:",
            section: "English - Spelling",
            passage: false,
            options: ["ocurred", "occurred", "occured", "ocured"],
            correctAnswer: 1 // B
          },
          {
            question: "Correct spelling:",
            section: "English - Spelling",
            passage: false,
            options: ["colleague", "culleague", "collague", "collegue"],
            correctAnswer: 0 // A
          },
          // --- PART-II (MATHEMATICS) ---
          {
            question: "The value of $9 \\div \\sqrt{3} = ?$",
            section: "Mathematics",
            passage: false,
            options: ["$9\\sqrt{3}$", "$6$", "$3$", "$3\\sqrt{3}$"],
            correctAnswer: 3 // D
          },
          {
            question: "The value of $\\log_8 64 = ?$",
            section: "Mathematics",
            passage: false,
            options: ["$2$", "$3$", "$4$", "None of these"],
            correctAnswer: 0 // A
          },
          {
            question: "The value of $\\sin 0^\\circ + \\cos 90^\\circ$",
            section: "Mathematics",
            passage: false,
            options: ["$0$", "$1$", "$2$", "$\\frac{1}{2}$"],
            correctAnswer: 0 // A
          },
          {
            question: "The value of $(52)^2 - (28)^2$.",
            section: "Mathematics",
            passage: false,
            options: ["$1900$", "$1920$", "$1930$", "None of these"],
            correctAnswer: 1 // B
          },
          {
            question: "The value of $\\frac{1}{1000}$ is equivalent to:",
            section: "Mathematics",
            passage: false,
            options: ["$0.1$", "$0.01$", "$0.0001$", "$0.001$"],
            correctAnswer: 3 // D
          },
          {
            question: "The fraction $\\frac{28}{3}$ can be expressed into fraction as:",
            section: "Mathematics",
            passage: false,
            options: ["$9 \\frac{1}{3}$", "$9 \\frac{2}{3}$", "$8 \\frac{1}{3}$", "$8 \\frac{2}{3}$"],
            correctAnswer: 0 // A
          },
          {
            question: "The value of $x$ in the $10:35 :: x:28$ is.",
            section: "Mathematics",
            passage: false,
            options: ["$56$", "$26$", "$8$", "$7$"],
            correctAnswer: 2 // C
          },
          {
            question: "After paying $\\frac{3}{5}$ of bank loan, PKR 20000 loan is left. The total bank loan is:",
            section: "Mathematics",
            passage: false,
            options: ["300000", "400000", "500000", "600000"],
            correctAnswer: 2 // C 
          },
          {
            question: "If we subtract largest 4 digit number from largest 4 digit even number, the result is:",
            section: "Mathematics",
            passage: false,
            options: ["$8998$", "$9998$", "$1$", "$-1$"],
            correctAnswer: 3 // D 
          },
          {
            question: "Improper fraction among the following is:",
            section: "Mathematics",
            passage: false,
            options: ["$\\frac{3}{5}$", "$\\frac{5}{7}$", "$\\frac{7}{9}$", "$\\frac{9}{7}$"],
            correctAnswer: 3 // D
          },
          {
            question: "A bag marked at a price of Rs. 1600 is available at a discount of $45\\%$. What is the discount given?",
            section: "Mathematics",
            passage: false,
            options: ["Rs 740", "Rs 720", "Rs 800", "Rs 760"],
            correctAnswer: 1 // B
          },
          {
            question: "Find two numbers whose sum is 31 and the difference is 3 ________?",
            section: "Mathematics",
            passage: false,
            options: ["$14, 17$", "$15, 18$", "$20, 23$", "$13, 16$"],
            correctAnswer: 0 // A
          },
          {
            question: "The sum of all the angles in a pentagon is:",
            section: "Mathematics",
            passage: false,
            options: ["$180$", "$240$", "$540$", "$360$"],
            correctAnswer: 2 // C
          },
          {
            question: "In binary system equivalent of 10 in decimal number system is:",
            section: "Mathematics",
            passage: false,
            options: ["$0010$", "$10$", "$100$", "$1010$"],
            correctAnswer: 3 // D
          },
          {
            question: "The binary number 11001 can be expressed in decimal number system as:",
            section: "Mathematics",
            passage: false,
            options: ["$25$", "$20$", "$15$", "$14$"],
            correctAnswer: 0 // A
          },
          {
            question: "Sister is 8 years older than her brother. After 3 years the sister's age will be twice of her brother. What is age of brother now?",
            section: "Mathematics",
            passage: false,
            options: ["$6$", "$5$", "$7$", "$8$"],
            correctAnswer: 1 // B
          },
          {
            question: "The half kg is ______ fraction of 5 kg.",
            section: "Mathematics",
            passage: false,
            options: ["$\\frac{1}{2}$", "$\\frac{1}{5}$", "$\\frac{1}{10}$", "$\\frac{1}{100}$"],
            correctAnswer: 2 // C
          },
          {
            question: "Find the side of square whose perimeter is 36.",
            section: "Mathematics",
            passage: false,
            options: ["$5$", "$6$", "$9$", "$12$"],
            correctAnswer: 2 // C
          },
          {
            question: "Two numbers are in the ratio 3:4, their total is 77 and difference between them is 11.",
            section: "Mathematics",
            passage: false,
            options: ["$32, 43$", "$31, 42$", "$33, 44$", "$34, 45$"],
            correctAnswer: 2 // C
          },
          {
            question: "The weight of a bucket full of water is 20 kg. If the bucket is half filled with water, then its weight is 14 kg. How many kg is the weight of empty bucket?",
            section: "Mathematics",
            passage: false,
            options: ["$6$ kg", "$7$ kg", "$10$ kg", "$8$ kg"],
            correctAnswer: 3 // D
          },
          // --- PART-III (GENERAL KNOWLEDGE) ---
          {
            question: "Which Mughal Emperor is buried in Pakistan?",
            section: "General Knowledge",
            passage: false,
            options: ["Babur", "Humayun", "Jahangir", "Akbar"],
            correctAnswer: 2 // C
          },
          {
            question: "The shrine of Hazrat Bahauddin Zakariya is located in the city of:",
            section: "General Knowledge",
            passage: false,
            options: ["Bahawalpur", "Multan", "Faisalabad", "Sahiwal"],
            correctAnswer: 1 // B
          },
          {
            question: "The country with longest coastline in the world is ________?",
            section: "General Knowledge",
            passage: false,
            options: ["USA", "China", "Canada", "China"],
            correctAnswer: 2 // C
          },
          {
            question: "What is the second smallest continent after Australia in the world?",
            section: "General Knowledge",
            passage: false,
            options: ["North America", "South America", "Europe", "Asia"],
            correctAnswer: 2 // C
          },
          {
            question: "The book \"In line of Fire\" was written by?",
            section: "General Knowledge",
            passage: false,
            options: ["Zulfiqar Ali Bhutto", "Ayoub Khan", "Imran Khan", "Pervez Mushraf"],
            correctAnswer: 3 // D
          },
          {
            question: "The 2023 G20 summit is to be held in which country?",
            section: "General Knowledge",
            passage: false,
            options: ["India", "Saudi Arabia", "Turkey", "China"],
            correctAnswer: 0 // A
          },
          {
            question: "Which is the largest opium producing country in the world?",
            section: "General Knowledge",
            passage: false,
            options: ["India", "Nigeria", "Myanmar", "Afghanistan"],
            correctAnswer: 3 // D 
          },
          {
            question: "Which of the following is currency of Azerbaijan?",
            section: "General Knowledge",
            passage: false,
            options: ["Dinar", "Rial", "Darham", "Manat"],
            correctAnswer: 3 // D
          },
          {
            question: "Which among the following is the capital of Finland?",
            section: "General Knowledge",
            passage: false,
            options: ["Vaduz", "Helsinki", "Kabul", "Sofia"],
            correctAnswer: 1 // B
          },
          {
            question: "Into how many time zones, the world is divided?",
            section: "General Knowledge",
            passage: false,
            options: ["9", "12", "24", "36"],
            correctAnswer: 2 // C
          },
          {
            question: "\"Think and Grow Rich\" book is written by:",
            section: "General Knowledge",
            passage: false,
            options: ["Napoleon Hill", "Henry Kissinger", "Stanely Wolpert", "Naom Chomsky"],
            correctAnswer: 0 // A
          },
          {
            question: "Harley street is famous for:",
            section: "General Knowledge",
            passage: false,
            options: ["Banking, Finance and Stock Exchange", "Jewellery", "Newspaper", "Doctors and Medicines"],
            correctAnswer: 3 // D
          },
          {
            question: "First city on which atom bomb was dropped?",
            section: "General Knowledge",
            passage: false,
            options: ["Hiroshima", "Nagasaki", "Fukuoka", "Kumamoto"],
            correctAnswer: 0 // A
          },
          {
            question: "Part of land surrounded by water on three sides is called:",
            section: "General Knowledge",
            passage: false,
            options: ["Island", "Peninsula", "Gulf", "Creak"],
            correctAnswer: 1 // B
          },
          {
            question: "Israel's parliament is:",
            section: "General Knowledge",
            passage: false,
            options: ["Knesset", "Diet", "National Assembly", "Majlis-i-Ummah"],
            correctAnswer: 0 // A
          },
          // --- Everyday Science ---
          {
            question: "Examples of Epigeal germination include ________?",
            section: "Everyday Science",
            passage: false,
            options: ["Maize", "Sword bean seed", "Broad bean seed", "Corn"],
            correctAnswer: 1 // B 
          },
          {
            question: "Isotopes differs in________?",
            section: "Everyday Science",
            passage: false,
            options: ["arrangement of electrons in orbitals", "position in the periodic table", "properties depend upon mass", "chemical properties"],
            correctAnswer: 2 // C
          },
          {
            question: "Carbon, Diamond and Graphite are together called: ________?",
            section: "Everyday Science",
            passage: false,
            options: ["Allotrope", "Isomers", "Isomorphs", "Isotopes"],
            correctAnswer: 0 // A
          },
          {
            question: "The outer most part of plant cell is________?",
            section: "Everyday Science",
            passage: false,
            options: ["Plasma membrane", "Epidermis", "Nuclear membrane", "Cellulose cell wall"],
            correctAnswer: 3 // D
          },
          {
            question: "When the radiation of light is passed through a prism, it undergoes ________?",
            section: "Everyday Science",
            passage: false,
            options: ["reflection", "interference", "diffraction", "refraction"],
            correctAnswer: 3 // D
          },
          {
            question: "Which planet is called \"Red Planet\"?",
            section: "Everyday Science",
            passage: false,
            options: ["Mars", "Venus", "Jupiter", "Saturn"],
            correctAnswer: 0 // A
          },
          {
            question: "Study of insects is called:",
            section: "Everyday Science",
            passage: false,
            options: ["Entomology", "Cytology", "Carpology", "Ecology"],
            correctAnswer: 0 // A
          },
          {
            question: "How many pairs of chromosomes are present in human body?",
            section: "Everyday Science",
            passage: false,
            options: ["24", "23", "26", "29"],
            correctAnswer: 1 // B
          },
          {
            question: "An instrument for measuring the humidity of the air or a gas is called:",
            section: "Everyday Science",
            passage: false,
            options: ["Hydrometer", "Spectrometer", "Hygrometer", "Fathometer"],
            correctAnswer: 2 // C
          },
          {
            question: "Farad is the unit of ________.",
            section: "Everyday Science",
            passage: false,
            options: ["Inductance", "Capacitance", "Voltage", "None of these"],
            correctAnswer: 1 // B
          },
          // --- Islamiat / Pakistan Studies ---
          {
            question: "Muhammad Ali Jinnah joined All India Muslim League on ________?",
            section: "Pakistan Studies",
            passage: false,
            options: ["1913", "1917", "1912", "1908"],
            correctAnswer: 0 // A
          },
          {
            question: "The 1973 Constitution of Pakistan came into force on:",
            section: "Pakistan Studies",
            passage: false,
            options: ["14th August 1973", "23rd March 1973", "8th June 1973", "27th October 1973"],
            correctAnswer: 0 // A
          },
          {
            question: "When the constituent Assembly passed the Objective resolution?",
            section: "Pakistan Studies",
            passage: false,
            options: ["14th February 1949", "9th June 1949", "15th August 1949", "12th March 1949"],
            correctAnswer: 3 // D
          },
          {
            question: "Daughter of Hazrat Umar R.A who married to Prophet Muhammad (SAW)?",
            section: "Islamiat",
            passage: false,
            options: ["Hazrat Hafsa R.A", "Hazrat Ayesha R.A", "Hazrat Summayya R.A", "Hazrat Umme Habiba"],
            correctAnswer: 0 // A
          },
          {
            question: "No. of Muslims fought in the battle of Ghazwa-e-Badr?",
            section: "Islamiat",
            passage: false,
            options: ["314", "313", "315", "316"],
            correctAnswer: 1 // B
          },
          // --- PART-IV (COMPUTER) ---
          {
            question: "In MS Word CTRL+E is used to align the text inâ€”â€”side of a paragraph",
            section: "Computer Science",
            passage: false,
            options: ["Left", "Center", "Right", "None of these"],
            correctAnswer: 1 // B
          },
          {
            question: "In MS Excel name box is used to obtainâ€”â€” of the current cell",
            section: "Computer Science",
            passage: false,
            options: ["Coordinates", "Address", "Formatting", "None of these"],
            correctAnswer: 1 // B
          },
          {
            question: "Which one is an email provider",
            section: "Computer Science",
            passage: false,
            options: ["Gmail", "Yahoo.com", "Outlook.com", "All of these"],
            correctAnswer: 3 // D
          },
          {
            question: "The term bit is short for",
            section: "Computer Science",
            passage: false,
            options: ["Binary system", "Digital byte", "Binary unit", "Binary digit"],
            correctAnswer: 3 // D
          },
          {
            question: "ISDN stands for________.",
            section: "Computer Science",
            passage: false,
            options: ["Internal Select Data Nulls", "Integrated Services Digital Network", "Interval Set Down Next", "Interior Sector Direct Network"],
            correctAnswer: 1 // B
          },
          {
            question: "How to duplicate values in cell range in excel 2016?",
            section: "Computer Science",
            passage: false,
            options: ["Select the range of cell in the work sheet", "Click the conditional formatting button in the styles group of the theme", "Both A and B", "None of these"],
            correctAnswer: 1 // B 
          },
          {
            question: "CTRL+ D is dialog used in MS WORD for:",
            section: "Computer Science",
            passage: false,
            options: ["Delete D Box", "Font Dialog Box", "Layout Dialog Box", "None of these"],
            correctAnswer: 1 // B
          },
          {
            question: "Who invented the QWERTY keyboard?",
            section: "Computer Science",
            passage: false,
            options: ["Christopher Latham Sholes", "George Orville", "Isaac Newton", "Kurt Keplan"],
            correctAnswer: 0 // A
          },
          {
            question: "Page number in a document in MS Word can be inserted at:",
            section: "Computer Science",
            passage: false,
            options: ["Header", "Footer", "Both A and B", "None of these"],
            correctAnswer: 2 // C
          },
          {
            question: "In MS Excel 2016, we can go to cell A1 by pressing.",
            section: "Computer Science",
            passage: false,
            options: ["Ctrl + Home", "Home", "Shift + Home", "Alt + Home"],
            correctAnswer: 0 // A
          }
        ];
        
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let flaggedQuestions = new Set();
        let timerInterval;
        const totalTime = 60 * 60; 
        let timeLeft = totalTime;
        const AUTO_SAVE_INTERVAL = 10 * 1000; 

        const passwordScreen = document.getElementById('password-screen');
        const passwordInput = document.getElementById('password-input');
        const togglePassword = document.getElementById('toggle-password');
        const startButton = document.getElementById('start-button');
        const instructionsScreen = document.getElementById('instructions-screen');
        const beginTestButton = document.getElementById('begin-test-button');
        const testScreen = document.getElementById('test-screen');
        const questionSectionDisplay = document.getElementById('question-section'); 
        const readingPassageContainer = document.getElementById('reading-passage-container'); 
        const readingPassageText = document.getElementById('reading-passage-text'); 
        const questionContainer = document.getElementById('question-container');
        const optionsContainer = document.getElementById('options-container');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const submitTestButton = document.getElementById('submit-test-button');
        const questionCounter = document.getElementById('question-counter');
        const timerDisplay = document.getElementById('timer');
        const progressBar = document.getElementById('progress-bar');
        const flagButton = document.getElementById('flag-button');
        const questionPalette = document.getElementById('question-palette');
        const resultScreen = document.getElementById('result-screen');
        const finalScoreDisplay = document.getElementById('final-score');
        const totalMarksSummary = document.getElementById('total-marks-summary');
        const totalQuestionsSummary = document.getElementById('total-questions-summary');
        const attemptedQuestionsSummary = document.getElementById('attempted-questions-summary');
        const correctAnswersSummary = document.getElementById('correct-answers-summary');
        const incorrectAnswersSummary = document.getElementById('incorrect-answers-summary');
        const reviewAnswersButton = document.getElementById('review-answers-button');
        const printResultButton = document.getElementById('print-result-button'); 
        const retakeTestButton = document.getElementById('retake-test-button');
        const answerReviewContainer = document.getElementById('answer-review-container');
        const confirmSubmitModal = document.getElementById('confirm-submit-modal');
        const confirmSubmitYes = document.getElementById('confirm-submit-yes');
        const confirmSubmitNo = document.getElementById('confirm-submit-no');
        const reviewSummaryModal = document.getElementById('review-summary-modal');
        const summaryAnsweredCount = document.getElementById('summary-answered-count');
        const summaryNotAnsweredCount = document.getElementById('summary-not-answered-count');
        const summaryFlaggedCount = document.getElementById('summary-flagged-count');
        const unansweredFlaggedMessage = document.getElementById('unanswered-flagged-message');
        const summaryContinueTest = document.getElementById('summary-continue-test');
        const summarySubmitTest = document.getElementById('summary-submit-test');
        const loadingOverlay = document.getElementById('loading-overlay');
        const modeToggle = document.getElementById('mode-toggle');
        const toastContainer = document.getElementById('toast-container');

        const calculatorTrigger = document.getElementById('calculator-trigger');
        const calculatorTool = document.getElementById('calculator-tool');
        const calculatorDisplay = document.getElementById('calculator-display');
        const calculatorButtons = document.querySelectorAll('#calculator .button');
        const closeToolButtons = document.querySelectorAll('.close-btn');

        const scratchpadTrigger = document.getElementById('scratchpad-trigger');
        const scratchpadTool = document.getElementById('scratchpad-tool');
        const scratchpadTextarea = document.getElementById('scratchpad-textarea');

        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.classList.add('toast', type);
            toast.innerHTML = `<i class="fas ${getToastIcon(type)}"></i> ${message}`;
            toastContainer.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'toastOut 0.5s forwards';
                toast.addEventListener('animationend', () => { toast.remove(); });
            }, duration);
        }

        function getToastIcon(type) {
            switch (type) {
                case 'success': return 'fa-check-circle';
                case 'error': return 'fa-times-circle';
                case 'info': default: return 'fa-info-circle';
            }
        }

        function initializeQuiz() {
            resetQuizState();
            const totalQuestions = quizData.length;
            document.querySelector('#instructions-screen ul li:first-child span').innerHTML = `The test consists of <strong>${totalQuestions} Multiple Choice Questions (MCQs)</strong> across various sections.`;
            document.querySelector('#instructions-screen ul li:nth-child(2) span').innerHTML = `You have <strong>${totalTime / 60} minutes</strong> to complete the test. The timer will start once you begin.`;
            document.querySelector('#instructions-screen ul li:nth-child(3) span').innerHTML = `The passing score for this test is <strong>40 marks</strong>.`; 
            
            questionCounter.textContent = `Question: 1 / ${totalQuestions}`;
            totalMarksSummary.textContent = `/ ${totalQuestions} Marks`;
            totalQuestionsSummary.textContent = totalQuestions;

            renderQuestion();
            updatePalette();
            updateTimerDisplay(); 
            updateProgressBar();
            timerDisplay.classList.remove('time-low');
            updateNavigationButtons();
            startAutoSave();
        }

        function resetQuizState() {
            userAnswers = new Array(quizData.length).fill(null);
            flaggedQuestions = new Set();
            currentQuestionIndex = 0;
            timeLeft = totalTime;
            localStorage.removeItem('quizState'); 
            localStorage.removeItem('scratchpadContent'); 
            clearInterval(timerInterval); 
            stopAutoSave(); 
            resetTimerDisplay(); 
        }

        function saveQuizState() {
            const stateToSave = {
                currentQuestionIndex: currentQuestionIndex,
                userAnswers: userAnswers,
                flaggedQuestions: Array.from(flaggedQuestions), 
                timeLeft: timeLeft
            };
            localStorage.setItem('quizState', JSON.stringify(stateToSave));
        }

        function startAutoSave() {
            if (window.autoSaveInterval) { clearInterval(window.autoSaveInterval); }
            window.autoSaveInterval = setInterval(saveQuizState, AUTO_SAVE_INTERVAL);
        }

        function stopAutoSave() {
            if (window.autoSaveInterval) { clearInterval(window.autoSaveInterval); window.autoSaveInterval = null; }
        }

        function renderQuestion() {
            const question = quizData[currentQuestionIndex];
            questionSectionDisplay.textContent = `Section: ${question.section}`; 
            
            let contentHTML = `Q${currentQuestionIndex + 1}: ${question.question}`;
            if (question.visual) {
                contentHTML += `<div class="visual-container" style="display: flex; justify-content: center; margin: 20px 0;">${question.visual}</div>`;
            }
            
            questionContainer.innerHTML = contentHTML; 
            optionsContainer.innerHTML = ''; 

            if (question.passage) {
                readingPassageText.textContent = passage; 
                readingPassageContainer.classList.remove('hidden');
            } else {
                readingPassageContainer.classList.add('hidden');
            }

            question.options.forEach((optionText, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.classList.add('option');
                optionDiv.innerHTML = optionText; 
                optionDiv.dataset.index = index;
                if (userAnswers[currentQuestionIndex] === index) {
                    optionDiv.classList.add('selected');
                }
                optionDiv.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionDiv);
            });

            questionCounter.textContent = `Question: ${currentQuestionIndex + 1} / ${quizData.length}`;
            updateFlagButton();
            updatePalette();
            updateNavigationButtons(); 

            if (window.MathJax && window.MathJax.startup && window.MathJax.startup.promise) {
                window.MathJax.startup.promise.then(() => {
                    MathJax.typesetPromise([questionContainer, optionsContainer]);
                });
            }
        }

        function selectOption(selectedIndex) {
            userAnswers[currentQuestionIndex] = selectedIndex;
            renderQuestion(); 
            updatePalette();
            saveQuizState(); 
        }

        function navigateQuestions(direction) {
            if (direction === 'next' && currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
            } else if (direction === 'prev' && currentQuestionIndex > 0) {
                currentQuestionIndex--;
            }
            renderQuestion();
            saveQuizState(); 
        }

        function toggleFlag() {
            if (flaggedQuestions.has(currentQuestionIndex)) {
                flaggedQuestions.delete(currentQuestionIndex);
            } else {
                flaggedQuestions.add(currentQuestionIndex);
            }
            updateFlagButton();
            updatePalette();
            saveQuizState(); 
        }

        function updateFlagButton() {
            if (flaggedQuestions.has(currentQuestionIndex)) {
                flagButton.classList.add('flagged');
                flagButton.innerHTML = '<i class="fas fa-flag"></i> Flagged';
            } else {
                flagButton.classList.remove('flagged');
                flagButton.innerHTML = '<i class="fas fa-flag"></i> Flag for Review';
            }
        }

        function updatePalette() {
            questionPalette.innerHTML = '';
            let activeBtn = null; 

            quizData.forEach((_, index) => {
                const paletteBtn = document.createElement('button');
                paletteBtn.classList.add('palette-btn');
                paletteBtn.textContent = index + 1;
                if (index === currentQuestionIndex) {
                    paletteBtn.classList.add('current');
                    activeBtn = paletteBtn; 
                }
                if (userAnswers[index] !== null) {
                    paletteBtn.classList.add('answered');
                }
                if (flaggedQuestions.has(index)) {
                    paletteBtn.classList.add('flagged');
                } else if (userAnswers[index] === null) {
                    paletteBtn.classList.add('not-answered');
                }
                paletteBtn.addEventListener('click', () => {
                    currentQuestionIndex = index;
                    renderQuestion();
                });
                questionPalette.appendChild(paletteBtn);
            });

            if (activeBtn) {
                activeBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        }

        function startTimer() {
            stopAutoSave(); 
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                updateProgressBar();
                saveQuizState(); 

                if (timeLeft <= 300 && !timerDisplay.classList.contains('time-low')) { 
                    timerDisplay.classList.add('time-low');
                    showToast('Less than 5 minutes remaining!', 'warning');
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's Up!";
                    handleSubmitTest(true); 
                    showToast('Time is up! Test submitted automatically.', 'info');
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `Time Left: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function resetTimerDisplay() {
            const minutes = Math.floor(totalTime / 60);
            const seconds = totalTime % 60;
            timerDisplay.textContent = `Time Left: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function updateProgressBar() {
            const progress = ((totalTime - timeLeft) / totalTime) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function updateNavigationButtons() {
            if (currentQuestionIndex === 0) {
                prevButton.classList.add('hidden');
            } else {
                prevButton.classList.remove('hidden');
            }

            if (currentQuestionIndex === quizData.length - 1) {
                nextButton.classList.add('hidden');
                submitTestButton.classList.remove('hidden');
            } else {
                nextButton.classList.remove('hidden');
                submitTestButton.classList.add('hidden');
            }
        }

        function calculateResults() {
            let correctCount = 0;
            let attemptedCount = 0;

            userAnswers.forEach((answer, index) => {
                if (answer !== null) {
                    attemptedCount++;
                    if (answer === quizData[index].correctAnswer) {
                        correctCount++;
                    }
                }
            });

            return {
                correct: correctCount,
                attempted: attemptedCount,
                incorrect: attemptedCount - correctCount,
                total: quizData.length
            };
        }

        function showResultScreen(results) {
            testScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            clearInterval(timerInterval); 
            stopAutoSave(); 

            finalScoreDisplay.textContent = results.correct;
            totalQuestionsSummary.textContent = results.total;
            attemptedQuestionsSummary.textContent = results.attempted;
            correctAnswersSummary.textContent = results.correct;
            incorrectAnswersSummary.textContent = results.incorrect;
            totalMarksSummary.textContent = `/ ${results.total} Marks`;

            const passingMarks = 40; 
            const passFailStatus = document.getElementById('pass-fail-status');
            if (results.correct >= passingMarks) {
                passFailStatus.textContent = "Pass";
                passFailStatus.style.color = "var(--secondary-color)"; 
            } else {
                passFailStatus.textContent = "Fail";
                passFailStatus.style.color = "var(--danger-color)"; 
            }

            localStorage.removeItem('quizState');
            localStorage.removeItem('scratchpadContent'); 
        }

        function reviewAnswers() {
            answerReviewContainer.innerHTML = '';
            answerReviewContainer.classList.remove('hidden'); 

            quizData.forEach((question, index) => {
                const qDiv = document.createElement('div');
                qDiv.classList.add('result-question');

                const qText = document.createElement('p');
                qText.innerHTML = `Q${index + 1}: ${question.question}`; 
                
                if (question.visual) {
                    qText.innerHTML += `<div class="visual-container" style="display: flex; justify-content: center; margin: 20px 0;">${question.visual}</div>`;
                }
                
                qDiv.appendChild(qText);

                question.options.forEach((option, optionIndex) => {
                    const optionP = document.createElement('p');
                    optionP.classList.add('result-option');
                    const optionTextSpan = document.createElement('span');
                    optionTextSpan.innerHTML = `${String.fromCharCode(65 + optionIndex)}. ${option}`; 
                    optionP.appendChild(optionTextSpan);

                    if (optionIndex === question.correctAnswer) {
                        optionP.classList.add('correct');
                    }

                    if (userAnswers[index] === optionIndex) {
                        optionP.classList.add('user-answer');
                        if (userAnswers[index] !== question.correctAnswer) {
                            optionP.classList.add('incorrect');
                        }
                    }
                    qDiv.appendChild(optionP);
                });

                if (userAnswers[index] === null) {
                    const notAttemptedP = document.createElement('p');
                    notAttemptedP.classList.add('not-attempted-text');
                    notAttemptedP.textContent = 'Not Attempted';
                    qDiv.appendChild(notAttemptedP);
                }

                answerReviewContainer.appendChild(qDiv);
            });
            reviewAnswersButton.classList.add('hidden'); 
            printResultButton.classList.add('hidden'); 
            answerReviewContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });

            if (window.MathJax && window.MathJax.startup && window.MathJax.startup.promise) {
                window.MathJax.startup.promise.then(() => {
                    MathJax.typesetPromise([answerReviewContainer]);
                });
            }
        }

        function printResult() {
            if (answerReviewContainer.classList.contains('hidden')) {
                reviewAnswers();
            }

            const header = document.querySelector('.page-header');
            const footer = document.querySelector('.page-footer');
            const toolTriggers = document.querySelectorAll('.floating-tool-trigger');
            const controls = document.querySelector('#result-screen .controls');

            header.classList.add('hidden');
            footer.classList.add('hidden');
            toolTriggers.forEach(el => el.classList.add('hidden'));
            if (controls) controls.classList.add('hidden');

            window.print();

            setTimeout(() => {
                header.classList.remove('hidden');
                footer.classList.remove('hidden');
                toolTriggers.forEach(el => el.classList.remove('hidden'));
                if (controls) controls.classList.remove('hidden');
                reviewAnswersButton.classList.remove('hidden');
                printResultButton.classList.remove('hidden');
            }, 500); 
        }

        startButton.addEventListener('click', () => {
            if (passwordInput.value === PASSWORD) {
                passwordScreen.classList.add('hidden');
                instructionsScreen.classList.remove('hidden');
                showToast('Password correct! Welcome to the test.', 'success');
            } else {
                showToast('Incorrect password. Please try again.', 'error');
                passwordInput.value = '';
            }
        });

        togglePassword.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            togglePassword.querySelector('i').classList.toggle('fa-eye');
            togglePassword.querySelector('i').classList.toggle('fa-eye-slash');
        });

        beginTestButton.addEventListener('click', () => {
            instructionsScreen.classList.add('hidden');
            testScreen.classList.remove('hidden');
            initializeQuiz(); 
            startTimer();
            loadScratchpadContent(); 
            showToast('Test started! Good luck.', 'info');
        });

        prevButton.addEventListener('click', () => navigateQuestions('prev'));
        nextButton.addEventListener('click', () => navigateQuestions('next'));
        flagButton.addEventListener('click', toggleFlag);

        submitTestButton.addEventListener('click', () => {
            const answeredCount = userAnswers.filter(answer => answer !== null).length;
            const notAnsweredCount = quizData.length - answeredCount;
            const flaggedCount = flaggedQuestions.size;

            summaryAnsweredCount.textContent = answeredCount;
            summaryNotAnsweredCount.textContent = notAnsweredCount;
            summaryFlaggedCount.textContent = flaggedCount;

            if (notAnsweredCount > 0 || flaggedCount > 0) {
                let message = "You still have ";
                if (notAnsweredCount > 0) {
                    message += `${notAnsweredCount} unanswered questions`;
                }
                if (notAnsweredCount > 0 && flaggedCount > 0) {
                    message += " and ";
                }
                if (flaggedCount > 0) {
                    message += `${flaggedCount} flagged questions`;
                }
                message += ".";
                unansweredFlaggedMessage.textContent = message;
                reviewSummaryModal.classList.remove('hidden');
            } else {
                confirmSubmitModal.classList.remove('hidden');
            }
        });

        confirmSubmitYes.addEventListener('click', () => handleSubmitTest(false)); 
        confirmSubmitNo.addEventListener('click', () => confirmSubmitModal.classList.add('hidden'));

        summaryContinueTest.addEventListener('click', () => reviewSummaryModal.classList.add('hidden'));
        summarySubmitTest.addEventListener('click', () => {
            reviewSummaryModal.classList.add('hidden');
            handleSubmitTest(false); 
        });

        function handleSubmitTest(isTimeUp) {
            confirmSubmitModal.classList.add('hidden'); 
            reviewSummaryModal.classList.add('hidden'); 

            const results = calculateResults();
            showResultScreen(results);

            if (isTimeUp) {
                showToast("Time's up! Test submitted automatically.", 'info');
            } else {
                showToast('Test submitted successfully!', 'success');
            }
        }

        reviewAnswersButton.addEventListener('click', reviewAnswers);
        printResultButton.addEventListener('click', printResult); 

        retakeTestButton.addEventListener('click', () => {
            resultScreen.classList.add('hidden');
            passwordScreen.classList.remove('hidden');
            answerReviewContainer.classList.add('hidden'); 
            reviewAnswersButton.classList.remove('hidden'); 
            printResultButton.classList.remove('hidden'); 
            passwordInput.value = ''; 
            resetQuizState(); 
            showToast('Test reset. Ready to retake!', 'info');
        });

        modeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const icon = modeToggle.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('darkMode', 'enabled');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('darkMode', 'disabled');
            }
        });

        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            modeToggle.querySelector('i').classList.remove('fa-moon');
            modeToggle.querySelector('i').classList.add('fa-sun');
        } else {
            document.body.classList.remove('dark-mode');
            modeToggle.querySelector('i').classList.remove('fa-sun');
            modeToggle.querySelector('i').classList.add('fa-moon');
        }

        const calculator = {
            displayValue: '0',
            firstOperand: null,
            waitingForSecondOperand: false,
            operator: null,
        };

        function updateDisplay() {
            calculatorDisplay.textContent = calculator.displayValue;
        }

        function inputDigit(digit) {
            const { displayValue, waitingForSecondOperand } = calculator;

            if (waitingForSecondOperand === true) {
                calculator.displayValue = digit;
                calculator.waitingForSecondOperand = false;
            } else {
                calculator.displayValue = displayValue === '0' ? digit : displayValue + digit;
            }
            updateDisplay();
        }

        function inputDecimal(dot) {
            if (calculator.waitingForSecondOperand === true) {
                calculator.displayValue = '0.';
                calculator.waitingForSecondOperand = false;
                updateDisplay();
                return;
            }
            if (!calculator.displayValue.includes(dot)) {
                calculator.displayValue += dot;
            }
            updateDisplay();
        }

        function handleOperator(nextOperator) {
            const { firstOperand, displayValue, operator } = calculator;
            const inputValue = parseFloat(displayValue);

            if (operator && calculator.waitingForSecondOperand) {
                calculator.operator = nextOperator;
                return;
            }

            if (firstOperand === null) {
                calculator.firstOperand = inputValue;
            } else if (operator) {
                const result = performCalculation[operator](firstOperand, inputValue);
                if (result === 'Error') {
                    calculator.displayValue = 'Error';
                    calculator.firstOperand = null;
                    calculator.operator = null;
                    calculator.waitingForSecondOperand = false;
                    updateDisplay();
                    return;
                }
                calculator.displayValue = String(parseFloat(result.toFixed(7))); 
                calculator.firstOperand = parseFloat(calculator.displayValue);
            }

            calculator.waitingForSecondOperand = true; 
            calculator.operator = nextOperator; 
            updateDisplay();
        }

        function clearCalculator() {
            calculator.displayValue = '0';
            calculator.firstOperand = null;
            calculator.waitingForSecondOperand = false;
            calculator.operator = null;
            updateDisplay();
        }

        calculatorButtons.forEach(button => {
            button.addEventListener('click', event => {
                const { target } = event;

                if (!target.matches('button')) {
                    return;
                }

                if (target.classList.contains('operator')) {
                    const operatorValue = target.dataset.operator; 
                    if (operatorValue === '=') {
                        calculateResultCalc();
                    } else {
                        handleOperator(operatorValue);
                    }
                    return;
                }

                if (target.classList.contains('decimal')) {
                    inputDecimal(target.textContent);
                    return;
                }

                if (target.classList.contains('clear-btn')) {
                    clearCalculator();
                    return;
                }

                if (target.classList.contains('percentage')) {
                    calculator.displayValue = String(parseFloat(calculator.displayValue) / 100);
                    calculator.firstOperand = null; 
                    calculator.waitingForSecondOperand = false;
                    updateDisplay();
                    return;
                }

                if (target.classList.contains('plus-minus')) {
                    calculator.displayValue = String(parseFloat(calculator.displayValue) * -1);
                    updateDisplay();
                    return;
                }

                inputDigit(target.textContent);
            });
        });

        const performCalculation = {
            '/': (firstOperand, secondOperand) => secondOperand === 0 ? 'Error' : firstOperand / secondOperand,
            '*': (firstOperand, secondOperand) => firstOperand * secondOperand,
            '+': (firstOperand, secondOperand) => firstOperand + secondOperand,
            '-': (firstOperand, secondOperand) => firstOperand - secondOperand,
        };

        function calculateResultCalc() {
            const inputValue = parseFloat(calculator.displayValue);

            if (calculator.firstOperand === null || calculator.operator === null || calculator.waitingForSecondOperand) {
                return;
            }

            const result = performCalculation[calculator.operator](calculator.firstOperand, inputValue);
            if (result === 'Error') {
                calculator.displayValue = 'Error';
            } else {
                calculator.displayValue = String(parseFloat(result.toFixed(7))); 
            }

            calculator.firstOperand = null; 
            calculator.operator = null; 
            calculator.waitingForSecondOperand = false; 
            updateDisplay();
        }

        function saveScratchpadContent() {
            localStorage.setItem('scratchpadContent', scratchpadTextarea.value);
        }

        function loadScratchpadContent() {
            const savedContent = localStorage.getItem('scratchpadContent');
            if (savedContent) {
                scratchpadTextarea.value = savedContent;
            } else {
                scratchpadTextarea.value = ''; 
            }
        }

        scratchpadTextarea.addEventListener('input', saveScratchpadContent);
        closeToolButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const toolType = event.currentTarget.dataset.tool;
                if (toolType === 'scratchpad') {
                    saveScratchpadContent();
                    scratchpadTool.classList.add('hidden');
                } else if (toolType === 'calculator') {
                    calculatorTool.classList.add('hidden');
                }
            });
        });

        function makeDraggable(element, header) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            if (header) {
                header.onmousedown = dragMouseDown;
            } else {
                element.onmousedown = dragMouseDown;
            }

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        makeDraggable(calculatorTool, calculatorTool.querySelector('.floating-tool-header'));
        makeDraggable(scratchpadTool, scratchpadTool.querySelector('.floating-tool-header'));

        calculatorTrigger.addEventListener('click', () => {
            calculatorTool.classList.toggle('hidden');
            scratchpadTool.classList.add('hidden');
        });

        scratchpadTrigger.addEventListener('click', () => {
            scratchpadTool.classList.toggle('hidden');
            calculatorTool.classList.add('hidden');
        });

        document.addEventListener('DOMContentLoaded', () => {
            resetQuizState();
        });

        window.addEventListener('beforeunload', () => {
            if (!testScreen.classList.contains('hidden')) {
                saveQuizState();
                saveScratchpadContent();
            }
        });
    </script>
</body>
</html>
