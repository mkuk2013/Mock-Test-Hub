<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBA STS Junior Science Teacher Mock Test 4</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            /* Global Colors (Light Mode Defaults) */
            --background-color: #f0f2f5;
            --text-color: #333;
            --card-background: rgba(255, 255, 255, 0.9);
            --input-background: rgba(240, 240, 240, 0.8);
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.1);

            /* Action & State Colors (Light Mode) */
            --primary-color: #4A90E2; /* For current, buttons */
            --primary-color-rgb: 74, 144, 226;
            --success-color: #7ED321; /* For answered, correct */
            --secondary-color: #50E3C2; /* For marked for review */
            --danger-color: #D0021B; /* For incorrect */
            --warning-color: #F8E71C; /* For warnings, restart */
            --text-on-warning: #333;

            /* Specific Palette/Legend Colors (Light Mode) */
            --unattempted-color: #E0E6EB; /* Clearly distinct light grey */
            --answered-reviewed-color: #9C27B0; /* Distinct purple */

            /* Progress Bar */
            --progress-bar-bg: #e0e0e0;
            --progress-bar-fill: var(--primary-color);
        }

        .dark-mode {
            /* Global Colors (Dark Mode) */
            --background-color: #2C3E50; /* Deep blue-grey */
            --text-color: #ECF0F1; /* Light grey text */
            --card-background: rgba(30, 40, 50, 0.9); /* Slightly transparent, darker card */
            --input-background: rgba(50, 60, 70, 0.8); /* Darker input fields */
            --border-color: rgba(255, 255, 255, 0.1); /* Subtle white border */
            --shadow-color: rgba(0, 0, 0, 0.4);

            /* Action & State Colors (Dark Mode) */
            --primary-color: #4FC3F7; /* Brighter blue for current, buttons */
            --primary-color-rgb: 79, 195, 247;
            --success-color: #69F0AE; /* Brighter green for answered, correct */
            --secondary-color: #00BCD4; /* Vibrant cyan for marked for review */
            --danger-color: #FF5252; /* Bright red for incorrect */
            --warning-color: #FFC107; /* Amber for warnings, restart */
            --text-on-warning: #333;

            /* Specific Palette/Legend Colors (Dark Mode) */
            --unattempted-color: #B0BEC5; /* Light blue-grey, very visible */
            --answered-reviewed-color: #E040FB; /* Striking purple */

            /* Progress Bar */
            --progress-bar-bg: #4A6572;
            --progress-bar-fill: var(--primary-color);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease, color 0.3s ease;
            overflow-y: auto;
        }

        .container {
            background: var(--card-background);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px 0 var(--shadow-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 30px;
            max-width: 900px;
            width: 100%;
            text-align: center;
            position: relative;
            margin: 20px 0;
        }

        h1 {
            color: var(--text-color);
            margin-bottom: 25px;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
            padding: 20px;
        }

        .password-prompt {
            background: var(--card-background);
            border-radius: 15px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(15px);
            padding: 40px;
            box-shadow: 0 8px 32px 0 var(--shadow-color);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        .password-prompt input[type="password"] {
            width: calc(100% - 20px);
            padding: 12px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--input-background);
            color: var(--text-color);
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }

        .password-prompt input[type="password"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.2);
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease, transform 0.2s ease, opacity 0.3s ease;
            margin: 5px;
            font-weight: 600;
        }

        .btn:hover:not(:disabled) {
            background-color: color-mix(in srgb, var(--primary-color) 85%, black); /* Slightly darker */
            transform: translateY(-2px);
        }
        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: color-mix(in srgb, var(--primary-color) 60%, black);
        }

        .error-message {
            color: var(--danger-color);
            margin-top: 10px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .quiz-section {
            display: none;
            animation: fadeIn 0.8s ease-out;
        }

        .quiz-header {
            display: flex;
            justify-content: center; /* Center its content */
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .timer {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--danger-color); /* Make timer red */
            padding: 5px 15px;
            background: var(--input-background);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            flex-shrink: 0;
            margin: 0 auto; /* Center horizontally */
        }
        .timer i {
            margin-right: 8px;
            font-size: 1.2em;
        }

        .progress-bar-container {
            width: 100%;
            height: 10px;
            background-color: var(--progress-bar-bg);
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background-color: var(--progress-bar-fill);
            border-radius: 5px;
            transition: width 0.3s ease-in-out;
        }

        .question-container {
            text-align: left;
            margin-bottom: 30px;
        }

        .question-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
        }

        .question-number {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.6;
            font-weight: 400;
        }

        /* New style for the passage container */
        .passage-container {
            background: var(--input-background);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: left;
            line-height: 1.6;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        .passage-container p {
            margin-bottom: 10px;
        }
        .passage-container p:last-child {
            margin-bottom: 0;
        }


        .options label {
            display: block;
            background: var(--input-background);
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid transparent;
            font-size: 1rem;
            display: flex;
            align-items: center;
            position: relative;
        }

        .options label:hover {
            background: rgba(var(--primary-color-rgb), 0.1);
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(var(--primary-color-rgb), 0.1);
        }

        .options input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.2);
            accent-color: var(--primary-color);
        }

        .mark-for-review {
            display: flex;
            align-items: center;
            margin-top: 15px;
            font-size: 0.95rem;
            color: var(--text-color);
        }
        .mark-for-review input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.1);
            accent-color: var(--secondary-color);
        }

        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .quiz-navigation button {
            flex: 1;
            margin: 5px;
            min-width: 120px;
        }

        .submit-quiz-final-btn {
            background-color: var(--success-color);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease, opacity 0.3s ease;
            margin: 5px;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
            display: none; /* Hidden by default */
        }

        .submit-quiz-final-btn:hover {
            background-color: color-mix(in srgb, var(--success-color) 85%, black);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.4);
        }

        .submit-quiz-final-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.2);
        }
        .submit-quiz-final-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: color-mix(in srgb, var(--success-color) 60%, black);
            box-shadow: none;
        }


        .results-section {
            display: none;
            text-align: left;
            animation: fadeIn 0.8s ease-out;
        }

        .results-section h2 {
            text-align: center;
            margin-bottom: 25px;
            color: var(--primary-color);
            font-weight: 700;
        }

        .score-summary {
            margin-bottom: 30px; /* Add some space below summary */
        }
        .score-summary p {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 400;
        }

        .score-summary strong {
            color: var(--primary-color);
            font-weight: 600;
        }

        .answer-review-panel {
            margin-top: 30px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .answer-review-panel h3 {
            margin-bottom: 20px;
            text-align: center;
            color: var(--primary-color);
            font-weight: 600;
        }

        .review-item {
            background: var(--input-background);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }

        .review-item p {
            margin-bottom: 8px;
            line-height: 1.5;
            font-weight: 400;
        }

        .review-item strong {
            font-weight: 600;
        }

        .review-item .correct-answer {
            color: var(--success-color);
        }

        .review-item .your-answer {
            color: var(--danger-color);
        }

        .review-item .your-answer.correct {
            color: var(--success-color);
        }
        /* Style for Not Attempted in review */
        .review-item .your-answer.not-attempted {
            color: var(--text-color); /* Default text color for clarity */
            font-style: italic;
        }


        /* Positioned after score summary, before review panel */
        .results-actions { /* Renamed for clarity, combines top and bottom needs */
            display: flex;
            justify-content: center;
            margin-top: 20px; /* Space above buttons */
            margin-bottom: 30px; /* Space below buttons before review starts */
            flex-wrap: wrap;
            padding-bottom: 15px; /* Add padding at the bottom of the action block */
            border-bottom: 1px dashed var(--border-color); /* Add a separator */
        }
        .results-actions .btn {
            margin: 5px;
        }


        .print-save-btn {
            background-color: var(--secondary-color);
        }

        .print-save-btn:hover:not(:disabled) {
            background-color: color-mix(in srgb, var(--secondary-color) 85%, black);
        }

        .restart-btn {
            background-color: var(--warning-color);
            color: var(--text-on-warning);
        }

        .restart-btn:hover:not(:disabled) {
            background-color: color-mix(in srgb, var(--warning-color) 85%, black);
        }

        .mode-toggle {
            background: var(--input-background);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 5px var(--shadow-color);
            transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            z-index: 50;
            flex-shrink: 0;
        }

        .mode-toggle .icon {
            font-size: 1.5rem;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        /* Question Palette */
        .question-palette-panel {
            width: 100%;
            padding: 15px 0;
            background: var(--card-background);
            border-top: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 -4px 15px var(--shadow-color);
            margin-top: 30px;
            border-radius: 0 0 20px 20px;
        }
        .question-palette-panel h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-weight: 700;
            text-align: center;
        }
        .question-grid {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 0 10px;
            gap: 8px;
            justify-content: flex-start;
            padding-bottom: 10px;
        }
        .question-grid-item {
            flex-shrink: 0;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--unattempted-color); /* Default unattempted color */
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.2s ease, color 0.2s ease;
            color: var(--text-color); /* Default text color for unattempted */
        }
        .dark-mode .question-grid-item {
            color: var(--text-color); /* Ensure text is visible on dark unattempted */
        }

        .question-grid-item:hover {
            background-color: rgba(var(--primary-color-rgb), 0.15);
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        /* Specific states for palette items */
        .question-grid-item.current {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(var(--primary-color-rgb), 0.3);
        }
        .question-grid-item.answered {
            background-color: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }
        .question-grid-item.reviewed {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        .question-grid-item.answered.reviewed {
            background-color: var(--answered-reviewed-color);
            color: white;
            border-color: var(--answered-reviewed-color);
        }

        /* Custom Scrollbar for horizontal palette */
        .question-grid::-webkit-scrollbar {
            height: 8px;
        }
        .question-grid::-webkit-scrollbar-track {
            background: var(--progress-bar-bg);
            border-radius: 10px;
        }
        .question-grid::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        .question-grid::-webkit-scrollbar-thumb:hover {
            background: color-mix(in srgb, var(--primary-color) 80%, black);
        }


        .palette-legend {
            margin-top: 20px;
            text-align: center;
            font-size: 0.9rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            padding: 0 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            color: var(--text-color);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
            margin-right: 8px;
            border: 1px solid var(--border-color);
        }
        .dark-mode .legend-color {
            border: 1px solid rgba(255, 255, 255, 0.4);
        }


        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .password-prompt {
                padding: 30px;
            }

            .password-prompt input[type="password"] {
                font-size: 0.9rem;
            }

            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .quiz-header {
                flex-direction: column;
                align-items: center;
                padding-bottom: 15px;
                margin-bottom: 20px;
            }

            .timer {
                margin-top: 10px;
                font-size: 1.3rem;
            }

            .question-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .question-number {
                margin-bottom: 10px;
            }

            .mode-toggle {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
                position: static;
                transform: none;
                align-self: flex-end;
                margin-top: 10px;
            }


            .question-text {
                font-size: 1rem;
            }

            .options label {
                padding: 12px;
                font-size: 0.9rem;
            }

            .quiz-navigation {
                flex-direction: column;
            }

            .quiz-navigation button {
                width: 100%;
                margin: 5px 0;
            }

            .question-palette-panel {
                padding: 10px 0;
            }
            .question-grid {
                padding: 0 5px;
                gap: 5px;
            }
            .question-grid-item {
                width: 40px;
                height: 40px;
                font-size: 0.9rem;
            }
            .palette-legend {
                gap: 10px;
                padding: 0 5px;
            }
            .legend-item {
                font-size: 0.85rem;
            }
            .legend-color {
                width: 18px;
                height: 18px;
            }
            .results-actions {
                flex-direction: column; /* Stack buttons vertically on small screens */
            }
            .results-actions .btn {
                width: 100%; /* Full width for buttons */
            }
        }
        /* For Print Media */
        @media print {
            body {
                background: white !important;
                color: black !important;
                display: block;
                padding: 0;
                margin: 0;
            }
            .container, .password-overlay, .quiz-section, .question-palette-panel,
            .mode-toggle, .quiz-navigation, .progress-bar-container,
            .mark-for-review {
                display: none !important;
            }
            .results-section {
                display: block !important;
                position: static !important;
                width: auto !important;
                max-width: none !important;
                padding: 20mm !important;
                box-shadow: none !important;
                backdrop-filter: none !important;
                border: none !important;
                background: white !important;
                color: black !important;
            }
            .results-section h2, .score-summary p, .answer-review-panel h3, .review-item p {
                color: black !important;
            }
            .review-item .correct-answer {
                color: #28a745 !important;
            }
            .review-item .your-answer {
                color: #dc3545 !important;
            }
            .review-item .your-answer.correct {
                color: #28a745 !important;
            }
            /* Print style for Not Attempted */
            .review-item .your-answer.not-attempted {
                color: #555 !important; /* A darker grey for clarity in print */
                font-style: italic !important;
            }

            .review-item {
                background: #f8f8f8 !important;
                border: 1px solid #eee !important;
                box-shadow: none !important;
            }
            /* Ensure results-actions are visible for print, but styled appropriately */
            .results-actions {
                display: flex !important; /* Make sure they display */
                justify-content: center !important;
                margin-top: 15px !important; /* Adjust margin for print */
                margin-bottom: 20px !important; /* Adjust margin for print */
                padding-bottom: 10px !important;
                border-bottom: 1px dashed #ccc !important; /* Visual separator */
            }
            .results-actions .btn {
                background-color: #f0f0f0 !important; /* Lighter background for print */
                color: #333 !important; /* Darker text */
                border: 1px solid #ccc !important;
                box-shadow: none !important;
                transform: none !important;
                opacity: 1 !important;
                cursor: default !important;
            }
        }
        .quiz-footer {
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-color);
            background: var(--card-background); /* Match container background */
            border-radius: 0 0 20px 20px; /* Match bottom border radius of container */
        }

        .quiz-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .quiz-footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="password-overlay" id="passwordOverlay">
        <div class="password-prompt">
            <h2>Enter Password to Start Mock Test</h2>
            <input type="password" id="passwordInput" placeholder="Enter password">
            <button class="btn" id="passwordSubmitBtn">Submit</button>
            <p class="error-message" id="passwordError"></p>
        </div>
    </div>

    <div class="container">
        <h1>IBA STS Junior Science Teacher Mock Test 5</h1>

        <div class="quiz-section" id="quizSection">
            <div class="progress-bar-container">
                <div class="progress-bar-fill" id="progressBarFill"></div>
            </div>
            <div class="quiz-header">
                <div class="timer"><i class="far fa-clock"></i> Time Left: <span id="timeLeft">50:00</span></div>
            </div>

            <div class="question-container">
                <div class="question-meta">
                    <p class="question-number">Question <span id="currentQuestionNumber">1</span> of <span id="totalQuestions"></span></p>
                    <div class="mode-toggle" id="modeToggle">
                        <span class="icon">☀️</span>
                    </div>
                </div>
                <!-- Passage container will be inserted here dynamically for questions 1-5 -->
                <div id="passageDisplay" class="passage-container" style="display: none;"></div>
                <h2 class="question-text" id="questionText"></h2>
                <div class="options" id="optionsContainer">
                    </div>
                <div class="mark-for-review">
                    <input type="checkbox" id="markForReviewCheckbox">
                    <label for="markForReviewCheckbox">Mark for Review</label>
                </div>
            </div>

            <div class="quiz-navigation">
                <button class="btn" id="prevBtn">Previous</button>
                <button class="btn" id="nextBtn">Next</button>
                <button class="submit-quiz-final-btn" id="submitQuizFinalBtn">Submit Quiz</button>
            </div>

            <div class="question-palette-panel" id="questionPalettePanel">
                <h3><i class="fas fa-palette"></i> Question Palette</h3>
                <div class="question-grid" id="questionGrid">
                    </div>
                <div class="palette-legend">
                    <div class="legend-item"><span class="legend-color" data-color-type="current"></span> Current</div>
                    <div class="legend-item"><span class="legend-color" data-color-type="answered"></span> Answered</div>
                    <div class="legend-item"><span class="legend-color" data-color-type="marked"></span> Marked for Review</div>
                    <div class="legend-item"><span class="legend-color" data-color-type="unattempted"></span> Unattempted</div>
                    <div class="legend-item"><span class="legend-color" data-color-type="answered-reviewed"></span> Answered & Reviewed</div>
                </div>
            </div>
        </div>

        <div class="results-section" id="resultsSection">
            <h2>Mock Test Results</h2>
            <div class="score-summary">
                <p>Total Questions: <strong id="resTotalQuestions"></strong></p>
                <p>Attempted: <strong id="resAttempted"></strong></p>
                <p>Correct Answers: <strong id="resCorrectAnswers"></strong></p>
                <p>Incorrect Answers: <strong id="resIncorrectAnswers"></strong></p>
                <p>Your Score: <strong id="resScore"></strong>%</p>
            </div>

            <div class="results-actions" id="resultsActions">
                <button class="btn print-save-btn" id="printSaveBtn">Print / Save as PDF</button>
                <button class="btn restart-btn" id="restartQuizBtn">Restart Quiz</button>
            </div>

            <div class="answer-review-panel">
                <h3>Answer Review</h3>
                <div id="reviewItemsContainer">
                    </div>
            </div>
        </div>
        <footer class="quiz-footer">
            <p>JST Mock Test Series Created By <a href="https://facebook.com/innoxent.mukesh">Mukesh Kumar</a></p>
        </footer>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        // Simple obfuscation: XOR cipher with a key
        const passwordKey = 123; // A simple numeric key for XOR

        function obfuscate(str) {
            return str.split('').map(char => String.fromCharCode(char.charCodeAt(0) ^ passwordKey)).join('');
        }

        const actualEncryptedPassword = obfuscate('ibajst2025');

        // Note: For real security, this is NOT sufficient. This only prevents casual inspection.
        // A determined user can still find the de-obfuscation logic in client-side JS.
        // Server-side authentication is required for true security.

        // Define the passage as a separate constant
        const passageForFirstFiveQuestions = `
            <p>Read the following passage carefully & answer the questions (1 – 10):</p>
            <p style="text-align:justify">Caliph Haroon-Ur-Rasheed was a wise Muslim king of Baghdad.
One day, when he was holding court, Qazi of the city brought up a disputed case.
Two people claimed a horse.
One was a beggar, while the other was a rich man.
Qazi was unable to decide the case, so he brought it before the caliph for a decision.
The Caliph asked the rich man to present facts.
The rich man told him that while he was riding to the city on the horse, the lame fellow requested him to lift him up to the city gate.
When they reached the city gate, the beggar refused to get down and claimed that the horse was his.
Then the beggar told his story.
As he rode the horse to the city that morning, he said that the rich man tried to borrow his horse.
As he was a stranger to him, he could not lend him his horse, so he gave him a ride up to the city gate.
On reaching the city gate, the rich man refused to get down and claimed that the horse was his.
The Caliph asked them to touch the horse one by one.
At first, the beggar touched the horse.
On his touch, it winced; the horse expressed its pleasure by neighing when the rich man touched it.
The caliph made his decision that the horse belonged to the rich man.</p>
        `;

const questions = [
  // --- English (Vocabulary) ---
  {
    question: "1. The similar meaning of the word 'wise' is?",
    options: ["Foolish", "Clever", "Angry", "Weak"],
    answer: "Clever",
    section: "English (Vocabulary)"
  },
  {
    question: "2. The similar meaning of the word 'dispute' is?",
    options: ["Agreement", "Friendship", "Clash", "Silence"],
    answer: "Clash",
    section: "English (Vocabulary)"
  },
  {
    question: "3. The similar meaning of the word 'rich' is?",
    options: ["Poor", "Wealthy", "Simple", "Kind"],
    answer: "Wealthy",
    section: "English (Vocabulary)"
  },
  {
    question: "4. The opposite meaning of the word 'refuse' is?",
    options: ["Deny", "Forbid", "Allow", "Disagree"],
    answer: "Allow",
    section: "English (Vocabulary)"
  },
  {
    question: "5. The opposite meaning of the word 'pleasure' is?",
    options: ["Happiness", "Laughter", "Sorrow", "Smile"],
    answer: "Sorrow",
    section: "English (Vocabulary)"
  },

  // --- English (Passage-Based) ---
  {
    question: "6. The horse's reaction when the rich man touched it ______?",
    options: ["Neighod A. Slept", "Ran away", "Neighed", "Winced"],
    answer: "Neighed",
    section: "English (Passage-Based)"
  },
  {
    question: "7. The horse's reaction when the beggar touched it ______?",
    options: ["Winced A. Neighed", "Slept", "Winced", "Jumped"],
    answer: "Winced",
    section: "English (Passage-Based)"
  },
  {
    question: "8. The Muslim king of Baghdad was ______?",
    options: ["Caliph Umar", "Caliph Usman", "Caliph Haroon-Ur-Rasheed", "Caliph Ali"],
    answer: "Caliph Haroon-Ur-Rasheed",
    section: "English (Passage-Based)"
  },
  {
    question: "9. The disputed case brought before the Caliph was about ______?",
    options: ["A garden", "A house", "Ownership of a horse", "A camel"],
    answer: "Ownership of a horse",
    section: "English (Passage-Based)"
  },
  {
    question: "10. The role of the Qazi of the city in the story was ______?",
    options: ["Gave decision himself", "Punished the beggar", "Brought the disputed case", "Took the horse"],
    answer: "Brought the disputed case",
    section: "English (Passage-Based)"
  },

  // --- General Science, Biology, Chemistry and Physics ---
  {
    question: "11. In Fahrenheit scale the boiling point of water is ______?",
    options: ["208°F", "210°F", "212°F", "214°F"],
    answer: "212°F",
    section: "Science (Physics)"
  },
  {
    question: "12. Rabbit feed on seeds and leaves that's why it is called as ______?",
    options: ["Carnivore", "Herbivore", "Carnivore", "None of these"],
    answer: "Herbivore",
    section: "Science (Biology)"
  },
  {
    question: "13. Tearing teeth present in human are ______?",
    options: ["Incisors", "Premol", "Canines", "None of these"],
    answer: "Canines",
    section: "Science (Biology)"
  },
  {
    question: "14. 6°F corresponds to ______?",
    options: ["55°C", "42°C", "37°C", "None of these"],
    answer: "None of these", // Corrected as 6°F is approx -14.4°C
    section: "Science (Physics)"
  },
  {
    question: "15. The largest organ in human with respect to surface area is?",
    options: ["Organs", "Skeleton", "Skin", "Muscles"],
    answer: "Skin",
    section: "Science (Biology)"
  },
  {
    question: "16. The major source of quick energy for our body is?",
    options: ["Carbohydrates", "Mineral", "Vitamin", "Protein"],
    answer: "Carbohydrates",
    section: "Science (Biology)"
  },
  {
    question: "17. Kwashiorkor and marasmus are diseases caused by deficiency of which one of the following?",
    options: ["Protein", "Vitamin", "Mineral", "None of these"],
    answer: "Protein",
    section: "Science (Biology)"
  },
  {
    question: "18. How many muscles are there in the human body?",
    options: ["638", "641", "639", "637"],
    answer: "639",
    section: "Science (Biology)"
  },
  {
    question: "19. How many bones in human body?",
    options: ["200", "206", "270", "300"],
    answer: "206",
    section: "Science (Biology)"
  },
  {
    question: "20. In Fahrenheit scale the freezing point of water is ______?",
    options: ["30°F", "32°F", "34°F", "100°F"],
    answer: "32°F",
    section: "Science (Physics)"
  },
  {
    question: "21. How many states of matters are there?",
    options: ["1", "2", "3", "4"],
    answer: "4", // Solid, Liquid, Gas, Plasma
    section: "Science (Physics)"
  },
  {
    question: "22. Severe deficiency of Vitamin B complex results in?",
    options: ["Night Blindness", "Rickets", "Beriberi", "Scurvy"],
    answer: "Beriberi",
    section: "Science (Biology)"
  },
  {
    question: "23. The SI unit of energy is?",
    options: ["Kelvin", "Joule", "Temperature", "Mole"],
    answer: "Joule",
    section: "Science (Physics)"
  },
  {
    question: "24. Which type of vitamin strengthens bones and teeth and prevents a disease called Rickets?",
    options: ["Vitamin C", "Vitamin D", "Vitamin B", "Vitamin A"],
    answer: "Vitamin D",
    section: "Science (Biology)"
  },
  {
    question: "25. Animal that eat the producers (plants) are called?",
    options: ["Primary Consumers", "Secondary Consumers", "Tertiary Consumers", "None of these"],
    answer: "Primary Consumers",
    section: "Science (Biology)"
  },
  {
    question: "26. The boiling point of water on a centigrade scale is?",
    options: ["80°C", "90°C", "100°C", "10°C"],
    answer: "100°C",
    section: "Science (Physics)"
  },
  {
    question: "27. Animals that eat both plants and animals are known as?",
    options: ["Omnivores", "Herbivores", "Carnivores", "None of these"],
    answer: "Omnivores",
    section: "Science (Biology)"
  },
  {
    question: "28. The average internal temperature of human body is?",
    options: ["32°C", "37°C", "90°C", "35°C"],
    answer: "37°C",
    section: "Science (Biology)"
  },
  {
    question: "29. Noise pollution/intensity is measured in ______?",
    options: ["Decibels (dB)", "Hertz (Hz)", "Watts (W)", "Meters (m)"],
    answer: "Decibels (dB)",
    section: "Science (Physics)"
  },
  {
    question: "30. The axis of rotation of the Earth is tilted at an angle of?",
    options: ["23.5°", "23.0°", "23.08°", "24.30°"],
    answer: "23.5°",
    section: "Science (Geography)"
  },
  {
    question: "31. Carbohydrates which are digested quickly are called?",
    options: ["Starch", "Cellulose", "Muscles", "None of these"],
    answer: "Starch",
    section: "Science (Biology)"
  },
  {
    question: "32. The shielding effect across the period ______?",
    options: ["Increases", "Decrease", "Moderate", "Same"],
    answer: "Same",
    section: "Science (Chemistry)"
  },
  {
    question: "33. Which one of the following forms weak electrolyte solution with water?",
    options: ["CH3COOH", "H2SO4", "NaCl", "None of these"],
    answer: "CH3COOH",
    section: "Science (Chemistry)"
  },
  {
    question: "34. Which compound is known as lunar caustic?",
    options: ["KNO3", "AgNO3", "NaOH", "NaNO3"],
    answer: "AgNO3",
    section: "Science (Chemistry)"
  },
  {
    question: "35. Which gas can turn lime water milky?",
    options: ["O2", "NO2", "CO2", "N2"],
    answer: "CO2",
    section: "Science (Chemistry)"
  },
  {
    question: "36. Which one of the following act as oxidizing agent?",
    options: ["Be", "Mg", "Na", "Cl"],
    answer: "Cl",
    section: "Science (Chemistry)"
  },
  {
    question: "37. Which one of the following is Metalloid?",
    options: ["Sr", "Se", "S", "Si"],
    answer: "Si",
    section: "Science (Chemistry)"
  },
  {
    question: "38. Non-metals of ____ group are gases.",
    options: ["VI-A", "VII-A", "VIII-A", "VIII-B"],
    answer: "VIII-A",
    section: "Science (Chemistry)"
  },
  {
    question: "39. Which Halogen exists in liquid state?",
    options: ["F2", "Cl2", "Br2", "I2"],
    answer: "Br2",
    section: "Science (Chemistry)"
  },
  {
    question: "40. Which one of the following is strong acid?",
    options: ["HF", "HCl", "HBr", "HI"],
    answer: "HI",
    section: "Science (Chemistry)"
  },
  {
    question: "41. Chlorine can be displaced by ______?",
    options: ["F", "Br", "I", "All of these"],
    answer: "F",
    section: "Science (Chemistry)"
  },
  {
    question: "42. The shortest distance between two points is called?",
    options: ["Distance", "Speed", "Displacement", "Velocity"],
    answer: "Displacement",
    section: "Science (Physics)"
  },
  {
    question: "43. The melting point of ice at normal atmospheric pressure is ______?",
    options: ["0 °C", "0 K", "100 °C", "Both 'a' and 'b'"],
    answer: "0 °C",
    section: "Science (Physics)"
  },
  {
    question: "44. Enzyme activity decreased by ______?",
    options: ["Activator", "Substrate", "Inhibitor", "Coenzyme"],
    answer: "Inhibitor",
    section: "Science (Biology)"
  },
  {
    question: "45. Linear thermal expansion of a solid depends upon ______?",
    options: ["Increasing in temperature", "Original length", "Properties of material", "All of these"],
    answer: "All of these",
    section: "Science (Physics)"
  },
  {
    question: "46. Rate of evaporation of a liquid can be increased by ______?",
    options: ["Increasing humidity", "Decreasing temperature", "Increasing its boiling point", "Decreasing atmospheric pressure"],
    answer: "Decreasing atmospheric pressure",
    section: "Science (Physics)"
  },
  {
    question: "47. Evaporation can occur at ______?",
    options: ["Freezing point", "Melting point", "Boiling point", "All temperatures"],
    answer: "All temperatures",
    section: "Science (Physics)"
  },
  {
    question: "48. Thermal energy transfer required to change a liquid into gas without changing its temperature is called?",
    options: ["Latent heat of freezing", "Latent heat of vaporization", "Latent heat of boiling", "Latent heat of melting"],
    answer: "Latent heat of vaporization",
    section: "Science (Physics)"
  },
  {
    question: "49. Thermal energy transfer required to change a solid into liquid without changing its temperature is called?",
    options: ["Latent heat of Fusion", "Latent heat of vaporization", "Latent heat of boiling", "Specific heat capacity"],
    answer: "Latent heat of Fusion",
    section: "Science (Physics)"
  },
  {
    question: "50. A fixed temperature at which a pure liquid boils is called ______?",
    options: ["Melting point", "Freezing point", "Boiling point", "Both 'a' and 'b'"],
    answer: "Boiling point",
    section: "Science (Physics)"
  },
  {
    question: "51. Thermal energy transfer required per unit mass to increase the temperature by 1°C or 1 K is called?",
    options: ["Latent heat of Vaporization", "Specific heat capacity", "Latent heat of fusion", "Thermal capacity"],
    answer: "Specific heat capacity",
    section: "Science (Physics)"
  },

  // --- General Knowledge ---
  {
    question: "52. Who was the first Viceroy of India?",
    options: ["Lord Ripon", "Lord Canning", "Lord Curzon", "Lord Mayo"],
    answer: "Lord Canning",
    section: "General Knowledge"
  },
  {
    question: "53. \"Port Zayed\" is the seaport of ______?",
    options: ["Indonesia", "Yemen", "Jordan", "UAE"],
    answer: "UAE",
    section: "General Knowledge"
  },
  {
    question: "54. What is \"Ikebana\"?",
    options: ["Japanese Art of flower arrangement", "Greek Art of fighting", "Art of dancing and music", "None of these"],
    answer: "Japanese Art of flower arrangement",
    section: "General Knowledge"
  },
  {
    question: "55. Which city is called the 'Little Pakistan'?",
    options: ["Cairo", "Bradford", "Chicago", "Dhaka"],
    answer: "Bradford",
    section: "General Knowledge"
  },
  {
    question: "56. Which player has the highest ODI individual score?",
    options: ["Martin Guptill", "Rohit Sharma", "Virender Sehwag", "Chris Gayle"],
    answer: "Rohit Sharma",
    section: "General Knowledge (Sports)"
  },
  {
    question: "57. Who was the First Woman of England?",
    options: ["William", "Bjorn", "Harold Godwinsson", "Henry"],
    answer: "None of these (Options are all male names, question is flawed)",
    section: "General Knowledge"
  },
  {
    question: "58. The first nuclear power plant in Pakistan was established at ______?",
    options: ["Mianwali", "Islamabad", "Peshawar", "Karachi"],
    answer: "Karachi",
    section: "General Knowledge"
  },
  {
    question: "59. How many different flavors of jelly beans exist?",
    options: ["50", "42", "51", "60"],
    answer: "50",
    section: "General Knowledge"
  },
  {
    question: "60. Buddha temple is in ______?",
    options: ["India", "Pakistan", "China", "USA"],
    answer: "India",
    section: "General Knowledge"
  },
  {
    question: "61. 'One Belt, One Road' (OBOR) Summit-2017 was held in May in ______?",
    options: ["Pakistan", "India", "China", "Iran"],
    answer: "China",
    section: "General Knowledge"
  },
  {
    question: "62. What is the official language of Mexico?",
    options: ["Spanish", "French", "Italian", "English"],
    answer: "Spanish",
    section: "General Knowledge"
  },
  {
    question: "63. The fall of Constantinople occurred in ______?",
    options: ["29 May 1353", "29 May 1453", "22 April 1353", "22 April 1453"],
    answer: "29 May 1453",
    section: "General Knowledge (History)"
  },
  {
    question: "64. Which country had the most Nobel Prize winners in 2017?",
    options: ["USA", "UK", "France", "Germany"],
    answer: "USA",
    section: "General Knowledge"
  },
  {
    question: "65. The Mongols defeated the Khwarezmid Empire and took over Persia in ______?",
    options: ["1220", "1221", "1225", "None of these"],
    answer: "1220",
    section: "General Knowledge (History)"
  },
  {
    question: "66. Total number of sections of ANF Force Act are ______?",
    options: ["17", "16", "18", "21"],
    answer: "21",
    section: "General Knowledge (Law)"
  },
  {
    question: "67. World Heart Day is celebrated every year on ______?",
    options: ["28 October", "28 November", "29 September", "28 April"],
    answer: "29 September",
    section: "General Knowledge (Days)"
  },
  {
    question: "68. Bakhtar is the news agency of what country?",
    options: ["Iran", "Iraq", "Uzbekistan", "Afghanistan"],
    answer: "Afghanistan",
    section: "General Knowledge"
  },
  {
    question: "69. When was Wrestling introduced in Olympic Games?",
    options: ["600", "1904", "1906", "1908"],
    answer: "1904",
    section: "General Knowledge (Sports History)"
  },
  {
    question: "70. Kinna mountains are present in ______?",
    options: ["India", "Pakistan", "Nepal", "China"],
    answer: "India",
    section: "General Knowledge (Geography)"
  },
  {
    question: "71. Which of the following countries became the first in Africa to launch a high-speed train (320km/h)?",
    options: ["South Africa", "Egypt", "Morocco", "Tunisia"],
    answer: "Morocco",
    section: "General Knowledge"
  },
  {
    question: "72. When was PCB (Pakistan Cricket Board) affiliated with ICC?",
    options: ["28 July 1948", "28 July 1950", "28 July 1952", "28 July 1954"],
    answer: "28 July 1952",
    section: "General Knowledge (Sports History)"
  },
  {
    question: "73. When is National Voter's Day celebrated by ECP?",
    options: ["7 December", "8 December", "8 January", "7 November"],
    answer: "7 November",
    section: "General Knowledge (Days)"
  },
  {
    question: "74. When was King Edward Medical University (the oldest university of Pakistan) established?",
    options: ["1852", "1856", "1860", "1883"],
    answer: "1856",
    section: "General Knowledge (History)"
  },
  {
    question: "75. Which of the following Governor Generals of Pakistan died in exile?",
    options: ["Ghulam Muhammad", "Iskander Mirza", "Khawaja Nazimudin", "Muhammad Ali Boghra"],
    answer: "Iskander Mirza",
    section: "General Knowledge (History)"
  },
  {
    question: "76. From which of the following sites was the famous Bull-seal of the Indus Valley found?",
    options: ["Harappa", "Chanhudaro", "Lothal", "Mohenjo-daro"],
    answer: "Mohenjo-daro",
    section: "General Knowledge (History)"
  },
  {
    question: "77. The Indus Valley people knew the use of ______?",
    options: ["Gold, Silver, Copper, Bronze but not Iron", "Silver, Iron, Gold but not Bronze", "Silver, Lead, Iron but not Gold", "Gold, Tin, Bronze but not Copper"],
    answer: "Gold, Silver, Copper, Bronze but not Iron",
    section: "General Knowledge (History)"
  },
  {
    question: "78. Shah Abdul Latif's Risalo was first published by Dr. Ernest Trump from?",
    options: ["Paris", "Leipzig", "Bombay", "London"],
    answer: "Leipzig",
    section: "General Knowledge (Literature)"
  },
  {
    question: "79. NEPPA was created when the Parliament of Pakistan passed the NEPRA Act in ______?",
    options: ["1995", "1997", "1999", "2000"],
    answer: "1997",
    section: "General Knowledge (Law)"
  },
  {
    question: "80. When did Pakistan recognize Bangladesh?",
    options: ["December 1973", "January 1974", "February 1974", "March 1974"],
    answer: "February 1974",
    section: "General Knowledge (History)"
  },
  {
    question: "81. Campbellpur is the old name of ______?",
    options: ["Khanewal", "Attock", "Abbottabad", "Sargodha"],
    answer: "Attock",
    section: "General Knowledge (Geography)"
  },

  // --- Islamic Studies ---
  {
    question: "82. Which of the following does the Quran consider as an unpardonable sin?",
    options: ["Shirk", "Jealousy", "Lie", "Hypocrisy"],
    answer: "Shirk",
    section: "Islamic Studies"
  },
  {
    question: "83. Who was the first translated the Holy Quran into Sindhi?",
    options: ["Bulley Shah", "Abdullah Shah Ghazi", "Akhund Azizullah Muttalawi", "Bahauddin Zakkaria"],
    answer: "Akhund Azizullah Muttalawi",
    section: "Islamic Studies"
  },
  {
    question: "84. Hazrat ______ conquered the fort of Qamus.",
    options: ["Umar", "Abu Bakar", "Ali", "Usman"],
    answer: "Ali",
    section: "Islamic Studies"
  },
  {
    question: "85. Original name of Abu Jehl was ______ bin Hisham.",
    options: ["Qutrat", "Saleh", "Abha", "Ali"],
    answer: "Ali", // Amr ibn Hisham al-Makhzumi
    section: "Islamic Studies"
  },
  {
    question: "86. Hurrirah means a ______?",
    options: ["Camel", "Ant", "Goat", "Cat"],
    answer: "Cat",
    section: "Islamic Studies"
  },
  {
    question: "87. What was written on the Holy Prophet (SAW) seal?",
    options: ["Allah Muhammad Rasool", "Muhammad Rasool-Ullah", "Muhammad Allah Rasool", "Allah Rasool Muhammad"],
    answer: "Allah Muhammad Rasool",
    section: "Islamic Studies"
  },
  {
    question: "88. What is the first belief in Iman-e-Mufassal?",
    options: ["The hereafter life", "Prophethood", "No deity except Allah", "Angels"],
    answer: "No deity except Allah",
    section: "Islamic Studies"
  },
  {
    question: "89. Name the Angel who takes out souls of life-bearing creatures?",
    options: ["Hazrat Israfeel (AS)", "Hazrat Jibra'eel (AS)", "Hazrat Izra'eel (AS)", "None of them"],
    answer: "Hazrat Izra'eel (AS)",
    section: "Islamic Studies"
  },
  {
    question: "90. Had-e-Qazaf (false accusation) is ______?",
    options: ["80 Lashes", "70 Lashes", "50 Lashes", "90 Lashes"],
    answer: "80 Lashes",
    section: "Islamic Studies"
  },
  {
    question: "91. Arafat gathering is held on ______?",
    options: ["10 Zil Hajj", "9 Zil Hajj", "8 Zil Hajj", "12 Zil Hajj"],
    answer: "9 Zil Hajj",
    section: "Islamic Studies"
  },

  // --- Computer Science / Computer Studies ---
  {
    question: "92. What does DMA stand for?",
    options: ["Distinct Memory Access", "Direct Memory Access", "Direct Module Access", "Direct Memory Allocation"],
    answer: "Direct Memory Access",
    section: "Computer Studies"
  },
  {
    question: "93. Microprocessors as switching devices are for ______ generation computers?",
    options: ["First Generation", "Second Generation", "Third Generation", "Fourth Generation"],
    answer: "Fourth Generation", // Corrected based on general knowledge
    section: "Computer Studies"
  },
  {
    question: "94. Personal computers use a number of chips mounted on a main circuit board. What is the common name for such boards?",
    options: ["Daughter board", "Motherboard", "Father board", "Breadboard"],
    answer: "Motherboard",
    section: "Computer Studies"
  },
  {
    question: "95. Who is the current CEO of Microsoft?",
    options: ["Babbage", "Bill Gates", "Bill Clinton", "Satya Nadella"],
    answer: "Satya Nadella",
    section: "Computer Studies"
  },
  {
    question: "96. The instructions that tell a computer how to carry out the processing tasks are referred to as computer ______?",
    options: ["Programs", "Processors", "Input devices", "Memory modules"],
    answer: "Programs",
    section: "Computer Studies"
  },
  {
    question: "97. If a computer has more than one processor then it is known as ______?",
    options: ["Uniprocess", "Multiprocessor", "Multithreaded", "Multiprogramming"],
    answer: "Multiprocessor",
    section: "Computer Studies"
  },
  {
    question: "98. Which one is a digital device, select from the choices below?",
    options: ["Digital Clock", "Automobile speed meter", "Clock with a dial and two hands", "All of them"],
    answer: "Digital Clock",
    section: "Computer Studies"
  },
  {
    question: "99. A CPU contains ______?",
    options: ["A card reader and a printing device", "An analytical engine and a control unit", "A control unit and an arithmetic logic unit", "An arithmetic logic unit and a card reader"],
    answer: "A control unit and an arithmetic logic unit",
    section: "Computer Studies"
  },
  {
    question: "100. UNIVAC is ______?",
    options: ["Universal Automatic Computer", "Universal Array Computer", "Unique Automatic Computer", "Unvalued Automatic Computer"],
    answer: "Universal Automatic Computer",
    section: "Computer Studies"
  }
];

        let currentQuestionIndex = 0;
        let userAnswers = [];
        let timeLeft = 3000; // 60 minutes in seconds
        let timerInterval;
        const totalQuestions = questions.length;
        let quizStarted = false;

        // Elements
        const passwordOverlay = document.getElementById('passwordOverlay');
        const passwordInput = document.getElementById('passwordInput');
        const passwordSubmitBtn = document.getElementById('passwordSubmitBtn');
        const passwordError = document.getElementById('passwordError');
        const quizSection = document.getElementById('quizSection');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const currentQuestionNumberSpan = document.getElementById('currentQuestionNumber');
        const totalQuestionsSpan = document.getElementById('totalQuestions');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitQuizFinalBtn = document.getElementById('submitQuizFinalBtn');
        const timeLeftSpan = document.getElementById('timeLeft');
        const progressBarFill = document.getElementById('progressBarFill');
        const markForReviewCheckbox = document.getElementById('markForReviewCheckbox');
        const questionPalettePanel = document.getElementById('questionPalettePanel');
        const questionGrid = document.getElementById('questionGrid');
        const resultsSection = document.getElementById('resultsSection');
        const resTotalQuestions = document.getElementById('resTotalQuestions');
        const resAttempted = document.getElementById('resAttempted');
        const resCorrectAnswers = document.getElementById('resCorrectAnswers');
        const resIncorrectAnswers = document.getElementById('resIncorrectAnswers');
        const resScore = document.getElementById('resScore');
        const reviewItemsContainer = document.getElementById('reviewItemsContainer');
        const printSaveBtn = document.getElementById('printSaveBtn');
        const restartQuizBtn = document.getElementById('restartQuizBtn');
        const modeToggle = document.getElementById('modeToggle');
        const modeToggleIcon = modeToggle.querySelector('.icon');
        const passageDisplay = document.getElementById('passageDisplay'); // New element for passage

        // Initialize userAnswers array
        for (let i = 0; i < totalQuestions; i++) {
            userAnswers.push({
                answer: null,
                markedForReview: false,
                attempted: false
            });
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function updateTimer() {
            timeLeft--;
            timeLeftSpan.textContent = formatTime(timeLeft);
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                submitQuiz();
            }
        }

        function loadQuestion() {
            const questionData = questions[currentQuestionIndex];

            // Display passage only for the first 5 questions
            if (currentQuestionIndex >= 0 && currentQuestionIndex <= 9) {
                passageDisplay.innerHTML = passageForFirstFiveQuestions;
                passageDisplay.style.display = 'block'; // Show the passage container
            } else {
                passageDisplay.innerHTML = ''; // Clear passage for other questions
                passageDisplay.style.display = 'none'; // Hide the passage container
            }

            questionText.innerHTML = questionData.question;
            optionsContainer.innerHTML = ''; // Clear previous options

            questionData.options.forEach((option, index) => {
                const label = document.createElement('label');
                const radioInput = document.createElement('input');
                radioInput.type = 'radio';
                radioInput.name = 'quizOption';
                radioInput.value = option;
                radioInput.id = `option${index}`;

                label.appendChild(radioInput);
                label.appendChild(document.createTextNode(option));
                optionsContainer.appendChild(label);

                // Pre-select if answer exists
                if (userAnswers[currentQuestionIndex].answer === option) {
                    radioInput.checked = true;
                }

                radioInput.addEventListener('change', (event) => {
                    userAnswers[currentQuestionIndex].answer = event.target.value;
                    userAnswers[currentQuestionIndex].attempted = true;
                    updatePaletteItemStatus(currentQuestionIndex);
                });
            });

            // Update Mark for Review checkbox
            markForReviewCheckbox.checked = userAnswers[currentQuestionIndex].markedForReview;
            markForReviewCheckbox.removeEventListener('change', handleMarkForReviewChange); // Remove old listener
            markForReviewCheckbox.addEventListener('change', handleMarkForReviewChange); // Add new listener

            currentQuestionNumberSpan.textContent = currentQuestionIndex + 1;
            totalQuestionsSpan.textContent = totalQuestions;
            updateProgressBar();
            updateNavigationButtons();
            updatePaletteActiveStatus();
        }

        function handleMarkForReviewChange() {
            userAnswers[currentQuestionIndex].markedForReview = markForReviewCheckbox.checked;
            updatePaletteItemStatus(currentQuestionIndex);
        }

        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            progressBarFill.style.width = `${progress}%`;
        }

        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;

            // Show/hide Next and Submit buttons based on current question index
            if (currentQuestionIndex === totalQuestions - 1) {
                nextBtn.style.display = 'none'; // Hide next button on the last question
                submitQuizFinalBtn.style.display = 'inline-block'; // Show submit button on the last question
            } else {
                nextBtn.style.display = 'inline-block'; // Show next button
                submitQuizFinalBtn.style.display = 'none'; // Hide submit button
            }
        }

        function showNextQuestion() {
            if (currentQuestionIndex < totalQuestions - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function submitQuiz() {
            clearInterval(timerInterval);
            quizSection.style.display = 'none';
            resultsSection.style.display = 'block';
            calculateResults();
            displayReview();
        }

        function calculateResults() {
            let correctAnswersCount = 0;
            let attemptedQuestionsCount = 0;

            userAnswers.forEach((userAnswer, index) => {
                if (userAnswer.attempted) {
                    attemptedQuestionsCount++;
                    if (userAnswer.answer === questions[index].answer) {
                        correctAnswersCount++;
                    }
                }
            });

            const incorrectAnswersCount = attemptedQuestionsCount - correctAnswersCount;
            const score = (correctAnswersCount / totalQuestions) * 50

            resTotalQuestions.textContent = totalQuestions;
            resAttempted.textContent = attemptedQuestionsCount;
            resCorrectAnswers.textContent = correctAnswersCount;
            resIncorrectAnswers.textContent = incorrectAnswersCount;
            resScore.textContent = score.toFixed(2);
        }

        function displayReview() {
            reviewItemsContainer.innerHTML = ''; // Clear previous review items

            questions.forEach((question, index) => {
                const reviewItem = document.createElement('div');
                reviewItem.classList.add('review-item');

                const userAnswerData = userAnswers[index];
                const attempted = userAnswerData.attempted;
                const yourAnswer = userAnswerData.answer;
                const correctAnswer = question.answer;

                let answerStatusClass = 'not-attempted'; // Default for unattempted
                let answerText = 'Not Attempted';

                if (attempted) {
                    if (yourAnswer === correctAnswer) {
                        answerStatusClass = 'correct';
                        answerText = `Your Answer: <strong class="your-answer correct">${yourAnswer}</strong>`;
                    } else {
                        answerStatusClass = 'incorrect';
                        answerText = `Your Answer: <strong class="your-answer">${yourAnswer}</strong>`;
                    }
                }

                reviewItem.innerHTML = `
                    <p><strong>Q${index + 1}:</strong> ${question.question}</p>
                    <p class="your-answer ${answerStatusClass}">${answerText}</p>
                    <p>Correct Answer: <strong class="correct-answer">${correctAnswer}</strong></p>
                `;
                reviewItemsContainer.appendChild(reviewItem);
            });
        }

        function generateQuestionPalette() {
            questionGrid.innerHTML = '';
            questions.forEach((_, index) => {
                const item = document.createElement('div');
                item.classList.add('question-grid-item');
                item.textContent = index + 1;
                item.dataset.questionIndex = index;
                item.addEventListener('click', () => {
                    currentQuestionIndex = index;
                    loadQuestion();
                });
                questionGrid.appendChild(item);
            });
            updatePaletteAllStatus();
        }

        function updatePaletteItemStatus(index) {
            const item = questionGrid.querySelector(`[data-question-index="${index}"]`);
            if (item) {
                item.classList.remove('current', 'answered', 'reviewed', 'unattempted', 'answered-reviewed');

                const userAnswer = userAnswers[index];
                if (userAnswer.attempted && userAnswer.markedForReview) {
                    item.classList.add('answered-reviewed');
                } else if (userAnswer.attempted) {
                    item.classList.add('answered');
                } else if (userAnswer.markedForReview) {
                    item.classList.add('reviewed');
                } else {
                    item.classList.add('unattempted');
                }

                // Ensure current question is always highlighted after updating status
                updatePaletteActiveStatus();
            }
        }

        function updatePaletteAllStatus() {
            userAnswers.forEach((_, index) => {
                updatePaletteItemStatus(index);
            });
        }

        function updatePaletteActiveStatus() {
            // Remove 'current' from all items first
            questionGrid.querySelectorAll('.question-grid-item').forEach(item => {
                item.classList.remove('current');
            });
            // Add 'current' to the active question
            const currentItem = questionGrid.querySelector(`[data-question-index="${currentQuestionIndex}"]`);
            if (currentItem) {
                currentItem.classList.add('current');
            }
        }

        function restartQuiz() {
            // Using a custom modal-like message instead of confirm()
            const confirmRestart = document.createElement('div');
            confirmRestart.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.7); display: flex; justify-content: center;
                align-items: center; z-index: 9999;
            `;
            confirmRestart.innerHTML = `
                <div style="background: var(--card-background); padding: 30px; border-radius: 15px; text-align: center; max-width: 400px; width: 90%; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
                    <p style="font-size: 1.1rem; margin-bottom: 20px; color: var(--text-color);">Are you sure you want to restart the quiz? Your current progress will be lost.</p>
                    <button id="confirmYes" class="btn" style="background-color: var(--danger-color); margin-right: 10px;">Yes, Restart</button>
                    <button id="confirmNo" class="btn" style="background-color: var(--primary-color);">No, Cancel</button>
                </div>
            `;
            document.body.appendChild(confirmRestart);

            document.getElementById('confirmYes').addEventListener('click', () => {
                document.body.removeChild(confirmRestart);
                currentQuestionIndex = 0;
                timeLeft = 3000;
                userAnswers = [];
                for (let i = 0; i < totalQuestions; i++) {
                    userAnswers.push({
                        answer: null,
                        markedForReview: false,
                        attempted: false
                    });
                }
                resultsSection.style.display = 'none';
                quizSection.style.display = 'block';
                loadQuestion();
                generateQuestionPalette(); // Re-initialize palette colors
                clearInterval(timerInterval);
                timerInterval = setInterval(updateTimer, 1000);
            });

            document.getElementById('confirmNo').addEventListener('click', () => {
                document.body.removeChild(confirmRestart);
            });
        }

        // Print/Save as PDF functionality
        printSaveBtn.addEventListener('click', () => {
            const element = document.getElementById('resultsSection');
            const opt = {
                margin: 10,
                filename: 'Quiz_Results.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: 'avoid-all', after: '.review-item' } // Avoid breaking review items
            };
            html2pdf().set(opt).from(element).save();
        });


        // Dark Mode Toggle
        modeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                modeToggleIcon.textContent = '🌙'; // Moon icon for dark mode
            } else {
                modeToggleIcon.textContent = '☀️'; // Sun icon for light mode
            }
            // Recalculate legend colors when mode changes
            updateLegendColors();
        });

        // Function to apply colors to legend items based on current mode
        function updateLegendColors() {
            const rootStyle = getComputedStyle(document.documentElement);

            const legendItems = document.querySelectorAll('.palette-legend .legend-item .legend-color');
            legendItems.forEach(legendColorDiv => {
                const colorType = legendColorDiv.dataset.colorType;
                let colorToApply = '';

                switch (colorType) {
                    case 'current':
                        colorToApply = rootStyle.getPropertyValue('--primary-color');
                        break;
                    case 'answered':
                        colorToApply = rootStyle.getPropertyValue('--success-color');
                        break;
                    case 'marked':
                        colorToApply = rootStyle.getPropertyValue('--secondary-color');
                        break;
                    case 'unattempted':
                        colorToApply = rootStyle.getPropertyValue('--unattempted-color');
                        break;
                    case 'answered-reviewed':
                        colorToApply = rootStyle.getPropertyValue('--answered-reviewed-color');
                        break;
                    default:
                        colorToApply = '#ccc'; // Fallback
                }
                legendColorDiv.style.backgroundColor = colorToApply;
                legendColorDiv.style.border = `1px solid ${rootStyle.getPropertyValue('--border-color')}`;
            });
        }


        // Event Listeners
        passwordSubmitBtn.addEventListener('click', () => {
            const enteredPassword = passwordInput.value;
            const encryptedEnteredPassword = obfuscate(enteredPassword);

            if (encryptedEnteredPassword === actualEncryptedPassword) {
                passwordOverlay.style.display = 'none';
                quizSection.style.display = 'block';
                loadQuestion();
                generateQuestionPalette();
                timerInterval = setInterval(updateTimer, 1000);
                quizStarted = true;
            } else {
                passwordError.textContent = 'Incorrect password. Please try again.';
            }
        });

        // Allow pressing Enter in password field
        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                passwordSubmitBtn.click();
            }
        });

        prevBtn.addEventListener('click', showPreviousQuestion);
        nextBtn.addEventListener('click', showNextQuestion);
        submitQuizFinalBtn.addEventListener('click', submitQuiz);
        restartQuizBtn.addEventListener('click', restartQuiz);

        // Initial setup
        updateLegendColors(); // Set initial legend colors based on default mode
    </script>
</body>
</html>
