<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDCAT Mock Test - Enhanced UI</title>
    
    <!-- Google Fonts: Poppins (for headings) and Inter (for body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Tailwind CSS CDN (MUST be loaded before tailwind.config) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwind CSS Configuration for Dark Mode -->
    <script>
        // Tailwind कॉन्फ़िगरेशन को Tailwind CDN स्क्रिप्ट के बाद लोड किया जाना चाहिए।
        // The Tailwind configuration must be loaded after the Tailwind CDN script.
        tailwind.config = {
            darkMode: 'class', // HTML टैग पर 'dark' क्लास के आधार पर डार्क मोड सक्षम करें
            // Enable dark mode based on 'dark' class on HTML tag
            theme: {
                extend: {
                    // आप चाहें तो यहां अपनी थीम का विस्तार कर सकते हैं
                    // You can extend your theme here if needed
                }
            }
        }
    </script>
    <style>
        /* Custom CSS for fonts and scrollbar, not easily done with Tailwind */
        body {
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }
        /* Custom scrollbar for the question palette */
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
            width: 8px; /* For vertical scrollbars if needed */
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #e2e8f0; /* slate-200 */
            border-radius: 10px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b; /* slate-800 */
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #3b82f6; /* blue-500 */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #2563eb; /* blue-600 */
        }
        
        /* Custom styles for the circular progress bar */
        .score-circle-svg {
            width: 100%;
            height: 100%;
        }
        .circle-bg {
            fill: none;
            stroke: #e2e8f0; /* slate-200 */
            stroke-width: 3.8;
        }
        .dark .circle-bg {
            stroke: #334155; /* slate-700 */
        }
        .circle-progress {
            fill: none;
            stroke-width: 2.8;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease-out;
            transform: rotate(-90deg); /* Apply rotation only to the progress path */
            transform-origin: 50% 50%; /* Ensure rotation is around the center */
        }
        .mdcat-progress {
            stroke: #6366f1; /* indigo-500 */
        }
        .aggregate-progress {
            stroke: #00BCD4; /* secondary-color */
        }
        .circle-text {
            fill: #0f172a; /* slate-900 */
            font-family: 'Poppins', sans-serif;
            font-size: 6.5px; /* Adjusted smaller font size */
            font-weight: 700;
            text-anchor: middle;
        }
        .dark .circle-text {
            fill: #f8fafc; /* slate-50 */
        }

        /* Print Styles for PDF Export */
        @media print {
            body {
                background-color: #fff !important;
                color: #000 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .no-print {
                display: none !important;
            }
            .main-content-area {
                padding: 0 !important;
                margin: 0 !important;
                min-height: auto !important;
                display: block !important;
            }
            section.card {
                box-shadow: none !important;
                border: 1px solid #ccc !important;
                padding: 1rem !important;
                margin: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                background: #fff !important;
            }
            #resultSection .text-3xl, #reviewSection .text-3xl {
                font-size: 24pt;
                text-align: center;
                border-bottom: 2px solid #000;
                padding-bottom: 10px;
                margin-bottom: 20px;
                color: #000 !important;
            }
            .grid {
                display: block !important;
            }
            .score-circle-container {
                display: none; /* Hide chart in print */
            }
            .status-pill, .review-option-item {
                border: 1px solid #ccc !important;
                background-color: #f9f9f9 !important;
            }
             .status-pill p, .status-pill strong, .status-pill p, .status-pill span,
             .review-option-item p, .review-option-item i {
                 color: #000 !important;
            }
            .review-question-item {
                page-break-inside: avoid;
                margin-bottom: 1rem;
                border-top: 1px solid #eee;
                padding-top: 1rem;
            }
             .review-option-item.correct {
                 background-color: #e6fffa !important;
             }
             .review-option-item.incorrect {
                 background-color: #fff5f5 !important;
             }
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .dark .modal-content {
            background-color: #1e293b; /* slate-800 */
            color: #f8fafc; /* slate-50 */
        }
    </style>
</head>
<body class="bg-gray-100 text-slate-700 dark:bg-gray-900 dark:text-slate-300 transition-all duration-300 ease-in-out">

    <!-- Navbar -->
    <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200 dark:bg-slate-900/80 dark:border-slate-800 sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <a href="#" class="flex items-center gap-3 text-2xl font-extrabold text-indigo-500 dark:text-blue-400">
                <i class="fa-solid fa-book-open"></i>
                <span>MDCAT Mock Test 2</span>
            </a>
            <div class="flex items-center gap-4">
                <button id="fullscreenToggle" class="w-10 h-10 rounded-full flex items-center justify-center text-slate-700 bg-slate-200 hover:bg-slate-300 dark:text-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 transition" title="Toggle Fullscreen">
                    <i class="fa-solid fa-expand" id="fullscreenIcon"></i>
                </button>
                <button id="themeToggle" class="w-10 h-10 rounded-full flex items-center justify-center text-indigo-500 bg-slate-200 hover:bg-slate-300 dark:text-blue-400 dark:bg-slate-800 dark:hover:bg-slate-700 transition" title="Toggle Theme">
                    <i class="fa-solid fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="min-h-[calc(100vh-64px)] flex items-center justify-center p-4 sm:p-6 lg:p-8">
        <div class="w-full max-w-4xl mx-auto">

            <!-- Password Protection Section -->
            <section id="passwordSection" class="bg-white dark:bg-slate-800/50 p-8 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 transition-all duration-300 ease-in-out">
                <div class="text-center">
                    <h2 class="text-3xl font-extrabold text-slate-800 dark:text-slate-50">Start Your Test</h2>
                    <p class="mt-2 text-slate-600 dark:text-slate-400">Enter the test password and your academic marks to begin.</p>
                </div>

                <div class="mt-8 max-w-md mx-auto flex flex-col gap-6">
                    <div>
                        <label for="testPassword" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Test Password</label>
                        <input type="password" id="testPassword" class="mt-1 block w-full p-3 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-slate-800 dark:text-slate-50 placeholder-slate-400 dark:placeholder-slate-500" placeholder="••••••••••">
                        <p id="passwordError" class="text-red-500 text-sm mt-1 hidden">Incorrect password. Please try again.</p>
                    </div>

                       <div class="bg-blue-50 dark:bg-slate-800 p-4 rounded-lg text-center border border-blue-200 dark:border-slate-700">
                        <p class="text-sm text-blue-800 dark:text-blue-300">
                            <i class="fa-solid fa-circle-info mr-1"></i> <strong>TEST PASSWORD:</strong> mdcattestbymk</p></div>


                    <div class="academic-marks-section">
                        <h3 class="pt-6 text-lg font-semibold text-slate-800 dark:text-slate-50 border-t border-slate-200 dark:border-slate-700">Academic Marks (for Merit Calculation)</h3>
                        <div class="space-y-4 mt-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">SSC Marks</label>
                                <div class="flex items-center gap-2 mt-1">
                                    <input type="number" id="sscObtained" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-slate-800 dark:text-slate-50 placeholder-slate-400 dark:placeholder-slate-500" placeholder="Obtained" min="0">
                                    <span class="text-slate-600 dark:text-slate-400">/</span>
                                    <input type="number" id="sscTotal" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-slate-800 dark:text-slate-50 placeholder-slate-400 dark:placeholder-slate-500" placeholder="Total" min="1">
                                </div>
                                <p id="sscError" class="text-red-500 text-sm mt-1 hidden">Please enter valid SSC marks (Obtained &lt;= Total, Total &gt; 0).</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">F.Sc. Marks</label>
                                <div class="flex items-center gap-2 mt-1">
                                    <input type="number" id="fscObtained" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-slate-800 dark:text-slate-50 placeholder-slate-400 dark:placeholder-slate-500" placeholder="Obtained" min="0">
                                    <span class="text-slate-600 dark:text-slate-400">/</span>
                                    <input type="number" id="fscTotal" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-slate-800 dark:text-slate-50 placeholder-slate-400 dark:placeholder-slate-500" placeholder="Total" min="1">
                                </div>
                                <p id="fscError" class="text-red-500 text-sm mt-1 hidden">Please enter valid F.Sc. marks (Obtained &lt;= Total, Total &gt; 0).</p>
                            </div>
                        </div>
                    </div>

                    <button id="startTestBtn" class="w-full py-3 px-4 bg-indigo-500 text-white font-bold rounded-lg shadow-lg shadow-indigo-500/30 hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:shadow-blue-500/20 dark:hover:bg-blue-600 dark:focus:ring-offset-slate-900 transition-all duration-300 ease-in-out transform hover:scale-105">
                        Start Test
                    </button>
                </div>
            </section>

            <!-- Quiz Section -->
            <section id="quizSection" class="hidden">
                <div class="bg-white dark:bg-slate-800/50 p-8 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 transition-all duration-300 ease-in-out">
                    <div class="flex flex-col sm:flex-row justify-between items-center pb-4 border-b border-slate-200 dark:border-slate-700 gap-4">
                        <h3 id="questionCounter" class="text-lg font-semibold text-slate-800 dark:text-slate-50">Question 1/200</h3>
                        <div id="timer" class="flex items-center gap-2 text-xl font-bold text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/50 py-2 px-4 rounded-full border border-red-200 dark:border-red-500/30">
                            <i class="fa-solid fa-clock"></i>
                            <span>03:30:00</span>
                        </div>
                    </div>

                    <div class="mt-6">
                        <h4 id="questionText" class="text-xl font-bold text-slate-900 dark:text-slate-50 leading-tight"></h4>
                        <div id="optionsContainer" class="flex flex-col gap-4 mt-6">
                        </div>
                    </div>

                    <div class="flex justify-between mt-8 no-print">
                        <button id="prevBtn" class="py-3 px-6 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600 transition">Previous</button>
                        <button id="nextBtn" class="py-3 px-6 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600 transition">Next</button>
                    </div>
                </div>

                <div class="bg-white dark:bg-slate-800/50 p-4 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 mt-6 no-print">
                    <h4 class="text-sm font-semibold text-slate-600 dark:text-slate-400 mb-3">Question Palette</h4>
                    <div id="questionPalette" class="flex flex-nowrap gap-2 overflow-x-auto pb-2 custom-scrollbar">
                        <!-- Question palette buttons will be generated here by JS -->
                    </div>
                </div>
            </section>

            <!-- Result Section -->
            <section id="resultSection" class="hidden">
                <div class="bg-white dark:bg-slate-800/50 p-8 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 text-center transition-all duration-300 ease-in-out">
                    <h2 class="text-3xl font-extrabold text-slate-800 dark:text-slate-50">Test Completed!</h2>
                    <p class="mt-2 text-slate-600 dark:text-slate-400">Here's a summary of your performance.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8 items-center">
                        <!-- MDCAT Score Circle -->
                        <div class="flex flex-col items-center justify-center">
                            <div class="w-52 h-52 relative flex items-center justify-center">
                                <svg class="score-circle-svg" viewBox="0 0 36 36">
                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle-progress mdcat-progress" id="mdcatScoreCircle" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <text x="18" y="18" class="circle-text" id="mdcatScoreCircleText"></text>
                                </svg>
                            </div>
                            <p class="mt-2 text-lg font-semibold text-slate-700 dark:text-slate-300">MDCAT Score</p>
                        </div>

                        <!-- Aggregate Score Circle -->
                        <div class="flex flex-col items-center justify-center">
                            <div class="w-52 h-52 relative flex items-center justify-center">
                                <svg class="score-circle-svg" viewBox="0 0 36 36">
                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle-progress aggregate-progress" id="aggregateScoreCircle" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <text x="18" y="18" class="circle-text" id="aggregateScoreCircleText"></text>
                                </svg>
                            </div>
                            <p class="mt-2 text-lg font-semibold text-slate-700 dark:text-slate-300">Aggregate Score</p>
                        </div>

                        <div class="flex flex-col gap-3 text-left">
                            <div class="flex items-center justify-between bg-slate-100 dark:bg-slate-700 p-3 rounded-lg">
                                <span class="font-medium text-slate-700 dark:text-slate-300">Total Questions</span>
                                <strong id="totalQuestionsResult" class="text-lg font-bold text-slate-900 dark:text-slate-50">200</strong>
                            </div>
                            <div class="flex items-center justify-between bg-slate-100 dark:bg-slate-700 p-3 rounded-lg">
                                <span class="font-medium text-slate-700 dark:text-slate-300">Attempted</span>
                                <strong id="attemptedQuestionsResult" class="text-lg font-bold text-slate-900 dark:text-slate-50">0</strong>
                            </div>
                            <div class="flex items-center justify-between bg-green-100 dark:bg-green-900/50 p-3 rounded-lg">
                                <span class="font-medium text-green-600 dark:text-green-400">Correct</span>
                                <strong id="correctAnswersResult" class="text-lg font-bold text-green-600 dark:text-green-400">0</strong>
                            </div>
                            <div class="flex items-center justify-between bg-red-100 dark:bg-red-900/50 p-3 rounded-lg">
                                <span class="font-medium text-red-600 dark:text-red-400">Incorrect</span>
                                <strong id="incorrectAnswersResult" class="text-lg font-bold text-red-600 dark:text-red-400">0</strong>
                            </div>
                             <div class="flex items-center justify-between bg-yellow-100 dark:bg-yellow-900/50 p-3 rounded-lg">
                                <span class="font-medium text-yellow-600 dark:text-yellow-400">Unattempted</span>
                                <strong id="unattemptedQuestionsResult" class="text-lg font-bold text-yellow-600 dark:text-yellow-400">0</strong>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-slate-200 dark:border-slate-700 text-center flex flex-col gap-4">
                         <div>
                            <p class="text-sm text-slate-600 dark:text-slate-400">Time Taken</p>
                            <p id="timeTakenResult" class="text-xl font-bold text-slate-900 dark:text-slate-50">00:00:00</p>
                        </div>
                        <div id="statusContainer" class="flex flex-col gap-2">
                            <!-- Status messages will be dynamically added here -->
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8 no-print">
                        <button id="restartBtn" class="py-3 px-6 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600 transition">Restart Test</button>
                        <button id="reviewBtn" class="py-3 px-6 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 dark:bg-blue-500 dark:hover:bg-blue-600 transition">Review Answers</button>
                        <button id="savePdfBtn" class="py-3 px-6 bg-slate-600 text-white font-semibold rounded-lg hover:bg-slate-700 transition">Save as PDF</button>
                    </div>
                </div>
            </section>

            <!-- Review Section -->
            <section id="reviewSection" class="hidden">
                 <div class="bg-white dark:bg-slate-800/50 p-8 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 transition-all duration-300 ease-in-out">
                    <div class="flex justify-between items-center pb-4 border-b border-slate-200 dark:border-slate-700">
                        <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-50">Review Answers</h2>
                        <button id="backToResultsBtn" class="text-indigo-500 dark:text-blue-400 font-semibold hover:underline no-print">Back to Results</button>
                    </div>
                    
                    <div id="reviewQuestionDisplay" class="mt-6">
                        <!-- Review question and options will be displayed here -->
                    </div>

                    <div class="flex justify-between mt-8 no-print">
                        <button id="reviewPrevBtn" class="py-3 px-6 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600 transition">Previous</button>
                        <button id="reviewNextBtn" class="py-3 px-6 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600 transition">Next</button>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white/80 backdrop-blur-md border-t border-slate-200 dark:bg-slate-900/80 dark:border-slate-800 py-4 text-center no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <p class="text-sm text-slate-600 dark:text-slate-400">&copy; 2025 MDCAT Test Prep Portal. All rights reserved.</p>
        </div>
    </footer>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-[1000] flex flex-col gap-2"></div>

    <!-- Confirmation Modal for Test Submission -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-slate-800 dark:text-slate-50 mb-4">Submit Test?</h3>
            <p class="text-slate-600 dark:text-slate-400 mb-6">Are you sure you want to submit the test? Once submitted, you cannot change your answers.</p>
            <div class="flex justify-center gap-4">
                <button id="cancelSubmissionBtn" class="py-2 px-5 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600 transition">Cancel</button>
                <button id="confirmSubmissionBtn" class="py-2 px-5 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 dark:bg-blue-500 dark:hover:bg-blue-600 transition">Submit</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // --- Element Selectors ---
    const passwordSection = document.getElementById('passwordSection');
    const quizSection = document.getElementById('quizSection');
    const resultSection = document.getElementById('resultSection');
    const reviewSection = document.getElementById('reviewSection');

    const testPasswordInput = document.getElementById('testPassword');
    const sscObtainedInput = document.getElementById('sscObtained');
    const sscTotalInput = document.getElementById('sscTotal');
    const fscObtainedInput = document.getElementById('fscObtained');
    const fscTotalInput = document.getElementById('fscTotal');
    const startTestBtn = document.getElementById('startTestBtn');
    const passwordError = document.getElementById('passwordError');
    const sscError = document.getElementById('sscError');
    const fscError = document.getElementById('fscError');

    const questionCounter = document.getElementById('questionCounter');
    const timerDisplay = document.querySelector('#timer span');
    const questionPalette = document.getElementById('questionPalette');
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    const totalQuestionsResult = document.getElementById('totalQuestionsResult');
    const attemptedQuestionsResult = document.getElementById('attemptedQuestionsResult');
    const correctAnswersResult = document.getElementById('correctAnswersResult');
    const incorrectAnswersResult = document.getElementById('incorrectAnswersResult');
    const unattemptedQuestionsResult = document.getElementById('unattemptedQuestionsResult');
    const timeTakenResult = document.getElementById('timeTakenResult');
    const mdcatScoreCircle = document.getElementById('mdcatScoreCircle');
    const mdcatScoreCircleText = document.getElementById('mdcatScoreCircleText');
    const aggregateScoreCircle = document.getElementById('aggregateScoreCircle');
    const aggregateScoreCircleText = document.getElementById('aggregateScoreCircleText');
    const statusContainer = document.getElementById('statusContainer');
    const reviewBtn = document.getElementById('reviewBtn');
    const restartBtn = document.getElementById('restartBtn');
    const savePdfBtn = document.getElementById('savePdfBtn');

    const reviewQuestionDisplay = document.getElementById('reviewQuestionDisplay');
    const reviewPrevBtn = document.getElementById('reviewPrevBtn');
    const reviewNextBtn = document.getElementById('reviewNextBtn');
    const backToResultsBtn = document.getElementById('backToResultsBtn');
    const themeToggleBtn = document.getElementById('themeToggle');
    const fullscreenToggleBtn = document.getElementById('fullscreenToggle');
    const fullscreenIcon = document.getElementById('fullscreenIcon');
    const toastContainer = document.getElementById('toastContainer');

    const confirmationModal = document.getElementById('confirmationModal');
    const cancelSubmissionBtn = document.getElementById('cancelSubmissionBtn');
    const confirmSubmissionBtn = document.getElementById('confirmSubmissionBtn');


    // --- State Variables ---
    const quizPassword = "mdcattestbymk";
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let timerInterval;
    const totalTestDuration = 3.5 * 60 * 60; // 3.5 hours in seconds
    let timeRemaining = totalTestDuration;
    let testStartTime;
    let sscObtainedMarks = 0, sscTotalMarks = 1, fscObtainedMarks = 0, fscTotalMarks = 1;
    let currentReviewQuestionIndex = 0; // Added for review section navigation
    let shuffledQuestions = []; // To store questions (now in original order)
    let shuffledOptionsMap = new Map(); // To store options (now in original order)

    // --- Questions Data (Full 200 Questions) ---
   const originalQuestions = [
  // Biology Questions
  {
    "question": "Which type of cells lack a true nucleus and membrane-bound organelles?",
    "options": ["Eukaryotic cells", "Prokaryotic cells", "Plant cells", "Animal cells"],
    "correctAnswer": 1
  },
  {
    "question": "The process of breaking down glucose to release energy in the absence of oxygen is called:",
    "options": ["Aerobic respiration", "Photosynthesis", "Fermentation", "Glycolysis"],
    "correctAnswer": 2
  },
  {
    "question": "Which biological molecule is primarily responsible for carrying genetic information from DNA to ribosomes for protein synthesis?",
    "options": ["DNA", "RNA", "Protein", "Lipid"],
    "correctAnswer": 1
  },
  {
    "question": "The 'powerhouse' of the cell, where most ATP is generated, is the:",
    "options": ["Nucleus", "Ribosome", "Mitochondrion", "Endoplasmic Reticulum"],
    "correctAnswer": 2
  },
  {
    "question": "Which part of the human brain is responsible for higher-order functions like thought, memory, and voluntary action?",
    "options": ["Cerebellum", "Brainstem", "Cerebrum", "Medulla Oblongata"],
    "correctAnswer": 2
  },
  {
    "question": "Enzymes are biological catalysts that speed up biochemical reactions by:",
    "options": ["Increasing activation energy", "Decreasing activation energy", "Changing the equilibrium of the reaction", "Consuming reactants"],
    "correctAnswer": 1
  },
  {
    "question": "According to Darwin's theory of natural selection, individuals with advantageous traits are more likely to:",
    "options": ["Migrate to new environments", "Develop new mutations", "Survive and reproduce", "Become extinct"],
    "correctAnswer": 2
  },
  
  {
    "question": "The process by which the kidney filters blood to remove waste products and maintain fluid balance is called:",
    "options": ["Digestion", "Respiration", "Osmoregulation", "Circulation"],
    "correctAnswer": 2
  },
  {
    "question": "Which blood component is responsible for oxygen transport?",
    "options": ["White Blood Cells", "Platelets", "Plasma", "Red Blood Cells"],
    "correctAnswer": 3
  },
  {
    "question": "The lymphatic system plays a crucial role in:",
    "options": ["Digestion of food", "Gas exchange", "Immunity and fluid balance", "Hormone production"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is an example of a sexually transmitted disease caused by a virus?",
    "options": ["Gonorrhea", "Syphilis", "Herpes", "Chlamydia"],
    "correctAnswer": 2
  },
  {
    "question": "The functional unit of the kidney is the:",
    "options": ["Nephron", "Ureter", "Bladder", "Urethra"],
    "correctAnswer": 0
  },
  {
    "question": "Genetic engineering involves the manipulation of:",
    "options": ["Proteins", "Lipids", "DNA", "Carbohydrates"],
    "correctAnswer": 2
  },
  {
    "question": "Which organelle is involved in detoxification and lipid synthesis?",
    "options": ["Rough ER", "Smooth ER", "Lysosome", "Peroxisome"],
    "correctAnswer": 1
  },
  {
    "question": "What is the primary function of ribosomes?",
    "options": ["Energy production", "Protein synthesis", "Waste disposal", "Cell division"],
    "correctAnswer": 1
  },
  {
    "question": "The process of maintaining a stable internal environment in an organism is called:",
    "options": ["Metabolism", "Homeostasis", "Reproduction", "Evolution"],
    "correctAnswer": 1
  },
  {
    "question": "Which part of the flower develops into a fruit after fertilization?",
    "options": ["Stamen", "Pistil", "Ovary", "Petal"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of viruses?",
    "options": ["They are prokaryotic cells.", "They have their own metabolic machinery.", "They can only reproduce inside host cells.", "They are composed of cells."],
    "correctAnswer": 2
  },
  {
    "question": "The process of gas exchange in the lungs occurs in the:",
    "options": ["Bronchi", "Trachea", "Alveoli", "Pharynx"],
    "correctAnswer": 2
  },
  {
    "question": "Which type of immunity is developed after exposure to a pathogen or vaccination?",
    "options": ["Innate immunity", "Passive immunity", "Active immunity", "Natural immunity"],
    "correctAnswer": 2
  },
  {
    "question": "The main function of white blood cells (leukocytes) is to:",
    "options": ["Transport oxygen", "Clot blood", "Fight infection", "Produce hormones"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a disaccharide?",
    "options": ["Glucose", "Fructose", "Sucrose", "Glycogen"],
    "correctAnswer": 2
  },
  {
    "question": "The human heart is a four-chambered organ. Which chamber pumps oxygenated blood to the body?",
    "options": ["Right atrium", "Left atrium", "Right ventricle", "Left ventricle"],
    "correctAnswer": 3
  },
  {
    "question": "Which part of the nervous system is responsible for involuntary actions like digestion and heartbeat?",
    "options": ["Somatic nervous system", "Autonomic nervous system", "Central nervous system", "Peripheral nervous system"],
    "correctAnswer": 1
  },
  {
    "question": "The process by which plants convert light energy into chemical energy is called:",
    "options": ["Respiration", "Transpiration", "Photosynthesis", "Fermentation"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a fat-soluble vitamin?",
    "options": ["Vitamin C", "Vitamin B12", "Vitamin A", "Folic acid"],
    "correctAnswer": 2
  },
  {
    "question": "The male reproductive organ that produces sperm is the:",
    "options": ["Penis", "Testis", "Prostate gland", "Seminal vesicle"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a structural protein found in hair and nails?",
    "options": ["Hemoglobin", "Insulin", "Keratin", "Actin"],
    "correctAnswer": 2
  },
  {
    "question": "The primary site of nutrient absorption in the human digestive system is the:",
    "options": ["Stomach", "Large intestine", "Small intestine", "Esophagus"],
    "correctAnswer": 2
  },
  {
    "question": "Which blood vessel carries deoxygenated blood from the heart to the lungs?",
    "options": ["Aorta", "Pulmonary artery", "Pulmonary vein", "Vena cava"],
    "correctAnswer": 1
  },
  {
    "question": "The process of cell division that results in two daughter cells each having the same number and kind of chromosomes as the parent nucleus is called:",
    "options": ["Meiosis", "Mitosis", "Binary fission", "Budding"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a common cause of kidney stones?",
    "options": ["Excessive water intake", "High protein diet", "Accumulation of mineral salts", "Low calcium intake"],
    "correctAnswer": 2
  },
  {
    "question": "The part of the brain that controls balance and coordination is the:",
    "options": ["Cerebrum", "Cerebellum", "Medulla oblongata", "Thalamus"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a nitrogenous waste product excreted by the kidneys?",
    "options": ["Glucose", "Amino acids", "Urea", "Fatty acids"],
    "correctAnswer": 2
  },
  {
    "question": "The condition characterized by inflammation of the joints is called:",
    "options": ["Osteoporosis", "Arthritis", "Scoliosis", "Rickets"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is an example of a conjugated molecule?",
    "options": ["Glucose", "Amino acid", "Glycolipid", "Fatty acid"],
    "correctAnswer": 2
  },
  {
    "question": "The process of thermoregulation in humans primarily involves maintaining a stable:",
    "options": ["Blood pressure", "Body temperature", "Heart rate", "Blood glucose level"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a function of the liver?",
    "options": ["Producing insulin", "Filtering blood and detoxifying chemicals", "Pumping blood", "Producing digestive enzymes"],
    "correctAnswer": 1
  },
  {
    "question": "The theory of inheritance of acquired characters was proposed by:",
    "options": ["Charles Darwin", "Gregor Mendel", "Jean-Baptiste Lamarck", "Alfred Russel Wallace"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of smooth muscles?",
    "options": ["Voluntary control", "Striated appearance", "Found in walls of internal organs", "Multinucleated cells"],
    "correctAnswer": 2
  },
  {
    "question": "The X-linked recessive inheritance pattern is observed in diseases like:",
    "options": ["Down Syndrome", "Hemophilia", "Sickle Cell Anemia", "Cystic Fibrosis"],
    "correctAnswer": 1
  },
  {
    "question": "Which part of the human respiratory system is responsible for voice production?",
    "options": ["Pharynx", "Larynx", "Trachea", "Bronchi"],
    "correctAnswer": 1
  },
  {
    "question": "The process of selective re-absorption in the kidney primarily occurs in the:",
    "options": ["Glomerulus", "Bowman's capsule", "Renal tubules", "Collecting duct"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a major component of plant cell walls?",
    "options": ["Starch", "Glycogen", "Cellulose", "Chitin"],
    "correctAnswer": 2
  },
  {
    "question": "The main function of the Golgi apparatus is:",
    "options": ["Protein synthesis", "Lipid synthesis", "Modifying, sorting, and packaging proteins and lipids", "Energy production"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a common symptom of AIDS?",
    "options": ["Sudden weight gain", "Increased immunity", "Opportunistic infections", "Improved vision"],
    "correctAnswer": 2
  },
  {
    "question": "The process by which a nerve impulse travels along an axon is called:",
    "options": ["Synapsis", "Reflex action", "Action potential", "Neurotransmission"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a primary function of platelets?",
    "options": ["Oxygen transport", "Immune response", "Blood clotting", "Hormone production"],
    "correctAnswer": 2
  },
  {
    "question": "The menstrual cycle is regulated by hormones secreted from the:",
    "options": ["Thyroid gland", "Adrenal gland", "Pituitary gland and ovaries", "Pancreas"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of cardiac muscles?",
    "options": ["Voluntary control", "Found in skeletal system", "Striated and involuntary", "Smooth and voluntary"],
    "correctAnswer": 2
  },
  {
    "question": "Mendel's Law of Segregation states that during gamete formation, the two alleles for a heritable character segregate (separate from each other) during gamete formation and end up in different gametes. This leads to a phenotypic ratio of ______ in a monohybrid cross.",
    "options": ["1:1", "3:1", "9:3:3:1", "1:2:1"],
    "correctAnswer": 1
  },
  {
    "question": "The main difference between arteries and veins is that arteries generally carry:",
    "options": ["Deoxygenated blood away from the heart", "Oxygenated blood away from the heart", "Deoxygenated blood towards the heart", "Oxygenated blood towards the heart"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a component of the human digestive system but not directly involved in chemical digestion?",
    "options": ["Stomach", "Small intestine", "Esophagus", "Pancreas"],
    "correctAnswer": 2
  },
  {
    "question": "The process of breaking down food into smaller molecules that can be absorbed by the body is called:",
    "options": ["Respiration", "Excretion", "Digestion", "Circulation"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a water-soluble vitamin?",
    "options": ["Vitamin D", "Vitamin K", "Vitamin C", "Vitamin A"],
    "correctAnswer": 2
  },
  {
    "question": "The main function of the human skeletal system is:",
    "options": ["Producing hormones", "Supporting the body and protecting organs", "Digesting food", "Transporting oxygen"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is an example of an enzyme?",
    "options": ["Glucose", "Insulin", "Amylase", "Hemoglobin"],
    "correctAnswer": 2
  },
  {
    "question": "The concept of 'gene linkage' refers to:",
    "options": ["Genes located on different chromosomes", "Genes located close together on the same chromosome", "Genes that always assort independently", "Genes that control multiple traits"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a characteristic of prokaryotic cells?",
    "options": ["Presence of mitochondria", "Presence of chloroplasts", "Absence of a true nucleus", "Presence of a cell wall made of cellulose"],
    "correctAnswer": 2
  },
  {
    "question": "The process of 'crossing over' during meiosis leads to:",
    "options": ["Identical daughter cells", "Increased genetic variation", "Decreased chromosome number", "Asexual reproduction"],
    "correctAnswer": 1
  },

  // Chemistry Questions
  {
    "question": "What is the empirical formula of a compound that contains 40% Carbon, 6.7% Hydrogen, and 53.3% Oxygen by mass? (Atomic mass: C=12, H=1, O=16)",
    "options": ["CH₂O", "C₂H₄O₂", "CHO", "C₃H₆O₃"],
    "correctAnswer": 0
  },
  {
    "question": "Which of the following quantum numbers describes the shape of an atomic orbital?",
    "options": ["Principal quantum number (n)", "Angular momentum quantum number (l)", "Magnetic quantum number (ml)", "Spin quantum number (ms)"],
    "correctAnswer": 1
  },
  {
    "question": "According to the Kinetic Molecular Theory, the average kinetic energy of gas particles is directly proportional to the:",
    "options": ["Pressure", "Volume", "Temperature in Celsius", "Absolute temperature (Kelvin)"],
    "correctAnswer": 3
  },
  {
    "question": "Which of the following is an example of an ionic crystal?",
    "options": ["Diamond", "Sodium chloride", "Ice", "Graphite"],
    "correctAnswer": 1
  },
  {
    "question": "The Haber's process is used for the industrial synthesis of:",
    "options": ["Sulfuric acid", "Ammonia", "Nitric acid", "Ethanol"],
    "correctAnswer": 1
  },
  {
    "question": "The rate constant (k) in a rate law is dependent on:",
    "options": ["Concentration of reactants", "Time", "Temperature", "Pressure"],
    "correctAnswer": 2
  },
  {
    "question": "Hess's Law states that the enthalpy change for a reaction is independent of the pathway between the initial and final states. This is a consequence of the fact that enthalpy is a:",
    "options": ["Path function", "State function", "Extensive property", "Intensive property"],
    "correctAnswer": 1
  },
  {
    "question": "In the balancing of redox reactions, the oxidation number method involves tracking the change in oxidation numbers of elements. What is the oxidation number of Chromium in K₂Cr₂O₇?",
    "options": ["+2", "+3", "+6", "+7"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following best describes a sigma (σ) bond?",
    "options": ["Formed by sideways overlap of p-orbitals", "A weaker bond than a pi bond", "Formed by direct, head-on overlap of atomic orbitals", "Present only in unsaturated compounds"],
    "correctAnswer": 2
  },
  {
    "question": "The atomic radius generally decreases across a period in the periodic table due to:",
    "options": ["Increased shielding effect", "Decreased nuclear charge", "Increased effective nuclear charge", "Increased number of electron shells"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a functional group isomer of an aldehyde?",
    "options": ["Ketone", "Alcohol", "Carboxylic acid", "Ether"],
    "correctAnswer": 0
  },
  {
    "question": "The electrophilic substitution reactions of benzene are characteristic of its:",
    "options": ["Saturated nature", "High reactivity", "Aromaticity", "Linear structure"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a nucleophilic substitution reaction?",
    "options": ["Addition of H₂ to an alkene", "Reaction of an alkyl halide with NaOH", "Combustion of methane", "Nitration of benzene"],
    "correctAnswer": 1
  },
  {
    "question": "The reaction of an alcohol with a carboxylic acid to form an ester and water is called:",
    "options": ["Hydrolysis", "Saponification", "Esterification", "Fermentation"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic reaction of aldehydes and ketones?",
    "options": ["Elimination reactions", "Nucleophilic addition reactions", "Electrophilic substitution reactions", "Free radical substitution"],
    "correctAnswer": 1
  },
  {
    "question": "Proteins are polymers of:",
    "options": ["Nucleotides", "Monosaccharides", "Amino acids", "Fatty acids"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a type of adhesive?",
    "options": ["Polyethylene", "Epoxy resin", "PVC", "Nylon"],
    "correctAnswer": 1
  },
  {
    "question": "The process of 'nitration' of benzene involves the introduction of a ______ group onto the benzene ring.",
    "options": ["-OH", "-COOH", "-NO₂", "-Cl"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is an example of a d-block element?",
    "options": ["Sodium", "Magnesium", "Zinc", "Carbon"],
    "correctAnswer": 2
  },
  {
    "question": "The boiling point of a liquid is the temperature at which its vapor pressure equals the:",
    "options": ["Atmospheric pressure", "Critical pressure", "Standard pressure", "Partial pressure"],
    "correctAnswer": 0
  },
  {
    "question": "Which of the following is a characteristic of an ideal gas?",
    "options": ["Strong intermolecular forces", "Particles have significant volume", "Elastic collisions between particles", "Particles attract each other"],
    "correctAnswer": 2
  },
  {
    "question": "The solubility product (Ksp) is a measure of the solubility of a sparingly soluble ionic compound in a saturated solution. A higher Ksp value indicates:",
    "options": ["Lower solubility", "Higher solubility", "No solubility", "Constant solubility"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is an example of a strong base?",
    "options": ["Ammonia (NH₃)", "Sodium hydroxide (NaOH)", "Water (H₂O)", "Acetic acid (CH₃COOH)"],
    "correctAnswer": 1
  },
  {
    "question": "The process of 'hydration' of an alkene involves the addition of:",
    "options": ["Hydrogen", "Halogen", "Water", "Hydrogen halide"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a structural isomer of butan-1-ol?",
    "options": ["Butanal", "Diethyl ether", "Butanoic acid", "Butan-2-ol"],
    "correctAnswer": 3
  },
  {
    "question": "The term 'molecular polarity' is determined by the presence of polar bonds and the:",
    "options": ["Number of atoms", "Molecular shape", "Bond energy", "Atomic mass"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is an example of an addition polymer?",
    "options": ["Nylon", "Polyester", "Polyvinyl chloride (PVC)", "Protein"],
    "correctAnswer": 2
  },
  {
    "question": "The reaction of an alkane with a halogen in the presence of UV light is an example of:",
    "options": ["Addition reaction", "Substitution reaction", "Elimination reaction", "Rearrangement reaction"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a characteristic of a buffer solution?",
    "options": ["It resists changes in pH upon addition of small amounts of acid or base.", "It has a pH of exactly 7.", "It is always a strong acid or strong base solution.", "It is highly corrosive."],
    "correctAnswer": 0
  },
  {
    "question": "The process of 'saponification' involves the hydrolysis of an ester in the presence of a strong base to produce:",
    "options": ["Alcohol and carboxylic acid", "Soap and glycerol", "Aldehyde and ketone", "Ether and water"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a characteristic of a covalent bond?",
    "options": ["Transfer of electrons", "Sharing of electrons", "Attraction between ions", "Formation of metallic lattice"],
    "correctAnswer": 1
  },
  {
    "question": "What is the oxidation state of oxygen in peroxides (e.g., H₂O₂)?",
    "options": ["0", "-1", "-2", "+1"],
    "correctAnswer": 1
  },
  {
    "question": "According to the Aufbau principle, electrons fill atomic orbitals in order of:",
    "options": ["Increasing energy", "Decreasing energy", "Increasing spin", "Decreasing spin"],
    "correctAnswer": 0
  },
  {
    "question": "Which of the following is an example of a coordinate covalent bond?",
    "options": ["H₂", "NaCl", "NH₄⁺", "CH₄"],
    "correctAnswer": 2
  },
  {
    "question": "The phenomenon of 'isomerism' in organic chemistry refers to compounds with the same molecular formula but different:",
    "options": ["Empirical formula", "Molar mass", "Structural formulas", "Physical states"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a strong oxidizing agent?",
    "options": ["KMnO₄", "Na", "H₂", "Cl⁻"],
    "correctAnswer": 0
  },
  {
    "question": "The term 'enthalpy of formation' refers to the enthalpy change when one mole of a compound is formed from its elements in their standard states. It is denoted by:",
    "options": ["ΔHrxn", "ΔHsol", "ΔHf°", "ΔHcomb"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of a molecular solid?",
    "options": ["High melting point", "Conducts electricity well", "Held together by intermolecular forces", "Forms a crystal lattice of ions"],
    "correctAnswer": 2
  },
  {
    "question": "The process of 'halogenation' of an alkane involves the substitution of a hydrogen atom by a:",
    "options": ["Oxygen atom", "Nitrogen atom", "Halogen atom", "Carbon atom"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is an example of a carboxylic acid derivative?",
    "options": ["Aldehyde", "Ketone", "Ester", "Alcohol"],
    "correctAnswer": 2
  },
  {
    "question": "The term 'zwitterion' refers to an amino acid that has:",
    "options": ["Only a positive charge", "Only a negative charge", "Both a positive and a negative charge", "No charge"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a common use of dyes?",
    "options": ["Fuel", "Coloring textiles", "Solvent", "Lubricant"],
    "correctAnswer": 1
  },
  {
    "question": "The process of 'cracking' in petroleum refining involves:",
    "options": ["Combining small hydrocarbons", "Breaking down large hydrocarbons into smaller ones", "Separating hydrocarbons by boiling point", "Adding hydrogen to hydrocarbons"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is an example of a Lewis acid?",
    "options": ["NH₃", "H₂O", "BF₃", "OH⁻"],
    "correctAnswer": 2
  },
  {
    "question": "The phenomenon of 'delocalization' of electrons is characteristic of:",
    "options": ["Saturated hydrocarbons", "Ionic compounds", "Aromatic compounds", "Alkyl halides"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of a strong electrolyte?",
    "options": ["Does not conduct electricity", "Partially ionizes in solution", "Completely ionizes in solution", "Forms a precipitate"],
    "correctAnswer": 2
  },
  {
    "question": "The 'functional group' in organic chemistry is a specific group of atoms within a molecule that is responsible for the characteristic chemical reactions of that molecule. Which of the following is the functional group for ketones?",
    "options": ["-OH", "-CHO", ">C=O", "-COOH"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a common industrial application of enzymes?",
    "options": ["Production of plastics", "Fermentation in brewing", "Synthesis of ammonia", "Extraction of metals"],
    "correctAnswer": 1
  },
  {
    "question": "The 'bond energy' is the energy required to break one mole of a particular type of bond in the gaseous state. A higher bond energy indicates a ______ bond.",
    "options": ["Weaker", "Stronger", "Longer", "Shorter"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a characteristic of a reversible reaction?",
    "options": ["Proceeds in one direction only", "Reaches completion quickly", "Products can react to form reactants", "Always releases heat"],
    "correctAnswer": 2
  },
  {
    "question": "The 'common ion effect' is observed when the addition of a common ion to a saturated solution of a sparingly soluble salt causes the solubility of the salt to:",
    "options": ["Increase", "Decrease", "Remain unchanged", "Become zero"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is an example of a primary amine?",
    "options": ["(CH₃)₃N", "CH₃NH₂", "(CH₃)₂NH", "C₆H₅NHC₂H₅"],
    "correctAnswer": 1
  },
  {
    "question": "The 'rate of reaction' in chemical kinetics is defined as the change in concentration of a reactant or product per unit time. It is influenced by factors such as temperature, concentration, and:",
    "options": ["Color of the solution", "Mass of the container", "Presence of a catalyst", "Volume of the reaction vessel"],
    "correctAnswer": 2
  },

  // Physics Questions
  {
    "question": "The SI unit of work is:",
    "options": ["Watt", "Joule", "Newton", "Pascal"],
    "correctAnswer": 1
  },
  {
    "question": "According to Newton's Second Law of Motion, force is directly proportional to:",
    "options": ["Velocity", "Acceleration", "Displacement", "Time"],
    "correctAnswer": 1
  },
  {
    "question": "The SI unit of angular velocity is:",
    "options": ["Revolutions per second", "Degrees per second", "Radians per second", "Meters per second"],
    "correctAnswer": 2
  },
  {
    "question": "Bernoulli's principle is based on the conservation of:",
    "options": ["Mass", "Momentum", "Energy", "Pressure"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following types of waves can travel through a vacuum?",
    "options": ["Sound waves", "Water waves", "Electromagnetic waves", "Seismic waves"],
    "correctAnswer": 2
  },
  {
    "question": "The phenomenon of forming stationary waves in a stretched string depends on the string's length, tension, and:",
    "options": ["Temperature", "Density", "Material", "Amplitude"],
    "correctAnswer": 1
  },
  {
    "question": "The internal energy of an ideal gas depends only on its:",
    "options": ["Pressure", "Volume", "Temperature", "Density"],
    "correctAnswer": 2
  },
  {
    "question": "Electric field lines originate from ______ charges and terminate on ______ charges.",
    "options": ["Negative, positive", "Positive, negative", "Neutral, positive", "Positive, neutral"],
    "correctAnswer": 1
  },
  {
    "question": "The capacitance of a parallel plate capacitor is directly proportional to the area of the plates and inversely proportional to the:",
    "options": ["Voltage across plates", "Charge on plates", "Distance between plates", "Dielectric constant"],
    "correctAnswer": 2
  },
  {
    "question": "Ohm's Law states that the current flowing through a conductor between two points is directly proportional to the voltage across the two points and inversely proportional to the:",
    "options": ["Power", "Resistance", "Energy", "Charge"],
    "correctAnswer": 1
  },
  {
    "question": "The magnetic field lines around a current-carrying wire form:",
    "options": ["Straight lines", "Concentric circles", "Spirals", "Parallel lines"],
    "correctAnswer": 1
  },
  {
    "question": "Faraday's Law of Electromagnetic Induction states that the magnitude of the induced electromotive force (EMF) is proportional to the rate of change of:",
    "options": ["Electric field", "Magnetic field", "Magnetic flux", "Current"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of alternating current (AC)?",
    "options": ["Flows in one direction only", "Has constant voltage", "Changes direction periodically", "Produced by batteries"],
    "correctAnswer": 2
  },
  {
    "question": "The photoelectric effect demonstrates the particle nature of light, where light energy is absorbed in discrete packets called:",
    "options": ["Electrons", "Protons", "Neutrons", "Photons"],
    "correctAnswer": 3
  },
  {
    "question": "Atomic spectra are produced when electrons in atoms transition between different energy levels, emitting or absorbing:",
    "options": ["Protons", "Neutrons", "Photons", "Electrons"],
    "correctAnswer": 2
  },
  {
    "question": "The half-life of a radioactive isotope is the time it takes for ______ of the radioactive nuclei in a sample to decay.",
    "options": ["One-quarter", "Half", "Three-quarters", "All"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a medical use of radiation?",
    "options": ["Sterilization of food", "Power generation", "Diagnostic imaging (e.g., X-rays)", "Industrial welding"],
    "correctAnswer": 2
  },
  {
    "question": "The SI unit of electric current is:",
    "options": ["Volt", "Ohm", "Ampere", "Watt"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is an example of a scalar product of two vectors?",
    "options": ["Force", "Velocity", "Work", "Acceleration"],
    "correctAnswer": 2
  },
  {
    "question": "The range of a projectile launched from the ground is maximum when the launch angle is:",
    "options": ["0 degrees", "30 degrees", "45 degrees", "90 degrees"],
    "correctAnswer": 2
  },
  {
    "question": "The phenomenon of resonance occurs when the frequency of an applied force matches the ______ of a system.",
    "options": ["Amplitude", "Wavelength", "Natural frequency", "Period"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of a transverse wave?",
    "options": ["Particles oscillate parallel to wave propagation", "Requires a medium to travel", "Particles oscillate perpendicular to wave propagation", "Transfers matter as well as energy"],
    "correctAnswer": 2
  },
  {
    "question": "The SI unit of pressure is:",
    "options": ["Atmosphere", "Bar", "Pascal", "Torr"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of an ideal gas?",
    "options": ["Particles attract each other strongly", "Particles have significant volume", "Collisions between particles are perfectly elastic", "Particles move in an ordered manner"],
    "correctAnswer": 2
  },
  {
    "question": "The phenomenon of 'diffraction' refers to the:",
    "options": ["Bending of light as it passes through a medium", "Bending of light around obstacles or through small openings", "Reflection of light from a surface", "Splitting of light into its component colors"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is an application of total internal reflection?",
    "options": ["Magnifying glass", "Concave mirror", "Optical fibers", "Periscope"],
    "correctAnswer": 2
  },
  {
    "question": "The SI unit of magnetic flux is:",
    "options": ["Tesla", "Weber", "Henry", "Ampere"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a characteristic of a series circuit?",
    "options": ["Voltage is the same across all components", "Current is the same through all components", "Total resistance is less than the smallest individual resistance", "Components are connected in parallel"],
    "correctAnswer": 1
  },
  {
    "question": "The concept of 'electric potential' at a point is defined as the work done in bringing a unit positive charge from infinity to that point. It is a ______ quantity.",
    "options": ["Vector", "Scalar", "Tensor", "Pseudo-vector"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a characteristic of a nuclear fission reaction?",
    "options": ["Two light nuclei combine to form a heavier nucleus", "A heavy nucleus splits into two or more lighter nuclei", "Protons and neutrons are exchanged", "Electrons are transferred between atoms"],
    "correctAnswer": 1
  },
  {
    "question": "The SI unit of electric charge density is:",
    "options": ["Coulomb per meter", "Coulomb per square meter", "Coulomb per cubic meter", "Coulomb per volt"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of a uniform electric field?",
    "options": ["Electric field lines are curved", "Electric field lines are parallel and equally spaced", "Electric field strength varies with position", "Electric potential is constant everywhere"],
    "correctAnswer": 1
  },
  {
    "question": "The phenomenon of 'polarization' of light refers to the restriction of light waves to vibrate in a single plane. This property is characteristic of ______ waves.",
    "options": ["Longitudinal", "Transverse", "Sound", "Mechanical"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is an application of the Doppler effect?",
    "options": ["Fiber optics", "Medical ultrasound imaging", "Telescopes", "Microscopes"],
    "correctAnswer": 1
  },
  {
    "question": "The SI unit of magnetic field strength is:",
    "options": ["Tesla", "Ampere-turn per meter", "Weber", "Henry"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a characteristic of a parallel circuit?",
    "options": ["Current is the same through all components", "Voltage is the same across all components", "Total resistance is the sum of individual resistances", "Components are connected in series"],
    "correctAnswer": 1
  },
  {
    "question": "The 'work function' in the photoelectric effect is the minimum energy required to:",
    "options": ["Ionize an atom", "Excite an electron to a higher energy level", "Eject an electron from a metal surface", "Create a photon"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of a nuclear fusion reaction?",
    "options": ["A heavy nucleus splits into lighter nuclei", "Two light nuclei combine to form a heavier nucleus", "Involves the decay of radioactive isotopes", "Requires low temperatures and pressures"],
    "correctAnswer": 1
  },
  {
    "question": "The SI unit of power of a lens is:",
    "options": ["Meter", "Centimeter", "Diopter", "Focal length"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of a simple harmonic motion (SHM)?",
    "options": ["Constant velocity", "Constant acceleration", "Restoring force proportional to displacement", "Motion in a circle"],
    "correctAnswer": 2
  },
  {
    "question": "The 'terminal velocity' of an object falling through a fluid is reached when the gravitational force is balanced by the:",
    "options": ["Buoyant force only", "Drag force only", "Buoyant force and drag force", "Normal force"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is an example of a standing wave?",
    "options": ["Ocean waves", "Sound waves in a pipe", "Light waves from the sun", "Radio waves from an antenna"],
    "correctAnswer": 1
  },
  {
    "question": "The 'refractive index' of a medium is a measure of how much the speed of light is reduced in that medium compared to its speed in a vacuum. It is a ______ quantity.",
    "options": ["Vector", "Scalar", "Dimensionless", "Unitless"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of a conductor?",
    "options": ["High electrical resistivity", "Low electrical conductivity", "Allows free flow of electrons", "Does not allow heat transfer"],
    "correctAnswer": 2
  },
  {
    "question": "The 'internal resistance' of a battery causes the terminal voltage to be ______ than its electromotive force (EMF) when current is drawn.",
    "options": ["Greater", "Less", "Equal", "Independent"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is an application of electromagnetic induction?",
    "options": ["Electric motor", "Generator", "Transformer", "All of the above"],
    "correctAnswer": 3
  },
  {
    "question": "The 'Compton effect' demonstrates the particle nature of X-rays, where X-ray photons scatter off electrons, resulting in a change in:",
    "options": ["Frequency", "Wavelength", "Speed", "Direction"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a characteristic of a semiconductor?",
    "options": ["Very high conductivity", "Very low conductivity", "Conductivity between conductors and insulators", "Does not conduct electricity at all"],
    "correctAnswer": 2
  },
  {
    "question": "The 'mass-energy equivalence' principle, stated by Einstein, is given by the equation:",
    "options": ["F=ma", "E=mc²", "V=IR", "P=W/t"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a biological effect of radiation?",
    "options": ["Increased cell growth", "DNA damage", "Improved vision", "Enhanced nutrient absorption"],
    "correctAnswer": 1
  },
  {
    "question": "The 'principle of conservation of momentum' states that in an isolated system, the total momentum remains constant. This applies to:",
    "options": ["Only elastic collisions", "Only inelastic collisions", "Both elastic and inelastic collisions", "Only explosions"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of a concave lens?",
    "options": ["Thicker at the center", "Converges light rays", "Forms only real images", "Thinner at the center and diverges light rays"],
    "correctAnswer": 3
  },
  {
    "question": "The 'Doppler effect' explains the apparent change in frequency of a wave due to the relative motion between the source and the:",
    "options": ["Medium", "Observer", "Wavelength", "Amplitude"],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is a characteristic of a gas at STP (Standard Temperature and Pressure)?",
    "options": ["Temperature of 0°C and pressure of 1 atm", "Temperature of 25°C and pressure of 1 atm", "Temperature of 0 K and pressure of 1 atm", "Temperature of 273.15 K and pressure of 101.325 kPa"],
    "correctAnswer": 3
  },
  {
    "question": "The 'Brewster's angle' is the angle of incidence at which light reflected from a surface is completely polarized. This phenomenon is related to:",
    "options": ["Diffraction", "Interference", "Refraction", "Reflection"],
    "correctAnswer": 3
  },
  {
    "question": "Which of the following is a characteristic of a superconductor?",
    "options": ["Zero electrical resistance below a critical temperature", "High electrical resistance at all temperatures", "Only conducts electricity at high temperatures", "Used as an insulator"],
    "correctAnswer": 0
  },
  {
    "question": "The 'Snell's Law' describes the relationship between the angles of incidence and refraction for light passing through an interface between two different media. It involves the:",
    "options": ["Speed of light", "Wavelength of light", "Refractive indices of the media", "Frequency of light"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of a standing wave?",
    "options": ["Transfers energy", "Has fixed nodes and antinodes", "Travels through space", "Has continuously changing amplitude"],
    "correctAnswer": 1
  },
  {
    "question": "The 'principle of moments' states that for an object to be in rotational equilibrium, the sum of clockwise moments about any point must be equal to the sum of ______ moments about the same point.",
    "options": ["Anticlockwise", "Linear", "Translational", "Net"],
    "correctAnswer": 0
  },
  {
    "question": "Which of the following is a characteristic of a nuclear reactor?",
    "options": ["Uses nuclear fusion to generate power", "Uses controlled nuclear fission to generate power", "Produces only radioactive waste", "Does not require fuel"],
    "correctAnswer": 1
  },
  {
    "question": "The 'Rutherford model' of the atom proposed that:",
    "options": ["Electrons orbit the nucleus in fixed energy levels", "Atoms are indivisible spheres", "The atom has a small, dense, positively charged nucleus", "Electrons are embedded in a positively charged sphere"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is a characteristic of a black body radiator?",
    "options": ["Reflects all incident radiation", "Absorbs all incident radiation", "Emits radiation only at specific wavelengths", "Has a temperature of 0 K"],
    "correctAnswer": 1
  },

  // English Questions
  {
    "question": "Choose the most appropriate synonym for 'proficient'.",
    "options": ["Incompetent", "Skilled", "Amateur", "Clumsy"],
    "correctAnswer": 1
  },
  {
    "question": "Identify the type of sentence: 'What a wonderful surprise!'",
    "options": ["Declarative", "Interrogative", "Imperative", "Exclamatory"],
    "correctAnswer": 3
  },
  {
    "question": "Which of the following is an example of a correlative conjunction?",
    "options": ["And", "But", "Neither...nor", "Or"],
    "correctAnswer": 2
  },
  {
    "question": "Choose the correct verb tense to complete the sentence: 'She ___ her homework before dinner yesterday.'",
    "options": ["do", "does", "did", "done"],
    "correctAnswer": 2
  },
  {
    "question": "Convert the following into direct speech: 'He told me that he was tired.'",
    "options": ["He said, \"I am tired.\"", "He said, \"He is tired.\"", "He told me, \"I was tired.\"", "He said, \"I was tired.\""],
    "correctAnswer": 0
  },
  {
    "question": "Which word is an antonym of 'augment'?",
    "options": ["Increase", "Expand", "Decrease", "Enlarge"],
    "correctAnswer": 2
  },
  {
    "question": "Fill in the blank with the appropriate pronoun: 'The book is ___ on the table.'",
    "options": ["its", "it's", "their", "there"],
    "correctAnswer": 0
  },
  {
    "question": "Identify the gerund phrase in the sentence: 'Swimming in the ocean is my favorite activity.'",
    "options": ["Swimming in the ocean", "in the ocean", "my favorite activity", "is my favorite"],
    "correctAnswer": 0
  },
  {
    "question": "Which of the following sentences uses correct capitalization?",
    "options": ["I live in new york city.", "I live in New York City.", "i live in new york city.", "I live in New york city."],
    "correctAnswer": 1
  },
  {
    "question": "Choose the word that means 'to make something impure or less effective'.",
    "options": ["Purify", "Enhance", "Contaminate", "Improve"],
    "correctAnswer": 2
  },
  {
    "question": "What is the correct spelling?",
    "options": ["Occasion", "Occassion", "Ocassion", "Ocasion"],
    "correctAnswer": 0
  },
  {
    "question": "Identify the collective noun: 'A ___ of lions.'",
    "options": ["Herd", "Pack", "Pride", "Flock"],
    "correctAnswer": 2
  },
  {
    "question": "Choose the sentence with correct parallel structure:",
    "options": ["She enjoys hiking, swimming, and to cycle.", "She enjoys hiking, swimming, and cycling.", "She enjoys to hike, to swim, and cycling.", "She enjoys hiking, to swim, and to cycle."],
    "correctAnswer": 1
  },
  {
    "question": "Which of the following is an example of a metaphor?",
    "options": ["The world is like a stage.", "The world is a stage.", "He runs like a cheetah.", "She is as brave as a lion."],
    "correctAnswer": 1
  },
  {
    "question": "Choose the correct punctuation for a list of items:",
    "options": ["I need milk, eggs, and bread.", "I need milk; eggs; and bread.", "I need milk eggs and bread.", "I need: milk, eggs, and bread."],
    "correctAnswer": 0
  },
  {
    "question": "Identify the adverb of manner: 'He spoke softly to the child.'",
    "options": ["He", "spoke", "softly", "child"],
    "correctAnswer": 2
  },
  {
    "question": "Which of the following is an example of an oxymoron?",
    "options": ["Jumbo shrimp", "As busy as a bee", "The early bird catches the worm", "Break a leg"],
    "correctAnswer": 0
  },
  {
    "question": "Choose the correct possessive pronoun: 'The cat licked ___ paw.'",
    "options": ["it's", "its", "their", "his"],
    "correctAnswer": 1
  },
  {
    "question": "The literary device that involves a contrast between what is said and what is actually meant is called:",
    "options": ["Irony", "Simile", "Metaphor", "Hyperbole"],
    "correctAnswer": 0
  },
  {
    "question": "Which of the following is a common error in pronoun usage?",
    "options": ["Subject-verb agreement", "Dangling modifier", "Ambiguous pronoun reference", "Run-on sentence"],
    "correctAnswer": 2
  },
  {
    "question": "Choose the word that means 'to make something better or more bearable'.",
    "options": ["Worsen", "Aggravate", "Ameliorate", "Deteriorate"],
    "correctAnswer": 2
  },
  {
    "question": "Identify the correct use of a dash:",
    "options": ["He bought a car-a red one.", "He bought a car - a red one.", "He bought a car a red one.", "He bought a car, a red one."],
    "correctAnswer": 0
  },
  {
    "question": "Which of the following is an example of a compound-complex sentence?",
    "options": ["She sings and he dances.", "Although she sings, he dances.", "She sings, and he dances when he is happy.", "She sings when she is happy."],
    "correctAnswer": 2
  },
  {
    "question": "Choose the word that means 'to express strong disapproval or disagreement'.",
    "options": ["Approve", "Commend", "Censure", "Praise"],
    "correctAnswer": 2
  },
  {
    "question": "Identify the type of clause: 'who lives next door' in the sentence 'The man who lives next door is friendly.'",
    "options": ["Independent clause", "Adverbial clause", "Adjective clause", "Noun clause"],
    "correctAnswer": 2
  }
];

    // This assumes all your questions have 4 options and one correct answer.
    // Ensure this data structure is consistent.

    // Initialize user answers array
    for (let i = 0; i < originalQuestions.length; i++) {
        userAnswers.push(null); // null indicates not attempted
    }

    // --- Utility Functions ---
    // `shuffleArray` function ko hata diya gaya hai kyunki ab questions aur options shuffle nahi honge.
    function formatTime(seconds) {
        const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
        const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
        const s = String(seconds % 60).padStart(2, '0');
        return `${h}:${m}:${s}`;
    }

    function showSection(sectionId) {
        passwordSection.classList.add('hidden');
        quizSection.classList.add('hidden');
        resultSection.classList.add('hidden');
        reviewSection.classList.add('hidden');
        document.getElementById(sectionId).classList.remove('hidden');
    }

    function calculateAggregate(mdcatScore) {
        // SSC marks contribute 10%, FSc marks 40%, MDCAT 50%
        // Assuming marks are out of 1100 for SSC and 1100 for FSc
        const sscWeight = 0.10;
        const fscWeight = 0.40;
        const mdcatWeight = 0.50;

        const sscPercentage = (sscObtainedMarks / sscTotalMarks) * 100;
        const fscPercentage = (fscObtainedMarks / fscTotalMarks) * 100;

        const aggregate = (sscPercentage * sscWeight) + (fscPercentage * fscWeight) + (mdcatScore * mdcatWeight);
        return aggregate.toFixed(2);
    }

    function showToast(type, title, message) {
        const toast = document.createElement('div');
        toast.classList.add('toast', type, 'fixed', 'top-4', 'right-4', 'z-[1000]', 'flex', 'items-center', 'gap-3', 'p-4', 'rounded-lg', 'shadow-lg', 'transition-all', 'duration-300', 'ease-out');
        
        // Tailwind classes for toast types
        let bgColor, textColor, borderColor, iconClass;
        if (type === 'success') {
            bgColor = 'bg-green-100 dark:bg-green-900/50';
            textColor = 'text-green-800 dark:text-green-300';
            borderColor = 'border-green-500 dark:border-green-700';
            iconClass = 'fa-circle-check text-green-500 dark:text-green-400';
        } else if (type === 'error') {
            bgColor = 'bg-red-100 dark:bg-red-900/50';
            textColor = 'text-red-800 dark:text-red-300';
            borderColor = 'border-red-500 dark:border-red-700';
            iconClass = 'fa-circle-xmark text-red-500 dark:text-red-400';
        } else if (type === 'info') {
            bgColor = 'bg-blue-100 dark:bg-blue-900/50';
            textColor = 'text-blue-800 dark:text-blue-300';
            borderColor = 'border-blue-500 dark:border-blue-700';
            iconClass = 'fa-circle-info text-blue-500 dark:text-blue-400';
        }

        // Correctly add classes by splitting them if they contain spaces
        toast.classList.add(...bgColor.split(' '));
        toast.classList.add(...textColor.split(' '));
        toast.classList.add('border-l-4'); // This is a single class
        toast.classList.add(...borderColor.split(' '));

        toast.innerHTML = `
            <i class="fa-solid ${iconClass} text-xl"></i>
            <div>
                <p class="font-semibold">${title}</p>
                <p class="text-sm">${message}</p>
            </div>
        `;
        toastContainer.appendChild(toast);

        // Animate in
        setTimeout(() => {
            toast.classList.remove('opacity-0', 'translate-x-full');
            toast.classList.add('opacity-100', 'translate-x-0');
        }, 10); // Small delay to ensure transition applies

        // Animate out and remove after 3 seconds
        setTimeout(() => {
            toast.classList.remove('opacity-100', 'translate-x-0');
            toast.classList.add('opacity-0', 'translate-x-full');
            toast.addEventListener('transitionend', () => toast.remove(), { once: true });
        }, 3000);
    }


    // --- Theme Toggle ---
    function toggleTheme() {
        document.documentElement.classList.toggle('dark'); // Toggle dark class on html element
        if (document.documentElement.classList.contains('dark')) {
            localStorage.setItem('theme', 'dark');
        } else {
            localStorage.setItem('theme', 'light');
        }
        updateThemeIcon();
    }

    function updateThemeIcon() {
        const themeToggleIcon = themeToggleBtn.querySelector('i');
        if (document.documentElement.classList.contains('dark')) {
            themeToggleIcon.classList.remove('fa-moon');
            themeToggleIcon.classList.add('fa-sun');
        } else {
            themeToggleIcon.classList.remove('fa-sun');
            themeToggleIcon.classList.add('fa-moon');
        }
    }

   function checkTheme() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark');
    } else if (savedTheme === 'light') {
        document.documentElement.classList.remove('dark');
    } else {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    }
    updateThemeIcon();
}


    // --- Fullscreen Toggle ---
    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().then(updateFullscreenIcon);
        } else {
            document.exitFullscreen().then(updateFullscreenIcon);
        }
    }

    function updateFullscreenIcon() {
        if (document.fullscreenElement) {
            fullscreenIcon.classList.remove('fa-expand');
            fullscreenIcon.classList.add('fa-compress');
            fullscreenToggleBtn.title = "Exit Fullscreen";
        } else {
            fullscreenIcon.classList.remove('fa-compress');
            fullscreenIcon.classList.add('fa-expand');
            fullscreenToggleBtn.title = "Toggle Fullscreen";
        }
    }

    // --- Quiz Functions ---
    function startTimer() {
        testStartTime = Date.now();
        timerInterval = setInterval(() => {
            timeRemaining--;
            if (timeRemaining < 0) {
                timeRemaining = 0;
                clearInterval(timerInterval);
                submitTest();
                showToast('info', 'Time Up!', 'Your test has been automatically submitted.');
            }
            timerDisplay.textContent = formatTime(timeRemaining);
        }, 1000);
    }

    function displayQuestion() {
        const question = shuffledQuestions[currentQuestionIndex]; // Ab 'shuffledQuestions' mein original order hai
        questionCounter.textContent = `Question ${currentQuestionIndex + 1}/${shuffledQuestions.length}`;
        questionText.innerHTML = `${currentQuestionIndex + 1}. ${question.question}`;
        optionsContainer.innerHTML = ''; // Pichle options clear karein

        // Options (ab original order mein) current question ke liye
        const optionsToDisplay = shuffledOptionsMap.get(currentQuestionIndex);

        optionsToDisplay.forEach((option, originalIndex) => { // originalIndex yahan optionsToDisplay array ke andar ka index hai
            const optionDiv = document.createElement('div');
            optionDiv.classList.add('flex', 'items-center', 'gap-3', 'bg-slate-100', 'dark:bg-slate-700', 'p-4', 'rounded-lg', 'cursor-pointer', 'transition-all', 'duration-150', 'ease-in-out', 'hover:bg-slate-200', 'dark:hover:bg-slate-600');
            optionDiv.dataset.originalIndex = originalIndex; // original index store karein correctAnswer se map karne ke liye

            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'questionOptions';
            radio.id = `option${originalIndex}`; // Unique ID ke liye originalIndex use karein
            radio.value = originalIndex; // Value ke roop mein original index store karein
            radio.classList.add('appearance-none', 'w-4', 'h-4', 'border-2', 'border-slate-400', 'dark:border-slate-500', 'rounded-full', 'checked:bg-indigo-500', 'checked:border-indigo-500', 'dark:checked:bg-blue-400', 'dark:checked:border-blue-400', 'relative', 'flex-shrink-0', 'cursor-pointer');
            radio.style.setProperty('--tw-ring-color', 'rgba(99, 102, 241, 0.5)'); // Custom property for ring color
            radio.style.setProperty('--tw-ring-offset-color', 'var(--bg-slate-100)'); // Custom property for ring offset color

            // Custom checked state indicator
            const checkedIndicator = document.createElement('div');
            checkedIndicator.classList.add('absolute', 'top-1/2', 'left-1/2', '-translate-x-1/2', '-translate-y-1/2', 'w-2', 'h-2', 'bg-white', 'rounded-full', 'pointer-events-none', 'opacity-0', 'transition-opacity', 'duration-150');
            radio.addEventListener('change', () => {
                if (radio.checked) {
                    checkedIndicator.classList.remove('opacity-0');
                } else {
                    checkedIndicator.classList.add('opacity-0');
                }
            });

            const label = document.createElement('label');
            label.htmlFor = `option${originalIndex}`;
            label.classList.add('text-lg', 'font-medium', 'text-slate-800', 'dark:text-slate-200', 'cursor-pointer', 'flex-1');
            label.textContent = option;

            optionDiv.appendChild(radio);
            radio.appendChild(checkedIndicator); // Indicator ko radio ke andar append karein positioning ke liye
            optionDiv.appendChild(label);
            optionsContainer.appendChild(optionDiv);

            optionDiv.addEventListener('click', () => {
                radio.checked = true;
                userAnswers[currentQuestionIndex] = parseInt(optionDiv.dataset.originalIndex); // Selected option ka original index store karein
                updatePaletteButton(currentQuestionIndex, 'attempted');
                highlightSelectedOption(optionDiv);
            });

            // Check karein agar yeh option pehle se user ne select kiya tha
            if (userAnswers[currentQuestionIndex] === originalIndex) {
                radio.checked = true;
                highlightSelectedOption(optionDiv);
                checkedIndicator.classList.remove('opacity-0');
            }
        });

        // Navigation buttons update karein
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.textContent = currentQuestionIndex === shuffledQuestions.length - 1 ? 'Submit Test' : 'Next';
        nextBtn.classList.toggle('bg-indigo-500', currentQuestionIndex < shuffledQuestions.length - 1);
        nextBtn.classList.toggle('hover:bg-indigo-600', currentQuestionIndex < shuffledQuestions.length - 1);
        nextBtn.classList.toggle('bg-green-600', currentQuestionIndex === shuffledQuestions.length - 1);
        nextBtn.classList.toggle('hover:bg-green-700', currentQuestionIndex === shuffledQuestions.length - 1);
    }

    function highlightSelectedOption(selectedDiv) {
        document.querySelectorAll('.option-item').forEach(div => {
            div.classList.remove('border-2', 'border-indigo-500', 'dark:border-blue-400', 'bg-indigo-50', 'dark:bg-slate-700');
            div.classList.add('border', 'border-slate-200', 'dark:border-slate-700', 'bg-slate-100', 'dark:bg-slate-800/50');
        });
        selectedDiv.classList.add('border-2', 'border-indigo-500', 'dark:border-blue-400', 'bg-indigo-50', 'dark:bg-slate-700');
        selectedDiv.classList.remove('border-slate-200', 'dark:border-700', 'bg-slate-100', 'dark:bg-slate-800/50');
    }


    function populateQuestionPalette() {
        questionPalette.innerHTML = '';
        shuffledQuestions.forEach((_, index) => {
            const button = document.createElement('button');
            button.classList.add('w-10', 'h-10', 'rounded-full', 'flex', 'items-center', 'justify-center', 'font-semibold', 'text-sm', 'flex-shrink-0', 'transition-all', 'duration-150', 'ease-in-out');
            button.textContent = index + 1;
            button.dataset.index = index;

            // Initial state: unanswered
            button.classList.add('bg-slate-300', 'text-slate-800', 'dark:bg-slate-700', 'dark:text-slate-200');

            if (index === currentQuestionIndex) {
                button.classList.remove('bg-slate-300', 'dark:bg-slate-700');
                button.classList.add('bg-indigo-500', 'text-white', 'dark:bg-blue-500', 'transform', 'scale-110');
            }

            button.addEventListener('click', () => {
                currentQuestionIndex = index;
                displayQuestion();
                updatePaletteSelection();
            });
            questionPalette.appendChild(button);
        });
    }

    function updatePaletteButton(index, status) {
        const button = questionPalette.querySelector(`button[data-index="${index}"]`);
        if (button) {
            button.classList.remove('bg-slate-300', 'text-slate-800', 'dark:bg-slate-700', 'dark:text-slate-200', 'bg-green-500', 'text-white', 'bg-indigo-500', 'dark:bg-blue-500', 'transform', 'scale-110');
            
            if (status === 'attempted') {
                button.classList.add('bg-green-500', 'text-white', 'dark:bg-green-600');
            } else if (status === 'unattempted') {
                 button.classList.add('bg-slate-300', 'text-slate-800', 'dark:bg-slate-700', 'dark:text-slate-200');
            }
            // Ensure current question is always highlighted
            if (index === currentQuestionIndex) {
                button.classList.remove('bg-slate-300', 'dark:bg-slate-700', 'bg-green-500', 'dark:bg-green-600');
                button.classList.add('bg-indigo-500', 'text-white', 'dark:bg-blue-500', 'transform', 'scale-110');
            } else {
                button.classList.remove('transform', 'scale-110');
            }
        }
    }

    function updatePaletteSelection() {
        questionPalette.querySelectorAll('button').forEach(btn => {
            btn.classList.remove('bg-indigo-500', 'text-white', 'dark:bg-blue-500', 'transform', 'scale-110');
            
            if (userAnswers[parseInt(btn.dataset.index)] === null) {
                btn.classList.add('bg-slate-300', 'text-slate-800', 'dark:bg-slate-700', 'dark:text-slate-200');
                btn.classList.remove('bg-green-500', 'dark:bg-green-600');
            } else {
                 btn.classList.add('bg-green-500', 'text-white', 'dark:bg-green-600');
                 btn.classList.remove('bg-slate-300', 'dark:bg-slate-700');
            }
        });
        const currentButton = questionPalette.querySelector(`button[data-index="${currentQuestionIndex}"]`);
        if (currentButton) {
            currentButton.classList.remove('bg-slate-300', 'dark:bg-slate-700', 'bg-green-500', 'dark:bg-green-600');
            currentButton.classList.add('bg-indigo-500', 'text-white', 'dark:bg-blue-500', 'transform', 'scale-110');
        }
    }

    // Function to update circular progress bars
    function setCircleProgress(circleElement, textElement, percentage) {
        const radius = 15.9155; // This value is derived from the 'd' attribute in your SVG paths
        const circumference = 2 * Math.PI * radius;
        const offset = circumference - (percentage / 100) * circumference;

        circleElement.style.strokeDasharray = `${circumference} ${circumference}`;
        circleElement.style.strokeDashoffset = offset;
        textElement.textContent = `${percentage.toFixed(1)}%`;
    }

    function submitTest() {
        clearInterval(timerInterval);
        showSection('resultSection');
        calculateResults();
    }

    function calculateResults() {
        let correctCount = 0;
        let incorrectCount = 0;
        let attemptedCount = 0;

        shuffledQuestions.forEach((shuffledQuestion, index) => {
            const userAnswer = userAnswers[index];
            if (userAnswer !== null) {
                attemptedCount++;
                // Get the original correct answer index for the current shuffled question
                const originalCorrectAnswerIndex = shuffledQuestion.correctAnswer;
                if (userAnswer === originalCorrectAnswerIndex) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
            }
        });

        const unattemptedCount = shuffledQuestions.length - attemptedCount;
        const mdcatRawScore = (correctCount * 5) - (incorrectCount * 0); // Assuming 5 marks for correct, 0 for incorrect

        // MDCAT score percentage calculation
        const maxMdcatScore = shuffledQuestions.length * 5;
        const mdcatPercentage = (mdcatRawScore / maxMdcatScore) * 100;

        // Calculate Academic Percentages
        const sscPercentage = (sscObtainedMarks / sscTotalMarks) * 100;
        const fscPercentage = (fscObtainedMarks / fscTotalMarks) * 100;

        // Calculate Aggregate Percentage (MDCAT 70%, F.Sc. 20%, SSC 10%)
        const aggregatePercentage =
            (mdcatPercentage * 0.70) +
            (fscPercentage * 0.20) +
            (sscPercentage * 0.10);

        totalQuestionsResult.textContent = shuffledQuestions.length;
        attemptedQuestionsResult.textContent = attemptedCount;
        correctAnswersResult.textContent = correctCount;
        incorrectAnswersResult.textContent = incorrectCount;
        unattemptedQuestionsResult.textContent = unattemptedCount;
        timeTakenResult.textContent = formatTime(totalTestDuration - timeRemaining);
        
        setCircleProgress(mdcatScoreCircle, mdcatScoreCircleText, mdcatPercentage);
        setCircleProgress(aggregateScoreCircle, aggregateScoreCircleText, aggregatePercentage);

        // Display status messages
        statusContainer.innerHTML = '';
        const statusMessages = getStatusMessages(mdcatPercentage, aggregatePercentage);
        statusMessages.forEach(msg => {
            const statusPill = document.createElement('div');
            statusPill.classList.add('flex', 'items-center', 'gap-2', 'bg-slate-100', 'dark:bg-slate-700', 'p-3', 'rounded-lg');
            statusPill.innerHTML = `<p class="font-medium text-slate-800 dark:text-slate-200 flex items-center gap-2"><i class="fa-solid ${msg.icon} text-${msg.color}-500 dark:text-${msg.color}-400"></i> <strong>${msg.title}:</strong> <span class="flex-1">${msg.message}</span></p>`;
            statusContainer.appendChild(statusPill);
        });
    }

    function getStatusMessages(mdcatScorePercentage, aggregatePercentage) {
        const messages = [];

        // MDCAT Status
        if (mdcatScorePercentage >= 60) {
            messages.push({ title: "MDCAT Status", message: "PASSED", icon: "fa-circle-check", color: "green" });
        } else {
            messages.push({ title: "MDCAT Status", message: "FAILED", icon: "fa-circle-xmark", color: "red" });
        }

        // F.Sc. Status (assuming 50% passing for F.Sc. contribution)
        const fscPercentage = (fscObtainedMarks / fscTotalMarks) * 100;
        if (fscPercentage >= 50) {
            messages.push({ title: "F.Sc. Status", message: "PASSED", icon: "fa-circle-check", color: "green" });
        } else {
            messages.push({ title: "F.Sc. Status", message: "FAILED", icon: "fa-circle-xmark", color: "red" });
        }

        // Overall Admission Status (e.g., Aggregate >= 75%)
        if (aggregatePercentage >= 75) {
            messages.push({ title: "Overall Admission", message: "QUALIFIED", icon: "fa-award", color: "blue" });
        } else {
            messages.push({ title: "Overall Admission", message: "NOT QUALIFIED", icon: "fa-times-circle", color: "red" });
        }

        // General Feedback
        if (aggregatePercentage >= 85) {
            messages.push({ title: "Feedback", message: "Excellent performance! You are well on your way to success.", icon: "fa-star", color: "yellow" });
        } else if (aggregatePercentage >= 70) {
            messages.push({ title: "Feedback", message: "Great job! Keep practicing to achieve even higher scores.", icon: "fa-lightbulb", color: "indigo" });
        } else if (aggregatePercentage >= 50) {
            messages.push({ title: "Feedback", message: "Good effort, but there's room for improvement. Focus on your weaker areas.", icon: "fa-chart-line", color: "orange" });
        } else {
            messages.push({ title: "Feedback", message: "Don't give up! Consistent practice and reviewing concepts will help you improve.", icon: "fa-redo-alt", color: "red" });
        }
        return messages;
    }

    // --- Review Section Functions ---
    function displayReviewQuestion() {
        // Add robust checks for data existence
        if (!shuffledQuestions || shuffledQuestions.length === 0) {
            console.error("No questions available for review.");
            reviewQuestionDisplay.innerHTML = '<p class="text-red-500 dark:text-red-400">No questions to review. Please start and complete a test first.</p>';
            reviewPrevBtn.disabled = true;
            reviewNextBtn.disabled = true;
            return;
        }

        // Ensure currentReviewQuestionIndex is within valid bounds
        if (currentReviewQuestionIndex < 0) {
            currentReviewQuestionIndex = 0;
        } else if (currentReviewQuestionIndex >= shuffledQuestions.length) {
            currentReviewQuestionIndex = shuffledQuestions.length - 1;
        }

        const question = shuffledQuestions[currentReviewQuestionIndex];
        if (!question) {
            console.error("Question at currentReviewQuestionIndex is undefined:", currentReviewQuestionIndex);
            reviewQuestionDisplay.innerHTML = '<p class="text-red-500 dark:text-red-400">Error loading question. Please restart the test.</p>';
            reviewPrevBtn.disabled = true;
            reviewNextBtn.disabled = true;
            return;
        }

        const userAnswerOriginalIndex = userAnswers[currentReviewQuestionIndex]; // This is the original index of the user's selected option
        const correctAnswerOriginalIndex = question.correctAnswer; // This is the original index of the correct answer

        // Get the options (ab original order mein) for the current review question
        const optionsForReview = shuffledOptionsMap.get(currentReviewQuestionIndex);
        if (!optionsForReview || !Array.isArray(optionsForReview)) {
            console.error("Options for review are invalid or missing for index:", currentReviewQuestionIndex);
            reviewQuestionDisplay.innerHTML = '<p class="text-red-500 dark:text-red-400">Error loading options for review. Please restart the test.</p>';
            reviewPrevBtn.disabled = true;
            reviewNextBtn.disabled = true;
            return;
        }

        let optionsHtml = optionsForReview.map((optionText, optionIndex) => { // optionIndex yahan optionsForReview array ke andar ka index hai
            let iconClass = 'fa-circle text-slate-400 dark:text-slate-500'; // Default icon
            let optionClasses = 'bg-slate-100 dark:bg-slate-700'; // Default background

            if (optionIndex === correctAnswerOriginalIndex) {
                iconClass = 'fa-check-circle text-green-500 dark:text-green-400';
                optionClasses = 'bg-green-100 dark:bg-green-900/50 border border-green-200 dark:border-green-700';
            }

            if (userAnswerOriginalIndex !== null && optionIndex === userAnswerOriginalIndex) {
                if (optionIndex === correctAnswerOriginalIndex) {
                    // User selected correctly - already handled by correct class
                } else {
                    iconClass = 'fa-times-circle text-red-500 dark:text-red-400';
                    optionClasses = 'bg-red-100 dark:bg-red-900/50 border border-red-200 dark:border-red-700';
                }
            }

            return `
                <div class="flex items-center gap-3 p-3 rounded-lg ${optionClasses}">
                    <i class="fa-solid ${iconClass} text-lg flex-shrink-0"></i>
                    <p class="flex-1 text-slate-800 dark:text-slate-200 ${optionIndex === correctAnswerOriginalIndex ? 'font-semibold' : ''}">${optionText}</p>
                </div>
            `;
        }).join('');

        let statusMessageHtml = '';
        if (userAnswerOriginalIndex === null) {
            statusMessageHtml = `<p class="mt-4 font-semibold text-yellow-600 dark:text-yellow-400 flex items-center gap-2"><i class="fa-solid fa-triangle-exclamation"></i> Not Attempted</p>`;
        } else if (userAnswerOriginalIndex !== correctAnswerOriginalIndex) {
            statusMessageHtml = `
                <p class="mt-4 font-semibold text-red-600 dark:text-red-400 flex items-center gap-2"><i class="fa-solid fa-circle-xmark"></i> Your Answer: <span class="font-normal">${originalQuestions[shuffledQuestions[currentReviewQuestionIndex].originalIndex].options[userAnswerOriginalIndex]}</span></p>
                <p class="mt-2 font-semibold text-green-600 dark:text-green-400 flex items-center gap-2"><i class="fa-solid fa-circle-check"></i> Correct Answer: <span class="font-normal">${originalQuestions[shuffledQuestions[currentReviewQuestionIndex].originalIndex].options[correctAnswerOriginalIndex]}</span></p>
            `;
        } else {
            statusMessageHtml = `<p class="mt-4 font-semibold text-green-600 dark:text-green-400 flex items-center gap-2"><i class="fa-solid fa-circle-check"></i> Your Answer is Correct!</p>`;
        }


        reviewQuestionDisplay.innerHTML = `
            <div class="bg-slate-50 dark:bg-slate-700 p-6 rounded-lg border border-slate-200 dark:border-slate-600">
                <p class="text-xl font-semibold text-slate-900 dark:text-slate-50 mb-4">${currentReviewQuestionIndex + 1}. ${question.question}</p>
                <div class="flex flex-col gap-3">
                    ${optionsHtml}
                </div>
                ${statusMessageHtml}
            </div>
        `;

        // More robust disabling conditions
        reviewPrevBtn.disabled = currentReviewQuestionIndex <= 0;
        reviewNextBtn.disabled = currentReviewQuestionIndex >= shuffledQuestions.length - 1;
    }

    // --- Modal Functions ---
    function showConfirmationModal() {
        confirmationModal.classList.add('show');
    }

    function hideConfirmationModal() {
        confirmationModal.classList.remove('show');
    }


    // --- Event Listeners ---
    startTestBtn.addEventListener('click', () => {
        const password = testPasswordInput.value;
        const sscObtained = parseInt(sscObtainedInput.value);
        const sscTotal = parseInt(sscTotalInput.value);
        const fscObtained = parseInt(fscObtainedInput.value);
        const fscTotal = parseInt(fscTotalInput.value);

        let isValid = true;

        // Reset error messages
        passwordError.classList.add('hidden');
        sscError.classList.add('hidden');
        fscError.classList.add('hidden');

        if (password !== quizPassword) {
            passwordError.classList.remove('hidden');
            isValid = false;
        }

        if (isNaN(sscObtained) || isNaN(sscTotal) || sscObtained < 0 || sscTotal <= 0 || sscObtained > sscTotal) {
            sscError.classList.remove('hidden');
            isValid = false;
        }

        if (isNaN(fscObtained) || isNaN(fscTotal) || fscObtained < 0 || fscTotal <= 0 || fscObtained > fscTotal) {
            fscError.classList.remove('hidden');
            isValid = false;
        }

        if (isValid) {
            sscObtainedMarks = sscObtained;
            sscTotalMarks = sscTotal;
            fscObtainedMarks = fscObtained;
            fscTotalMarks = fscTotal;
            
            // Questions aur options ab original order mein aayenge
            shuffledQuestions = [...originalQuestions].map((q,idx) => ({...q, originalIndex: idx})); // Questions ko original order mein rakhein
            shuffledOptionsMap.clear(); // Pichla options map clear karein
            shuffledQuestions.forEach((q, qIndex) => {
                shuffledOptionsMap.set(qIndex, [...q.options]); // Options ko bhi original order mein rakhein
            });

            userAnswers = Array(shuffledQuestions.length).fill(null); // Naye test ke liye user answers reset karein

            showSection('quizSection');
            populateQuestionPalette();
            displayQuestion();
            startTimer();
            showToast('success', 'Test Started!', 'Good luck with your mock test.');
        } else {
            showToast('error', 'Input Error', 'Please correct the highlighted fields.');
        }
    });

    prevBtn.addEventListener('click', () => {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            displayQuestion();
            updatePaletteSelection();
        }
    });

    nextBtn.addEventListener('click', () => {
        if (currentQuestionIndex < shuffledQuestions.length - 1) {
            currentQuestionIndex++;
            displayQuestion();
            updatePaletteSelection();
        } else {
            showConfirmationModal(); // Submit karne se pehle confirmation modal dikhayein
        }
    });

    // Modal button event listeners
    cancelSubmissionBtn.addEventListener('click', hideConfirmationModal);
    confirmSubmissionBtn.addEventListener('click', () => {
        hideConfirmationModal();
        submitTest();
        showToast('info', 'Test Submitted', 'Your test results are ready.');
    });


    restartBtn.addEventListener('click', () => {
        // Sabhi state variables reset karein
        currentQuestionIndex = 0;
        userAnswers = Array(originalQuestions.length).fill(null); // Original length ke liye reset karein
        shuffledQuestions = []; // Questions clear karein
        shuffledOptionsMap.clear(); // Options clear karein
        timeRemaining = totalTestDuration;
        clearInterval(timerInterval); // Agar koi timer chal raha hai toh clear karein
        timerDisplay.textContent = formatTime(totalTestDuration); // Timer display reset karein
        testPasswordInput.value = '';
        sscObtainedInput.value = '';
        sscTotalInput.value = '';
        fscObtainedInput.value = '';
        fscTotalInput.value = '';
        passwordError.classList.add('hidden');
        sscError.classList.add('hidden');
        fscError.classList.add('hidden');
        currentReviewQuestionIndex = 0; // Review section ke liye reset karein

        showSection('passwordSection');
        showToast('info', 'Test Restarted', 'Please enter password and marks to start again.');
    });

    reviewBtn.addEventListener('click', () => {
        currentReviewQuestionIndex = 0; // Review pehle question se shuru karein
        showSection('reviewSection');
        displayReviewQuestion();
    });

    reviewPrevBtn.addEventListener('click', () => {
        if (currentReviewQuestionIndex > 0) {
            currentReviewQuestionIndex--;
            displayReviewQuestion();
        }
    });

    reviewNextBtn.addEventListener('click', () => {
        if (currentReviewQuestionIndex < shuffledQuestions.length - 1) {
            currentReviewQuestionIndex++;
            displayReviewQuestion();
        }
    });

    backToResultsBtn.addEventListener('click', () => {
        showSection('resultSection');
    });

    savePdfBtn.addEventListener('click', () => {
        window.print();
    });

    themeToggleBtn.addEventListener('click', toggleTheme);

    fullscreenToggleBtn.addEventListener('click', toggleFullscreen);


    // Page load hone par initial checks
    checkTheme();
    showSection('passwordSection'); // Default roop se password section dikhayein
});
</script>

</body>
</html>
