<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDCAT Mock Test - Enhanced UI</title>
    
    <!-- Google Fonts: Poppins (for headings) and Inter (for body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Tailwind CSS CDN (MUST be loaded before tailwind.config) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwind CSS Configuration for Dark Mode -->
    <script>
        // Tailwind कॉन्फ़िगरेशन को Tailwind CDN स्क्रिप्ट के बाद लोड किया जाना चाहिए।
        // The Tailwind configuration must be loaded after the Tailwind CDN script.
        tailwind.config = {
            darkMode: 'class', // HTML टैग पर 'dark' क्लास के आधार पर डार्क मोड सक्षम करें
            // Enable dark mode based on 'dark' class on HTML tag
            theme: {
                extend: {
                    // आप चाहें तो यहां अपनी थीम का विस्तार कर सकते हैं
                    // You can extend your theme here if needed
                }
            }
        }
    </script>
    <style>
        /* Custom CSS for fonts and scrollbar, not easily done with Tailwind */
        body {
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }
        /* Custom scrollbar for the question palette */
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
            width: 8px; /* For vertical scrollbars if needed */
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #e2e8f0; /* slate-200 */
            border-radius: 10px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b; /* slate-800 */
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #3b82f6; /* blue-500 */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #2563eb; /* blue-600 */
        }
        
        /* Custom styles for the circular progress bar */
        .score-circle-svg {
            width: 100%;
            height: 100%;
        }
        .circle-bg {
            fill: none;
            stroke: #e2e8f0; /* slate-200 */
            stroke-width: 3.8;
        }
        .dark .circle-bg {
            stroke: #334155; /* slate-700 */
        }
        .circle-progress {
            fill: none;
            stroke-width: 2.8;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease-out;
            transform: rotate(-90deg); /* Apply rotation only to the progress path */
            transform-origin: 50% 50%; /* Ensure rotation is around the center */
        }
        .mdcat-progress {
            stroke: #6366f1; /* indigo-500 */
        }
        .aggregate-progress {
            stroke: #00BCD4; /* secondary-color */
        }
        .circle-text {
            fill: #0f172a; /* slate-900 */
            font-family: 'Poppins', sans-serif;
            font-size: 6.5px; /* Adjusted smaller font size */
            font-weight: 700;
            text-anchor: middle;
        }
        .dark .circle-text {
            fill: #f8fafc; /* slate-50 */
        }

        /* Print Styles for PDF Export */
        @media print {
            body {
                background-color: #fff !important;
                color: #000 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .no-print {
                display: none !important;
            }
            .main-content-area {
                padding: 0 !important;
                margin: 0 !important;
                min-height: auto !important;
                display: block !important;
            }
            section.card {
                box-shadow: none !important;
                border: 1px solid #ccc !important;
                padding: 1rem !important;
                margin: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                background: #fff !important;
            }
            #resultSection .text-3xl, #reviewSection .text-3xl {
                font-size: 24pt;
                text-align: center;
                border-bottom: 2px solid #000;
                padding-bottom: 10px;
                margin-bottom: 20px;
                color: #000 !important;
            }
            .grid {
                display: block !important;
            }
            .score-circle-container {
                display: none; /* Hide chart in print */
            }
            .status-pill, .review-option-item {
                border: 1px solid #ccc !important;
                background-color: #f9f9f9 !important;
            }
             .status-pill p, .status-pill strong, .status-pill span,
             .review-option-item p, .review-option-item i {
                 color: #000 !important;
            }
            .review-question-item {
                page-break-inside: avoid;
                margin-bottom: 1rem;
                border-top: 1px solid #eee;
                padding-top: 1rem;
            }
             .review-option-item.correct {
                 background-color: #e6fffa !important;
             }
             .review-option-item.incorrect {
                 background-color: #fff5f5 !important;
             }
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .dark .modal-content {
            background-color: #1e293b; /* slate-800 */
            color: #f8fafc; /* slate-50 */
        }
    </style>
</head>
<body class="bg-gray-100 text-slate-700 dark:bg-gray-900 dark:text-slate-300 transition-all duration-300 ease-in-out">

    <!-- Navbar -->
    <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200 dark:bg-slate-900/80 dark:border-slate-800 sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <a href="#" class="flex items-center gap-3 text-2xl font-extrabold text-indigo-500 dark:text-blue-400">
                <i class="fa-solid fa-book-open"></i>
                <span>MDCAT Mock Test 6</span>
            </a>
            <div class="flex items-center gap-4">
                <button id="fullscreenToggle" class="w-10 h-10 rounded-full flex items-center justify-center text-slate-700 bg-slate-200 hover:bg-slate-300 dark:text-slate-300 dark:bg-slate-800 dark:hover:bg-slate-700 transition" title="Toggle Fullscreen">
                    <i class="fa-solid fa-expand" id="fullscreenIcon"></i>
                </button>
                <button id="themeToggle" class="w-10 h-10 rounded-full flex items-center justify-center text-indigo-500 bg-slate-200 hover:bg-slate-300 dark:text-blue-400 dark:bg-slate-800 dark:hover:bg-slate-700 transition" title="Toggle Theme">
                    <i class="fa-solid fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="min-h-[calc(100vh-64px)] flex items-center justify-center p-4 sm:p-6 lg:p-8">
        <div class="w-full max-w-4xl mx-auto">

            <!-- Password Protection Section -->
            <section id="passwordSection" class="bg-white dark:bg-slate-800/50 p-8 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 transition-all duration-300 ease-in-out">
                <div class="text-center">
                    <h2 class="text-3xl font-extrabold text-slate-800 dark:text-slate-50">Start Your Test</h2>
                    <p class="mt-2 text-slate-600 dark:text-slate-400">Enter the test password and your academic marks to begin.</p>
                </div>

                <div class="mt-8 max-w-md mx-auto flex flex-col gap-6">
                    <div>
                        <label for="testPassword" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Test Password</label>
                        <input type="password" id="testPassword" class="mt-1 block w-full p-3 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-slate-800 dark:text-slate-50 placeholder-slate-400 dark:placeholder-slate-500" placeholder="••••••••••">
                        <p id="passwordError" class="text-red-500 text-sm mt-1 hidden">Incorrect password. Please try again.</p>
                    </div>

                    <div class="bg-blue-50 dark:bg-slate-800 p-4 rounded-lg text-center border border-blue-200 dark:border-slate-700">
                        <p class="text-sm text-blue-800 dark:text-blue-300">
                            <i class="fa-solid fa-circle-info mr-1"></i> <strong>NOTICE:</strong> All tests are password protected.<br>
                            For password, please contact on WhatsApp: <a href="https://wa.me/+923480358640" target="_blank" class="font-semibold text-blue-600 dark:text-blue-400 hover:underline">+92 348 0358640</a>
                        </p>
                    </div>

                    <div class="academic-marks-section">
                        <h3 class="pt-6 text-lg font-semibold text-slate-800 dark:text-slate-50 border-t border-slate-200 dark:border-slate-700">Academic Marks (for Merit Calculation)</h3>
                        <div class="space-y-4 mt-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">SSC Marks</label>
                                <div class="flex items-center gap-2 mt-1">
                                    <input type="number" id="sscObtained" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-slate-800 dark:text-slate-50 placeholder-slate-400 dark:placeholder-slate-500" placeholder="Obtained" min="0">
                                    <span class="text-slate-600 dark:text-slate-400">/</span>
                                    <input type="number" id="sscTotal" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-slate-800 dark:text-slate-50 placeholder-slate-400 dark:placeholder-slate-500" placeholder="Total" min="1">
                                </div>
                                <p id="sscError" class="text-red-500 text-sm mt-1 hidden">Please enter valid SSC marks (Obtained &lt;= Total, Total &gt; 0).</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300">F.Sc. Marks</label>
                                <div class="flex items-center gap-2 mt-1">
                                    <input type="number" id="fscObtained" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-slate-800 dark:text-slate-50 placeholder-slate-400 dark:placeholder-slate-500" placeholder="Obtained" min="0">
                                    <span class="text-slate-600 dark:text-slate-400">/</span>
                                    <input type="number" id="fscTotal" class="block w-full p-3 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 focus:outline-none text-slate-800 dark:text-slate-50 placeholder-slate-400 dark:placeholder-slate-500" placeholder="Total" min="1">
                                </div>
                                <p id="fscError" class="text-red-500 text-sm mt-1 hidden">Please enter valid F.Sc. marks (Obtained &lt;= Total, Total &gt; 0).</p>
                            </div>
                        </div>
                    </div>

                    <button id="startTestBtn" class="w-full py-3 px-4 bg-indigo-500 text-white font-bold rounded-lg shadow-lg shadow-indigo-500/30 hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:shadow-blue-500/20 dark:hover:bg-blue-600 dark:focus:ring-offset-slate-900 transition-all duration-300 ease-in-out transform hover:scale-105">
                        Start Test
                    </button>
                </div>
            </section>

            <!-- Quiz Section -->
            <section id="quizSection" class="hidden">
                <div class="bg-white dark:bg-slate-800/50 p-8 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 transition-all duration-300 ease-in-out">
                    <div class="flex flex-col sm:flex-row justify-between items-center pb-4 border-b border-slate-200 dark:border-slate-700 gap-4">
                        <!-- Question counter updated to reflect 200 questions -->
                        <h3 id="questionCounter" class="text-lg font-semibold text-slate-800 dark:text-slate-50">Question 1/200</h3>
                        <div id="timer" class="flex items-center gap-2 text-xl font-bold text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/50 py-2 px-4 rounded-full border border-red-200 dark:border-red-500/30">
                            <i class="fa-solid fa-clock"></i>
                            <span>03:30:00</span>
                        </div>
                    </div>

                    <div class="mt-6">
                        <h4 id="questionText" class="text-xl font-bold text-slate-900 dark:text-slate-50 leading-tight"></h4>
                        <div id="optionsContainer" class="flex flex-col gap-4 mt-6">
                        </div>
                    </div>

                    <div class="flex justify-between mt-8 no-print">
                        <button id="prevBtn" class="py-3 px-6 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600 transition">Previous</button>
                        <button id="nextBtn" class="py-3 px-6 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600 transition">Next</button>
                    </div>
                </div>

                <div class="bg-white dark:bg-slate-800/50 p-4 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 mt-6 no-print">
                    <h4 class="text-sm font-semibold text-slate-600 dark:text-slate-400 mb-3">Question Palette</h4>
                    <div id="questionPalette" class="flex flex-nowrap gap-2 overflow-x-auto pb-2 custom-scrollbar">
                        <!-- Question palette buttons will be generated here by JS -->
                    </div>
                </div>
            </section>

            <!-- Result Section -->
            <section id="resultSection" class="hidden">
                <div class="bg-white dark:bg-slate-800/50 p-8 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 text-center transition-all duration-300 ease-in-out">
                    <h2 class="text-3xl font-extrabold text-slate-800 dark:text-slate-50">Test Completed!</h2>
                    <p class="mt-2 text-slate-600 dark:text-slate-400">Here's a summary of your performance.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8 items-center">
                        <!-- MDCAT Score Circle -->
                        <div class="flex flex-col items-center justify-center">
                            <div class="w-52 h-52 relative flex items-center justify-center">
                                <svg class="score-circle-svg" viewBox="0 0 36 36">
                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle-progress mdcat-progress" id="mdcatScoreCircle" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <text x="18" y="18" class="circle-text" id="mdcatScoreCircleText"></text>
                                </svg>
                            </div>
                            <p class="mt-2 text-lg font-semibold text-slate-700 dark:text-slate-300">MDCAT Score</p>
                        </div>

                        <!-- Aggregate Score Circle -->
                        <div class="flex flex-col items-center justify-center">
                            <div class="w-52 h-52 relative flex items-center justify-center">
                                <svg class="score-circle-svg" viewBox="0 0 36 36">
                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle-progress aggregate-progress" id="aggregateScoreCircle" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <text x="18" y="18" class="circle-text" id="aggregateScoreCircleText"></text>
                                </svg>
                            </div>
                            <p class="mt-2 text-lg font-semibold text-slate-700 dark:text-slate-300">Aggregate Score</p>
                        </div>

                        <div class="flex flex-col gap-3 text-left">
                            <div class="flex items-center justify-between bg-slate-100 dark:bg-slate-700 p-3 rounded-lg">
                                <span class="font-medium text-slate-700 dark:text-slate-300">Total Questions</span>
                                <!-- Total questions result updated to reflect 200 questions -->
                                <strong id="totalQuestionsResult" class="text-lg font-bold text-slate-900 dark:text-slate-50">200</strong>
                            </div>
                            <div class="flex items-center justify-between bg-slate-100 dark:bg-slate-700 p-3 rounded-lg">
                                <span class="font-medium text-slate-700 dark:text-slate-300">Attempted</span>
                                <strong id="attemptedQuestionsResult" class="text-lg font-bold text-slate-900 dark:text-slate-50">0</strong>
                            </div>
                            <div class="flex items-center justify-between bg-green-100 dark:bg-green-900/50 p-3 rounded-lg">
                                <span class="font-medium text-green-600 dark:text-green-400">Correct</span>
                                <strong id="correctAnswersResult" class="text-lg font-bold text-green-600 dark:text-green-400">0</strong>
                            </div>
                            <div class="flex items-center justify-between bg-red-100 dark:bg-red-900/50 p-3 rounded-lg">
                                <span class="font-medium text-red-600 dark:text-red-400">Incorrect</span>
                                <strong id="incorrectAnswersResult" class="text-lg font-bold text-red-600 dark:text-red-400">0</strong>
                            </div>
                             <div class="flex items-center justify-between bg-yellow-100 dark:bg-yellow-900/50 p-3 rounded-lg">
                                <span class="font-medium text-yellow-600 dark:text-yellow-400">Unattempted</span>
                                <strong id="unattemptedQuestionsResult" class="text-lg font-bold text-yellow-600 dark:text-yellow-400">0</strong>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-slate-200 dark:border-slate-700 text-center flex flex-col gap-4">
                         <div>
                            <p class="text-sm text-slate-600 dark:text-slate-400">Time Taken</p>
                            <p id="timeTakenResult" class="text-xl font-bold text-slate-900 dark:text-slate-50">00:00:00</p>
                        </div>
                        <div id="statusContainer" class="flex flex-col gap-2">
                            <!-- Status messages will be dynamically added here -->
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8 no-print">
                        <button id="restartBtn" class="py-3 px-6 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600 transition">Restart Test</button>
                        <button id="reviewBtn" class="py-3 px-6 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 dark:bg-blue-500 dark:hover:bg-blue-600 transition">Review Answers</button>
                        <button id="savePdfBtn" class="py-3 px-6 bg-slate-600 text-white font-semibold rounded-lg hover:bg-slate-700 transition">Save as PDF</button>
                    </div>
                </div>
            </section>

            <!-- Review Section -->
            <section id="reviewSection" class="hidden">
                 <div class="bg-white dark:bg-slate-800/50 p-8 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 transition-all duration-300 ease-in-out">
                    <div class="flex justify-between items-center pb-4 border-b border-slate-200 dark:border-slate-700">
                        <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-50">Review Answers</h2>
                        <button id="backToResultsBtn" class="text-indigo-500 dark:text-blue-400 font-semibold hover:underline no-print">Back to Results</button>
                    </div>
                    
                    <div id="reviewQuestionDisplay" class="mt-6">
                        <!-- Review question and options will be displayed here -->
                    </div>

                    <div class="flex justify-between mt-8 no-print">
                        <button id="reviewPrevBtn" class="py-3 px-6 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600 transition">Previous</button>
                        <button id="reviewNextBtn" class="py-3 px-6 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600 transition">Next</button>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white/80 backdrop-blur-md border-t border-slate-200 dark:bg-slate-900/80 dark:border-slate-800 py-4 text-center no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <p class="text-sm text-slate-600 dark:text-slate-400">&copy; 2025 MDCAT Test Prep Portal. All rights reserved.</p>
        </div>
    </footer>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-[1000] flex flex-col gap-2"></div>

    <!-- Confirmation Modal for Test Submission -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-slate-800 dark:text-slate-50 mb-4">Submit Test?</h3>
            <p class="text-slate-600 dark:text-slate-400 mb-6">Are you sure you want to submit the test? Once submitted, you cannot change your answers.</p>
            <div class="flex justify-center gap-4">
                <button id="cancelSubmissionBtn" class="py-2 px-5 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600 transition">Cancel</button>
                <button id="confirmSubmissionBtn" class="py-2 px-5 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 dark:bg-blue-500 dark:hover:bg-blue-600 transition">Submit</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // --- Element Selectors ---
    const passwordSection = document.getElementById('passwordSection');
    const quizSection = document.getElementById('quizSection');
    const resultSection = document.getElementById('resultSection');
    const reviewSection = document.getElementById('reviewSection');

    const testPasswordInput = document.getElementById('testPassword');
    const sscObtainedInput = document.getElementById('sscObtained');
    const sscTotalInput = document.getElementById('sscTotal');
    const fscObtainedInput = document.getElementById('fscObtained');
    const fscTotalInput = document.getElementById('fscTotal');
    const startTestBtn = document.getElementById('startTestBtn');
    const passwordError = document.getElementById('passwordError');
    const sscError = document.getElementById('sscError');
    const fscError = document.getElementById('fscError');

    const questionCounter = document.getElementById('questionCounter');
    const timerDisplay = document.querySelector('#timer span');
    const questionPalette = document.getElementById('questionPalette');
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    const totalQuestionsResult = document.getElementById('totalQuestionsResult');
    const attemptedQuestionsResult = document.getElementById('attemptedQuestionsResult');
    const correctAnswersResult = document.getElementById('correctAnswersResult');
    const incorrectAnswersResult = document.getElementById('incorrectAnswersResult');
    const unattemptedQuestionsResult = document.getElementById('unattemptedQuestionsResult');
    const timeTakenResult = document.getElementById('timeTakenResult');
    const mdcatScoreCircle = document.getElementById('mdcatScoreCircle');
    const mdcatScoreCircleText = document.getElementById('mdcatScoreCircleText');
    const aggregateScoreCircle = document.getElementById('aggregateScoreCircle');
    const aggregateScoreCircleText = document.getElementById('aggregateScoreCircleText');
    const statusContainer = document.getElementById('statusContainer');
    const reviewBtn = document.getElementById('reviewBtn');
    const restartBtn = document.getElementById('restartBtn');
    const savePdfBtn = document.getElementById('savePdfBtn');

    const reviewQuestionDisplay = document.getElementById('reviewQuestionDisplay');
    const reviewPrevBtn = document.getElementById('reviewPrevBtn');
    const reviewNextBtn = document.getElementById('reviewNextBtn');
    const backToResultsBtn = document.getElementById('backToResultsBtn');
    const themeToggleBtn = document.getElementById('themeToggle');
    const fullscreenToggleBtn = document.getElementById('fullscreenToggle');
    const fullscreenIcon = document.getElementById('fullscreenIcon');
    const toastContainer = document.getElementById('toastContainer');

    const confirmationModal = document.getElementById('confirmationModal');
    const cancelSubmissionBtn = document.getElementById('cancelSubmissionBtn');
    const confirmSubmissionBtn = document.getElementById('confirmSubmissionBtn');


    // --- State Variables ---
    const quizPassword = "mdcattestbymk";
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let timerInterval;
    const totalTestDuration = 3 * 60 * 60; // 3 hours in seconds
    let timeRemaining = totalTestDuration;
    let testStartTime;
    let sscObtainedMarks = 0, sscTotalMarks = 1, fscObtainedMarks = 0, fscTotalMarks = 1;
    let currentReviewQuestionIndex = 0; // Added for review section navigation
    let shuffledQuestions = []; // To store shuffled questions
    let shuffledOptionsMap = new Map(); // To store shuffled options for each question

    // --- Questions Data (Full 200 Questions) ---
    // The originalQuestions array has been truncated to 200 questions.
   const originalQuestions = [
    // Biology
    {
        "question": "In normal individuals, the systolic pressure is",
        "options": ["120 mmHg", "80 mmHg", "160 mmHg", "200 mmHg"],
        "correctAnswer": 0
    },
    {
        "question": "The system which is responsible for the transport and returning of materials from the tissues of the body to blood is called",
        "options": ["Blood vascular system", "Nervous system", "Lymphatic system", "Endocrine system"],
        "correctAnswer": 2
    },
    {
        "question": "Lithotripsy is an example of:",
        "options": ["Chemotherapy", "Radiotherapy", "Gene therapy", "Physical therapy"],
        "correctAnswer": 3
    },
    {
        "question": "Chymotrypsin is a component of:",
        "options": ["Bile", "Pancreatic juice", "Intestinal juice", "Gastric juice"],
        "correctAnswer": 1
    },
    {
        "question": "Which of the following amino acid is next to glycine with respect to the molecular structure?",
        "options": ["Alanine", "Serine", "Ethanolamine", "Aspartic acid"],
        "correctAnswer": 0
    },
    {
        "question": "In birds the male is the homogametic sex. A male bird showing the recessive trait was mated with a female showing the dominant trait of a characteristic governed by a pair of alleles which are sex linked. What is the probability that the male offspring will show the dominant trait?",
        "options": ["0", "0.25", "0.50", "0.75", "1.0"],
        "correctAnswer": 0
    },
    {
        "question": "Which of the following pair of structure present convergent evolution?",
        "options": ["Wings of bat and insect", "Wings of bat and birds", "Fore limbs of bat and whale", "Fore limbs of bat and man"],
        "correctAnswer": 0
    },
    {
        "question": "During expiration, the diaphragm becomes:",
        "options": ["Less dome-shaped", "Flattened", "Oblique", "More dome-shaped"],
        "correctAnswer": 3
    },
    {
        "question": "Which of the following pair is/are not analogous organs?",
        "options": ["Wings of bat and butterfly", "Wings of birds and pectoral fins of fish", "Wings of birds and insect", "Legs of frog and cockroach."],
        "correctAnswer": 1
    },
    {
        "question": "All of the following functions are performed by kidneys except:",
        "options": ["Help in blood cell formation", "Hormone production", "Maintaining acid base balance", "Ammonia production."],
        "correctAnswer": 3
    },
    {
        "question": "All of the following are sexually transmitted diseases except:",
        "options": ["Syphilis", "Gonorrhea", "Alzheimer's Disease", "Genital herpes", "AIDS"],
        "correctAnswer": 2
    },
    {
        "question": "Hydrostatic skeleton can be seen in",
        "options": ["Earth worm", "Round worm", "Flat worm", "All of these"],
        "correctAnswer": 3
    },
    {
        "question": "Chemical digestion of food begins at:",
        "options": ["Stomach", "Ileum", "Oral cavity", "Duodenum"],
        "correctAnswer": 2
    },
    {
        "question": "Synovial capsule surrounds the ________ joint.",
        "options": ["Hinge joint", "Ball and socket joint", "A and B both are", "None of these"],
        "correctAnswer": 2
    },
    {
        "question": "Which of the following is a inhibitors in a chemical substances",
        "options": ["Cyanide", "Antibodies", "Anti-metabolites", "All of above"],
        "correctAnswer": 3
    },
    {
        "question": "Blood vessels with walls that are only one cell thick is called",
        "options": ["Veins", "Arteries", "Arterioles", "Capillaries"],
        "correctAnswer": 3
    },
    {
        "question": "Which statement about the enzyme is not true",
        "options": ["They consists of protein", "The change the rate of catalyzed", "They are sensitive to heat", "They are non-specific in their action."],
        "correctAnswer": 3
    },
    {
        "question": "The point of attachment of two bones",
        "options": ["Joint", "Synapse", "Elbow", "Knee"],
        "correctAnswer": 0
    },
    {
        "question": "Which of the following condition is responsible for increase in ventilation rate?",
        "options": ["Decrease in O2 content of inhaled air", "Decrease in O2 content of exhaled air", "Increase of CO2 content in inhaled air", "Increase of CO2 content in exhaled air"],
        "correctAnswer": 2
    },
    {
        "question": "Penicillin is a kind of antibiotic which works as:",
        "options": ["Resistor", "Uncompetitive inhibitor", "Non-competitive inhibitor", "Competitive inhibitor"],
        "correctAnswer": 3
    },
    {
        "question": "Any foreign body that may activate immune system:",
        "options": ["Antigen", "Antibodies", "Immunoglobulin", "Plasmogen."],
        "correctAnswer": 0
    },
    {
        "question": "The optimum pH of pepsin is",
        "options": ["7", "7.4", "2", "1"],
        "correctAnswer": 2
    },
    {
        "question": "The minimum age of a fossil is:",
        "options": ["10 years", "10 month", "10 thousand years", "10 million years"],
        "correctAnswer": 2
    },
    {
        "question": "All of following are common molecules in membrane of all type of cells except:",
        "options": ["Globular protein", "Cholesterol", "Polysaccharides", "Phospholipid"],
        "correctAnswer": 2
    },
    {
        "question": "RNA is synthesized by DNA in a process called",
        "options": ["Replication", "Transcription", "Translation", "None of above"],
        "correctAnswer": 1
    },
    {
        "question": "Specific immunity is the result of:",
        "options": ["1st line of defense", "2nd line of defense", "3rd line of defense", "4th line of defense"],
        "correctAnswer": 2
    },
    {
        "question": "Immunity is the capacity of body for all except:",
        "options": ["Recognize antigen", "Increase antibodies production", "Mobilize Lymphocytes", "Mobilize hemoglobin"],
        "correctAnswer": 3
    },
    {
        "question": "Color blindness and hemophilia in man are controlled by",
        "options": ["Dominant genes", "Recessive genes", "Both of these", "None of these"],
        "correctAnswer": 1
    },
    {
        "question": "The effectors of the motor neurons are",
        "options": ["Bones", "Skin", "Brain", "Muscles and glands"],
        "correctAnswer": 3
    },
    {
        "question": "Viroid differ from viruses in being:",
        "options": ["Naked RNA molecule only", "Naked DNA molecule only", "Naked DNA packaged with viral genome", "Satellite RNA packaged with viral genome"],
        "correctAnswer": 0
    },
    {
        "question": "Which of the following processes results in the production of water during aerobic respiration?",
        "options": ["Glycolysis", "Krebs cycle", "Electron transport chain", "Fermentation"],
        "correctAnswer": 2
    },
    {
        "question": "The animals of phylum annelids have",
        "options": ["Open circulatory system", "No specialized circulatory system", "Closed circulatory system", "None"],
        "correctAnswer": 2
    },
    {
        "question": "The transport of secretory proteins takes place through organelles in which of the following order?",
        "options": ["RER → SER → Golgi apparatus → Secretory vesicles", "SER → RER → Golgi apparatus → Secretory vesicles", "RER → SER → Secretory vesicles → Golgi apparatus", "RER → Golgi apparatus → Secretory vesicles → SER"],
        "correctAnswer": 0
    },
    {
        "question": "Which structure helps fresh water protozoa and paramecium to pump out excess water",
        "options": ["Food vacuole", "Contractile vacuole", "Nucleus", "Absorption"],
        "correctAnswer": 1
    },
    {
        "question": "The enzyme reverse transcriptase essentially found in all retroviruses is:",
        "options": ["DNA dependent RNA polymerase", "DNA dependent DNA polymerase", "RNA dependent RNA polymerase", "RNA dependent DNA polymerase"],
        "correctAnswer": 3
    },
    {
        "question": "Important components of mechanism of homeostatic regulation are:",
        "options": ["Receptors, control center and effectors", "Sensory, motor and associative neurons", "CNS, peripheral nervous system and diffused nervous system", "Cerebrum, cerebellum and pons"],
        "correctAnswer": 0
    },
    {
        "question": "Rings present in trachea which prevent it from collapsing and keep the air passage way open, are:",
        "options": ["\"O\" shaped", "\"D\" shaped", "\"C\" shaped", "\"G\" shaped"],
        "correctAnswer": 2
    },
    {
        "question": "In juxtamedullary nephrons additional capillaries extend down to form a loop of vessels called",
        "options": ["Renal pelvis", "Renal hillus", "Vasa recta", "Renal medulla"],
        "correctAnswer": 2
    },
    {
        "question": "Modification of proteins and lipids into glycoproteins and glycolipids occurs in:",
        "options": ["Mitochondria", "Rough endoplasmic reticulum", "Smooth endoplasmic reticulum", "Golgi apparatus."],
        "correctAnswer": 3
    },
    {
        "question": "Albinos have a genotype of aa, while all other members of population are either AA or Aa. The offspring of a cross between a heterozygous male and albino female would be",
        "options": ["100% albino", "100% normal", "50% normal, 50% albino", "25% normal, 75% albino"],
        "correctAnswer": 2
    },
    {
        "question": "A man who has type AB blood could not father a child with type ____ blood, because he would pass on either the ____ or the ____ allele to all of his offspring.",
        "options": ["A, O", "O, A", "B, O", "O, B, A."],
        "correctAnswer": 1
    },
    {
        "question": "Gene sequence can be deduced in which direction?",
        "options": ["3' → 5'", "3' → 3'", "5' → 3'", "5' → 5'"],
        "correctAnswer": 2
    },
    {
        "question": "The joint present between the bones of forearm and wrist is called:",
        "options": ["Pivot joint", "Ball and socket joint", "Multistage joint", "Hinge joint."],
        "correctAnswer": 3
    },
    {
        "question": "Large intestine of human is divided into",
        "options": ["transverse colon", "Ascending colon", "Descending colon and Caecum", "All of above"],
        "correctAnswer": 3
    },
    {
        "question": "Which set of qualities is related to monosaccharides?",
        "options": ["not sweet, insoluble in water, can be hydrolyzed into simple sugar", "sweet, insoluble in water, cannot be hydrolyzed into simpler sugars", "Sweet, soluble in water, cannot be hydrolyzed into simpler sugars", "sweet, soluble in water, can be hydrolyzed to simpler sugars."],
        "correctAnswer": 2
    },
    {
        "question": "The blood is passed on to right ventricle through",
        "options": ["Tricuspid value", "Bicuspid value", "Unicuspid value", "Chordae tendinae."],
        "correctAnswer": 0
    },
    {
        "question": "In vertebrates there are ________ types of muscles:",
        "options": ["One", "Two", "Three", "Four."],
        "correctAnswer": 2
    },
    {
        "question": "Which part of the central nervous system control's the body water balance?",
        "options": ["Cerebellum", "Cerebrum", "Hypothalamus", "Medulla"],
        "correctAnswer": 2
    },
    {
        "question": "Which enzyme catalyzes the conversion of fructose-6-phosphate to fructose-1,6-bisphosphate in glycolysis?",
        "options": ["Hexokinase", "Phosphofructokinase", "Aldolase", "Enolase"],
        "correctAnswer": 1
    },
    {
        "question": "What is the final electron acceptor in aerobic respiration?",
        "options": ["NAD+", "CO2", "O2", "Glucose"],
        "correctAnswer": 2
    },
    {
        "question": "The technique used to separate bands of DNA on gel is called:",
        "options": ["Water bath", "Thermocycler", "Electroporation", "Electrophoresis"],
        "correctAnswer": 3
    },
    {
        "question": "The evaporation loss of water is called",
        "options": ["Dehydration", "Transpiration", "Transduction", "All of above."],
        "correctAnswer": 1
    },
    {
        "question": "Digestive enzyme for carbohydrate is",
        "options": ["Amylase", "Pepsin", "Hydrogenase", "Oxygenase"],
        "correctAnswer": 0
    },
    {
        "question": "The cytoplasmic processes which carry impulses towards the cell body is",
        "options": ["Axon", "Dendron", "Cell body", "Myelin sheath"],
        "correctAnswer": 1
    },
    {
        "question": "Which one yields ATP required for muscle contraction?",
        "options": ["Myoglobin", "Creatine phosphate", "Creatinine", "Phosphate"],
        "correctAnswer": 1
    },
    {
        "question": "Neuron are cells adapted for rapid transmissions of electric impulses. Its ____ are very long than its dendrites.",
        "options": ["Axon", "Dendrites", "Myelin sheath", "Schwann cells"],
        "correctAnswer": 0
    },
    {
        "question": "Which statement about enzymes is essential to the lock & key hypothesis?",
        "options": ["Enzymes are specific to one substrate only", "Enzyme molecules are catalysts", "Enzyme molecules can be damaged by high temperature", "Enzyme molecules can be damaged by high pH value"],
        "correctAnswer": 0
    },
    {
        "question": "Which of the following is the site of glycolysis?",
        "options": ["Mitochondria", "Ribosomes", "Cytoplasm", "Nucleus"],
        "correctAnswer": 2
    },
    {
        "question": "A function that is not related to smooth endoplasmic reticulum:",
        "options": ["Detoxification", "Enzyme synthesis", "Lipid synthesis", "Mechanical support."],
        "correctAnswer": 1
    },
    {
        "question": "What are fossils?",
        "options": ["Dead remains of organisms", "Impressions of past organisms", "Traces of primitive organisms", "All A, B, C"],
        "correctAnswer": 3
    },
    {
        "question": "____ is a junction between two neurons or between a motor neuron & a muscle cell.",
        "options": ["Impulse", "Synapse", "Axon", "Cleft"],
        "correctAnswer": 1
    },
    {
        "question": "Steroids consist of ____ 6-membered carbon rings and one 5-membered carbon ring.",
        "options": ["Four", "Three", "Two", "Six"],
        "correctAnswer": 1
    },
    {
        "question": "Antigen binding sites are present to:",
        "options": ["Constant region of heavy chain only", "Constant region of light chain only", "Variable region of both heavy and light chains", "Constant region of both heavy and light chains."],
        "correctAnswer": 2
    },
    {
        "question": "Pancreatic juice and bile are poured through:",
        "options": ["Two distinct ducts into esophagus", "Two distinct ducts into duodenum", "a common duct into ileum", "Two distinct ducts into ileum"],
        "correctAnswer": 1
    },
    {
        "question": "Vocal cords are stretched across:",
        "options": ["Larynx", "Pharynx", "Glottis", "Bronchi"],
        "correctAnswer": 0
    },
    {
        "question": "Vertebrae are named according to:",
        "options": ["Structure", "Functions", "Location", "Size"],
        "correctAnswer": 2
    },
    {
        "question": "Which of the following sugar is mainly present in human blood?",
        "options": ["Glucose", "Fructose", "Sucrose", "Maltose."],
        "correctAnswer": 0
    },
    {
        "question": "Immunity is generally destroyed in:",
        "options": ["All infections", "All inflammations", "All allergies", "All diseases"],
        "correctAnswer": 0
    },
    {
        "question": "Which of the following associations between the hormone and its role is FALSE?",
        "options": ["Estrogen-development of secondary sexual characteristics", "Progesterone-development and maintenance of endometrial walls", "LH-ovulation of oocyte", "FSH-formation of the ovarian follicles into the corpus luteum."],
        "correctAnswer": 3
    },
    {
        "question": "During aerobic respiration, how many molecules of NADH are produced from one molecule of glucose in total?",
        "options": ["2", "4", "8", "10"],
        "correctAnswer": 3
    },
    {
        "question": "Power house of the cell is:",
        "options": ["Ribosomes", "Endoplasmic reticulum", "Cytoplasm", "Mitochondria", "Chloroplast"],
        "correctAnswer": 3
    },
    {
        "question": "Which of the following statement about blood is not true:",
        "options": ["Nutrients like glucose are transported by blood.", "Blood helps to transport material", "Blood helps to clot", "Blood helps to maintain the internal environments"],
        "correctAnswer": 2
    },
    {
        "question": "The structural and functional unit of nervous system is termed as",
        "options": ["Dendrites", "Axon", "Stimulus", "Neuron"],
        "correctAnswer": 3
    },
    {
        "question": "Antibodies are an example of",
        "options": ["Enzyme", "Catalytic", "Protein", "Regulatory"],
        "correctAnswer": 2
    },
    {
        "question": "Evolutionary convergence is characterized by:",
        "options": ["Development of dissimilar characteristics in closely related groups.", "Development of a common set of characteristics in the groups of different ancestry", "Development of characteristics by random mating", "Replacement of common characteristics in different groups"],
        "correctAnswer": 1
    },
    {
        "question": "Maize endosperm is: (MDCAT 2006)",
        "options": ["Diploid", "Haploid", "Triploid", "None."],
        "correctAnswer": 2
    },
    {
        "question": "The constriction of circular of arteries and arterioles is under the control of",
        "options": ["Sympathetic system", "Endocrine system", "Both A and B", "None"],
        "correctAnswer": 0
    },
    {
        "question": "Every enzyme functions most effectively over a narrow range of pH known as:",
        "options": ["Reaction optima", "Optimum pH", "Minimum pH", "None"],
        "correctAnswer": 1
    },
    {
        "question": "Which of these shows the correct path of blood after it leaves the lungs?",
        "options": ["Pulmonary Vein - Left Atrium - Left Ventricle - Aorta", "Pulmonary Artery - Left Atrium - Left Ventricle - Aorta", "Pulmonary Vein - Right Atrium - Right Ventricle - Aorta", "Pulmonary Artery - Right Atrium - Right Ventricle- Aorta"],
        "correctAnswer": 0
    },
    {
        "question": "Which of the following is a true statement?",
        "options": ["Muscle cell has many muscle fibers.", "Muscle has many muscle fibers.", "Muscle fiber has many muscle cells", "Sarcomere has bundle of muscle fibers"],
        "correctAnswer": 2
    },
    {
        "question": "The three secretions entering the food in small intestine are:",
        "options": ["Gastric juice, pancreatic juice, and saliva", "Pancreatic juice, intestinal juice and gastric juice", "Pancreatic juice, intestinal juice, bile", "Bile, gastric juice and saliva."],
        "correctAnswer": 2
    },
    // Chemistry
    {
        "question": "Secondary alkyl halides give E1 reaction, and require ________ solvent.",
        "options": ["Polar", "Non polar", "Weak base", "Strong Base"],
        "correctAnswer": 0
    },
    {
        "question": "Which one has the highest melting point and boiling point:",
        "options": ["Ionic crystal", "Molecular crystal", "Covalent crystal", "Metallic crystal"],
        "correctAnswer": 3
    },
    {
        "question": "Which of the following carboxylic acid derivative is least reactive?",
        "options": ["Acid chloride", "Acid anhydride", "Amide", "Ester"],
        "correctAnswer": 2
    },
    {
        "question": "Which of the following would be the best solvent for an SN2 reaction?",
        "options": ["H2O", "CH3CH2OH", "CH3SOCH3", "CH3CH2OCH2CH2"],
        "correctAnswer": 2
    },
    {
        "question": "Alkyl halides are considered to be very reactive compounds towards nucleophiles, because",
        "options": ["They have an electrophilic carbon.", "They have an electrophilic carbon and a good leaving group", "They have an electrophilic carbon and a bad leaving group", "They have a nucleophilic carbon and a good leaving group"],
        "correctAnswer": 1
    },
    {
        "question": "During the formation of a complex compound the ligands bind with central metal atom through",
        "options": ["Covalent bonds", "Coordinate covalent bond", "Ionic bonds", "All of these"],
        "correctAnswer": 1
    },
    {
        "question": "Which of the following will not give addition reaction with NaHSO3?",
        "options": ["HCHO", "CH3CHO", "CH3-CO-CH3", "OHCH2-OH"],
        "correctAnswer": 2
    },
    {
        "question": "The increase in reaction rate as a result of increase in temperature from 10K to 100K is",
        "options": ["512", "614", "400", "312."],
        "correctAnswer": 0
    },
    {
        "question": "NaNO3 → heat → NaNO2 + O2 in this reaction",
        "options": ["Kp = Kc", "Kp > Kc", "Kp < Kc", "Kp = Kc = 1"],
        "correctAnswer": 1
    },
    {
        "question": "N2 + O2 → 2NO; heat = +ve, the yield of N2 can be increased in this reaction by",
        "options": ["Increasing the pressure", "Increasing temperature", "Decreasing the temperature", "Decreasing the pressure."],
        "correctAnswer": 1
    },
    {
        "question": "Most reactive compound among the following:",
        "options": ["Benzene", "Benzoic acid", "Phenol", "Ethyl benzene"],
        "correctAnswer": 2
    },
    {
        "question": "Which of the following statement is correct",
        "options": ["AH is positive for exothermic reaction", "AH is negative for endothermic reactions", "The heat of neutralization of strong acid with strong base is always the same", "The formation of fusion is reactive."],
        "correctAnswer": 2
    },
    {
        "question": "Based on the physico-chemical properties, proteins may be classified into",
        "options": ["Simple proteins", "Conjugated proteins", "Derived proteins", "All of the above"],
        "correctAnswer": 3
    },
    {
        "question": "Bituminous coal can produce by destructive distillation:",
        "options": ["Coke", "Coal gas", "Coal tar", "All of these"],
        "correctAnswer": 3
    },
    {
        "question": "Oxidation of a secondary alcohol gives.",
        "options": ["Propanoic acid", "Ether", "Ketone", "Formic acid", "Alkene"],
        "correctAnswer": 2
    },
    {
        "question": "Heating phenol with Zn will yield:",
        "options": ["Benzene", "Benzoic acid", "Chloro-ethane", "Cyclohexane"],
        "correctAnswer": 0
    },
    {
        "question": "The pressure 14.7 psi is equal to;",
        "options": ["1 atm", "1 pascal", "760 torr", "1Nm"],
        "correctAnswer": 0
    },
    {
        "question": "Bond energy of a molecule depends upon",
        "options": ["Bond distance and bond polarity", "Molecular shape", "Internal energy", "Kinetic energy"],
        "correctAnswer": 0
    },
    {
        "question": "Empirical formula mass and molecular mass are related as:",
        "options": ["Empirical formula mass x 2 = molecular mass", "Molecular mass = Empirical formula mass", "Molecular mass x n = Empirical formula mass", "Molecular mass / 2 = Empirical formula mass."],
        "correctAnswer": 2
    },
    {
        "question": "Which is not true about SHE",
        "options": ["Inert platinum foil is used as electrode", "Temperature is kept 25°C", "1M solution of H2SO4 is used as electrolyte", "Electrode potential of any element can be calculated by comparison to."],
        "correctAnswer": 2
    },
    {
        "question": "Viscosity of liquids depends upon:",
        "options": ["Temperature", "Size of molecule", "Shape of molecule", "All of the above"],
        "correctAnswer": 3
    },
    {
        "question": "Indicate the incorrect statement from the following",
        "options": ["A reaction is not possible if the total entropy is negative", "Actual yield is always greater than theoretical yield", "A reaction is only feasible if it's Gibbs free energy for the reaction happens", "The empirical formula and molecular formula of some of components are same"],
        "correctAnswer": 1
    },
    {
        "question": "The stronger acid among the following is",
        "options": ["CH3CH2COOH", "ClCH2COOH", "C6H5COOH", "CH3COOH"],
        "correctAnswer": 1
    },
    {
        "question": "Which one among the following is not a good leaving group?",
        "options": ["HSO4-", "Br-", "OH-", "I-"],
        "correctAnswer": 2
    },
    {
        "question": "The electronic configuration of iron is: [MDCAT 2011]",
        "options": ["[Ar] 4S², 3d⁶", "[Ar] 4S¹, 3d⁷", "[Ar] 4S², 3d⁵", "[Ar] 4S⁰, 3d⁸"],
        "correctAnswer": 0
    },
    {
        "question": "Which of the following bond is responsible for joining the amino acids in protein molecule",
        "options": ["Metallic bond", "Hydrogen bond", "Peptide bond", "Ionic bond"],
        "correctAnswer": 2
    },
    {
        "question": "The oxidation of toluene by acidified KMnO4 produces",
        "options": ["Phenol", "Benzaldehyde", "Benzyl alcohol", "Benzoic acid"],
        "correctAnswer": 3
    },
    {
        "question": "In the preparation of NaOH which of the following element is involve?",
        "options": ["Fe", "Pt", "Hg", "Se."],
        "correctAnswer": 2
    },
    {
        "question": "Order of SN1 reaction",
        "options": ["1", "2", "3", "0"],
        "correctAnswer": 0
    },
    {
        "question": "Transition temperature of sulphur is",
        "options": ["95.5°C", "128°C", "13.2°C", "32.02°C"],
        "correctAnswer": 0
    },
    {
        "question": "The alcohol more acidic in nature is",
        "options": ["Methanol", "Propanol", "Ethanol", "Butanol"],
        "correctAnswer": 0
    },
    {
        "question": "Which is incorrect about ideal gas",
        "options": ["No intermolecular forces between molecules", "No example in nature", "Low boiling point", "Obey the laws at all conditions of temperature and pressure."],
        "correctAnswer": 3
    },
    {
        "question": "The geometry of [Fe(CO)5] is",
        "options": ["Pyramidal", "Square planner", "Octahedral", "Bi pyramidal"],
        "correctAnswer": 3
    },
    {
        "question": "'In an atom no two electrons can have the same set of four quantum numbers', This statement is commonly known as:",
        "options": ["Heisenberg's principle", "Pauli's exclusion principle", "Aufbau principle", "Hund's rule", "(n+l) rule"],
        "correctAnswer": 1
    },
    {
        "question": "The concept of hybridization was given to remove which of following limitation of VBT?",
        "options": ["It does not explain paramagnetism of O2", "It could not explain the bond energies", "It could not explain tetravalency of carbon", "All of above"],
        "correctAnswer": 3
    },
    {
        "question": "Conjugation between unshared electron pair on oxygen and aromatic ring in phenol results in",
        "options": ["Shorter C - O bond distance", "High acidity", "Stronger acidic character", "All of these"],
        "correctAnswer": 3
    },
    {
        "question": "The formula of bleaching powder is:",
        "options": ["CaOCl2", "CaCO3", "CaSO4.1/2H2O", "None of these"],
        "correctAnswer": 0
    },
    {
        "question": "Buffer solution is used to",
        "options": ["Increase the acidity", "Decrease the acidity", "Maintain the pH constant", "Increase the basicity", "Add a color to the solution."],
        "correctAnswer": 2
    },
    {
        "question": "NaOH + HCl → NaCl + H2O. Enthalpy change in the above reaction is called",
        "options": ["Enthalpy of neutralization", "Combustion", "Dissociation", "Enthalpy of formation"],
        "correctAnswer": 0
    },
    {
        "question": "For aldol condensation the conditions necessary",
        "options": ["α-C", "α-H", "Basic medium", "All of these"],
        "correctAnswer": 3
    },
    {
        "question": "Propagation of free radical mechanism takes place by the",
        "options": ["Absorption of heat or light and formation", "Formation of two free radicals", "A free radical attacks the molecules of another free radical", "Reaction between two molecules"],
        "correctAnswer": 2
    },
    {
        "question": "Which transition metals serves as catalyst for oxidation of alkanes",
        "options": ["Zn", "Cu", "Hg", "He"],
        "correctAnswer": 1
    },
    {
        "question": "Cannizzaro's reaction is not given by",
        "options": ["Formaldehyde", "Acetaldehyde", "Benzaldehyde", "Trimethyl acetaldehyde"],
        "correctAnswer": 1
    },
    {
        "question": "'Catenation' is a process in which carbon shows the properties of:",
        "options": ["making single bond", "making double bond", "making long chains or rings of carbon atoms", "breaking of bonds"],
        "correctAnswer": 2
    },
    {
        "question": "What is correct order for acidity of water, phenol and ethanol.",
        "options": ["C2H5OH > H2O > C6H5OH", "H2O > C2H5OH > C6H5OH", "C6H5OH > H2O > C2H5OH", "H2O > C6H5OH > C2H5OH"],
        "correctAnswer": 2
    },
    {
        "question": "Which of the following is correct about SN1 reactions:",
        "options": ["Retention of the configuration of the alkyl halide molecule", "One step mechanism", "Reaction rate is a function of the [alkyl halide]", "All these"],
        "correctAnswer": 2
    },
    // Physics
    {
        "question": "Non-inverting amplifier circuits have",
        "options": ["A very high input resistance", "A very low input resistance", "A medium resistance", "Both A and B"],
        "correctAnswer": 0
    },
    {
        "question": "Internal friction of fluid is called",
        "options": ["Surface tension", "Viscosity", "Resistance", "Surface speed"],
        "correctAnswer": 1
    },
    {
        "question": "When a proton enters into a magnetic field perpendicularly, the proton will move in",
        "options": ["Upward direction", "A circular motion", "A straight path", "Undeflected", "None of these"],
        "correctAnswer": 1
    },
    {
        "question": "When a body is moving along a circular path it covers a certain angle in a certain time interval. This type of motion is",
        "options": ["vibratory motion", "linear motion", "rotatory motion", "angular motion."],
        "correctAnswer": 3
    },
    {
        "question": "Electric charge of 100µC is 10cm apart from another charge 19.9µC electric force between them is",
        "options": ["9x10⁶ N", "1.8x10¹³ N", "900N", "9x10⁸N"],
        "correctAnswer": 1
    },
    {
        "question": "The frequency of the fundamental mode of vibration of an open organ pipe is 400 Hz. If one end of the pipe is closed, the fundamental frequency will be",
        "options": ["200 Hz", "100 Hz", "400 Hz", "800 Hz"],
        "correctAnswer": 0
    },
    {
        "question": "The half life (T1/2) and the disintegration constant (λ) of a radioactive substance are related as",
        "options": ["λT = 1", "λT = 0.693", "λ/T = 0.693", "All of these"],
        "correctAnswer": 1
    },
    {
        "question": "The range of the projectile at 30° and 60° are",
        "options": ["Greater", "equal to 90°", "Equal to each other", "none of the above"],
        "correctAnswer": 2
    },
    {
        "question": "Internal energy of a perfect gas depends upon",
        "options": ["Temperature only", "Temperature and pressure", "Temperature, pressure and specific heats", "None of the above"],
        "correctAnswer": 0
    },
    {
        "question": "The S.I. units of magnetic field is",
        "options": ["Tesla", "Wb m⁻²", "N A⁻¹m⁻¹", "All of these"],
        "correctAnswer": 3
    },
    {
        "question": "The process of combining two or more lighter nuclei to form a heavier nucleus with the release of energy is called",
        "options": ["Fission", "Chain reaction", "Reaction", "Fusion reaction."],
        "correctAnswer": 3
    },
    {
        "question": "A body of 2 kg is suspended from the ceiling of an elevator moving up with an acceleration g. Its apparent weight in the elevator will be.",
        "options": ["zero", "19.6 N", "39.2 N", "19.2 N"],
        "correctAnswer": 2
    },
    {
        "question": "The distance covered by a body in one complete vibration is 20cm. What is the amplitude of body?",
        "options": ["10 cm", "5 cm", "15 cm", "20 cm."],
        "correctAnswer": 1
    },
    {
        "question": "When 'n' resistances are connected in parallel, the effective resistance will be:",
        "options": ["Product of the reciprocals of the individual resistances", "Product of the individual resistances", "Sum of the reciprocals of the individual resistances", "Sum of the individual resistances."],
        "correctAnswer": 2
    },
    {
        "question": "When the velocity of a liquid flowing steadily in a tube increases, its pressure?",
        "options": ["Decreases", "Increases", "Remain same", "Zero"],
        "correctAnswer": 0
    },
    {
        "question": "The direction of linear velocity of body moving in a circle is",
        "options": ["along the axis of rotation", "along the tangent", "directed towards the center", "directed away from the center"],
        "correctAnswer": 1
    },
    {
        "question": "The 'Drag force increases as the speed of the object",
        "options": ["Decreases", "Increases", "Increases rapidly", "None of these."],
        "correctAnswer": 1
    },
    {
        "question": "If a body of mass 2 kg is raised vertically through 2m, then the work done will be:",
        "options": ["38.2 J", "392.1 J", "39.2 J", "3.82 J"],
        "correctAnswer": 2
    },
    {
        "question": "Which one is not a type of dynamic equilibrium?",
        "options": ["rotational equilibrium", "translational equilibrium", "static equilibrium", "a, b, c are all correct answer."],
        "correctAnswer": 2
    },
    {
        "question": "In case of a vibrating Pendulum, if the mass of the pendulum is doubled its time period will",
        "options": ["Becomes one half", "Becomes double", "Remain same", "Becomes one fourth"],
        "correctAnswer": 2
    },
    {
        "question": "A 20Ω and a 60Ω are connected in series to a DC generator. The I = 4.0A. What will be the voltage across R2(60Ω)?(MDCAT-2009)",
        "options": ["10V", "80V", "240V", "4V"],
        "correctAnswer": 2
    },
    {
        "question": "Oscillatory motion is a type of motion which is",
        "options": ["To and fro", "Vibratory motion", "Back and forth", "All of these."],
        "correctAnswer": 3
    },
    {
        "question": "If the slope of the velocity-time graph increases a constant rate, with time then the body is said to have",
        "options": ["Uniform velocity,", "Uniform negative acceleration,", "Uniform retardation", "Uniform positive acceleration"],
        "correctAnswer": 3
    },
    {
        "question": "Radius of first orbit of Hydrogen atom is equal to",
        "options": ["5.3 A°", "0.53 A°", "0.053 A°", "53 A°"],
        "correctAnswer": 1
    },
    {
        "question": "Stationary waves' are so called because in them",
        "options": ["The particles of the medium are always at rest", "The particles of the medium do not execute SHM", "There is no net flow of energy along the string", "The interference effects can't be observed."],
        "correctAnswer": 2
    },
    {
        "question": "Velocity of sound in vacuum is",
        "options": ["332 ms⁻¹", "320 ms⁻¹", "Zero", "228 ms⁻¹"],
        "correctAnswer": 2
    },
    {
        "question": "An axis which is at right angle to both X and Y axes and points in space is called",
        "options": ["Unit vector axis", "Zero vector axis", "Z-axis", "none of these"],
        "correctAnswer": 2
    },
    {
        "question": "Sound waves do not travel in vacuum because",
        "options": ["they are transverse waves", "they are longitudinal waves", "they require material medium for propagation", "they do not have enough energy"],
        "correctAnswer": 2
    },
    {
        "question": "According to Bohr electron in an allowed orbit:",
        "options": ["Obeys laws of classical physics", "Does not obey classical Physics", "Does not radiate", "Radiates energy"],
        "correctAnswer": 2
    },
    {
        "question": "The average value of a 12 V peak time wave over one complete cycle is",
        "options": ["0 V", "12 V", "6.37 V", "7.64 V"],
        "correctAnswer": 0
    },
    {
        "question": "Doppler shift in frequency does not depend upon",
        "options": ["The frequency of the wave produced", "The distance of the source from the listener", "The velocity of the source", "The velocity of the observer."],
        "correctAnswer": 1
    },
    {
        "question": "Lenz' law states that the direction of the induced emf and hence current",
        "options": ["is determined by the rate of current flux", "is found by the right-hand rule", "is found by the left-hand rule", "Always opposes the cause producing it"],
        "correctAnswer": 3
    },
    {
        "question": "Coulomb's law for the force between electric charges most closely resembles with",
        "options": ["Law of conservation of mass,", "Law of conservation of energy,", "Gauss's theorem,", "Newton's law of gravitation."],
        "correctAnswer": 3
    },
    {
        "question": "Specific heat is the amount of heat required to raise the temperature",
        "options": ["By unit degree of a substance", "By unit degree of a unit mass", "Of a body by 10° C", "None of the above."],
        "correctAnswer": 1
    },
    {
        "question": "When a force is parallel to the direction of motion of the body, then work done on the body is",
        "options": ["Zero", "minimum", "Infinity", "maximum"],
        "correctAnswer": 3
    },
    // English
    {
        "question": "Antonym for Construct.",
        "options": ["Explode", "Destroy", "Dilate", "Accelerate"],
        "correctAnswer": 1
    },
    {
        "question": "Choose the sentence with the correct use of comparative degree of adjective:",
        "options": ["My bed is more big than my desk", "My bed is bigger than my desk", "My bed is biger than my desk", "My bed is more bigger than my desk"],
        "correctAnswer": 1
    },
    {
        "question": "Choose the word most similar in meaning to the capitalized one: MEDITATIVE",
        "options": ["selfish", "thoughtful", "heedless", "pious", "ordinary"],
        "correctAnswer": 1
    },
    {
        "question": "Sentence correction. This is my final idea that solution to the problem lays right before our eyes.",
        "options": ["lay", "to", "lies", "before"],
        "correctAnswer": 2
    },
    {
        "question": "Mr. Ahmed is to old to work now; he depends upon his son. Find the error.",
        "options": ["Mr", "to", "work now", "depend", "no error."],
        "correctAnswer": 1
    },
    {
        "question": "YASIR ABBAS got an opportunity to have fellowship at ____ School of Medicine in Lahore.",
        "options": ["an", "a", "the", "On"],
        "correctAnswer": 2
    },
    {
        "question": "Synonym for Equity",
        "options": ["biasness", "average", "fairness", "Divulge"],
        "correctAnswer": 2
    },
    {
        "question": "According to Dr. Daniel, when the companions of the king; saw the king after he had risen from the ground, they said, '____ and we'll fight again.",
        "options": ["It's him", "It is he", "It is I", "It is himself"],
        "correctAnswer": 1
    },
    {
        "question": "Spot the correct spelling.",
        "options": ["comittee", "commitee", "committee", "committie", "comittee"],
        "correctAnswer": 2
    },
    // Logical Reasoning
    {
        "question": "AK, EO, IS, ____, QA, UE",
        "options": ["LV", "MW", "NX", "MV"],
        "correctAnswer": 1
    },
    {
        "question": "All apples in the basket are green. Some fruits in the basket are apples. Therefore, some fruits in the basket are green. If the first two statements are true, the third statement is;",
        "options": ["None of these", "True", "False", "Uncertain"],
        "correctAnswer": 1
    },
    {
        "question": "If two trains are moving in opposite directions at the same speed on parallel tracks, what can be concluded about their speeds relative to each other?",
        "options": ["They are the same.", "They are moving at the same speed.", "They are double.", "They cannot be compared."],
        "correctAnswer": 2
    },
    {
        "question": "All students in the class passed the math exam. Some students in the class failed the science exam. Therefore, some students in the class failed at least one exam. If the first two statements are true, the third statement is;",
        "options": ["True", "None of these", "Uncertain", "False"],
        "correctAnswer": 0
    },
    {
        "question": "If all roses are flowers and some flowers fade quickly, what can be inferred about roses?",
        "options": ["All roses fade quickly.", "Some roses fade quickly.", "No roses fade quickly.", "Roses do not fade quickly."],
        "correctAnswer": 1
    },
    {
        "question": "CMM, EOO, GQQ, ____, KUU",
        "options": ["CSS", "ISS", "GRR", "GSS"],
        "correctAnswer": 1
    },
    {
        "question": "Statements: 1. Every minister is a student. 2. Every student is inexperienced. Conclusions: I. Every minister is inexperienced. II. Some inexperienced are students.",
        "options": ["Only conclusion I follows", "Neither I nor II follows", "Either I or II follows", "Both I and II follow"],
        "correctAnswer": 0
    },
    {
        "question": "John is taller than Alice. Alice is taller than Bob. Therefore, John is taller than Bob. If the first two statements are true, the third statement is;",
        "options": ["None of these", "Uncertain", "True", "False"],
        "correctAnswer": 2
    },
    {
        "question": "Statements: 1. All poets are posties. 2. No postie is a magazine. Conclusions: I. Some magazines are posties. II. No poets are posties.",
        "options": ["Both I and II follow", "Either I or II follows", "Neither I nor II follows", "Only conclusion II follows."],
        "correctAnswer": 3
    }
];


    // This assumes all your questions have 4 options and one correct answer.
    // Ensure this data structure is consistent.

    // Initialize user answers array
    for (let i = 0; i < originalQuestions.length; i++) {
        userAnswers.push(null); // null indicates not attempted
    }

    // --- Utility Functions ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function formatTime(seconds) {
        const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
        const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
        const s = String(seconds % 60).padStart(2, '0');
        return `${h}:${m}:${s}`;
    }

    function showSection(sectionId) {
        passwordSection.classList.add('hidden');
        quizSection.classList.add('hidden');
        resultSection.classList.add('hidden');
        reviewSection.classList.add('hidden');
        document.getElementById(sectionId).classList.remove('hidden');
    }

    function calculateAggregate(mdcatScore) {
        // SSC marks contribute 10%, FSc marks 40%, MDCAT 50%
        // Assuming marks are out of 1100 for SSC and 1100 for FSc
        const sscWeight = 0.10;
        const fscWeight = 0.40;
        const mdcatWeight = 0.50;

        const sscPercentage = (sscObtainedMarks / sscTotalMarks) * 100;
        const fscPercentage = (fscObtainedMarks / fscTotalMarks) * 100;

        const aggregate = (sscPercentage * sscWeight) + (fscPercentage * fscWeight) + (mdcatScore * mdcatWeight);
        return aggregate.toFixed(2);
    }

    function showToast(type, title, message) {
        const toast = document.createElement('div');
        toast.classList.add('toast', type, 'fixed', 'top-4', 'right-4', 'z-[1000]', 'flex', 'items-center', 'gap-3', 'p-4', 'rounded-lg', 'shadow-lg', 'transition-all', 'duration-300', 'ease-out');
        
        // Tailwind classes for toast types
        let bgColor, textColor, borderColor, iconClass;
        if (type === 'success') {
            bgColor = 'bg-green-100 dark:bg-green-900/50';
            textColor = 'text-green-800 dark:text-green-300';
            borderColor = 'border-green-500 dark:border-green-700';
            iconClass = 'fa-circle-check text-green-500 dark:text-green-400';
        } else if (type === 'error') {
            bgColor = 'bg-red-100 dark:bg-red-900/50';
            textColor = 'text-red-800 dark:text-red-300';
            borderColor = 'border-red-500 dark:border-red-700';
            iconClass = 'fa-circle-xmark text-red-500 dark:text-red-400';
        } else if (type === 'info') {
            bgColor = 'bg-blue-100 dark:bg-blue-900/50';
            textColor = 'text-blue-800 dark:text-blue-300';
            borderColor = 'border-blue-500 dark:border-blue-700';
            iconClass = 'fa-circle-info text-blue-500 dark:text-blue-400';
        }

        // Correctly add classes by splitting them if they contain spaces
        toast.classList.add(...bgColor.split(' '));
        toast.classList.add(...textColor.split(' '));
        toast.classList.add('border-l-4'); // This is a single class
        toast.classList.add(...borderColor.split(' '));

        toast.innerHTML = `
            <i class="fa-solid ${iconClass} text-xl"></i>
            <div>
                <p class="font-semibold">${title}</p>
                <p class="text-sm">${message}</p>
            </div>
        `;
        toastContainer.appendChild(toast);

        // Animate in
        setTimeout(() => {
            toast.classList.remove('opacity-0', 'translate-x-full');
            toast.classList.add('opacity-100', 'translate-x-0');
        }, 10); // Small delay to ensure transition applies

        // Animate out and remove after 3 seconds
        setTimeout(() => {
            toast.classList.remove('opacity-100', 'translate-x-0');
            toast.classList.add('opacity-0', 'translate-x-full');
            toast.addEventListener('transitionend', () => toast.remove(), { once: true });
        }, 3000);
    }


    // --- Theme Toggle ---
    function toggleTheme() {
        document.documentElement.classList.toggle('dark'); // Toggle dark class on html element
        if (document.documentElement.classList.contains('dark')) {
            localStorage.setItem('theme', 'dark');
        } else {
            localStorage.setItem('theme', 'light');
        }
        updateThemeIcon();
    }

    function updateThemeIcon() {
        const themeToggleIcon = themeToggleBtn.querySelector('i');
        if (document.documentElement.classList.contains('dark')) {
            themeToggleIcon.classList.remove('fa-moon');
            themeToggleIcon.classList.add('fa-sun');
        } else {
            themeToggleIcon.classList.remove('fa-sun');
            themeToggleIcon.classList.add('fa-moon');
        }
    }

   function checkTheme() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark');
    } else if (savedTheme === 'light') {
        document.documentElement.classList.remove('dark');
    } else {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    }
    updateThemeIcon();
}


    // --- Fullscreen Toggle ---
    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().then(updateFullscreenIcon);
        } else {
            document.exitFullscreen().then(updateFullscreenIcon);
        }
    }

    function updateFullscreenIcon() {
        if (document.fullscreenElement) {
            fullscreenIcon.classList.remove('fa-expand');
            fullscreenIcon.classList.add('fa-compress');
            fullscreenToggleBtn.title = "Exit Fullscreen";
        } else {
            fullscreenIcon.classList.remove('fa-compress');
            fullscreenIcon.classList.add('fa-expand');
            fullscreenToggleBtn.title = "Toggle Fullscreen";
        }
    }

    // --- Quiz Functions ---
    function startTimer() {
        testStartTime = Date.now();
        timerInterval = setInterval(() => {
            timeRemaining--;
            if (timeRemaining < 0) {
                timeRemaining = 0;
                clearInterval(timerInterval);
                submitTest();
                showToast('info', 'Time Up!', 'Your test has been automatically submitted.');
            }
            timerDisplay.textContent = formatTime(timeRemaining);
        }, 1000);
    }

    function displayQuestion() {
        const question = shuffledQuestions[currentQuestionIndex];
        questionCounter.textContent = `Question ${currentQuestionIndex + 1}/${shuffledQuestions.length}`;
        questionText.innerHTML = `${currentQuestionIndex + 1}. ${question.question}`;
        optionsContainer.innerHTML = ''; // Clear previous options

        // Get shuffled options for the current question
        const shuffledOptions = shuffledOptionsMap.get(currentQuestionIndex);

        shuffledOptions.forEach((option, originalIndex) => {
            const optionDiv = document.createElement('div');
            optionDiv.classList.add('flex', 'items-center', 'gap-3', 'bg-slate-100', 'dark:bg-slate-700', 'p-4', 'rounded-lg', 'cursor-pointer', 'transition-all', 'duration-150', 'ease-in-out', 'hover:bg-slate-200', 'dark:hover:bg-slate-600');
            optionDiv.dataset.originalIndex = originalIndex; // Store original index to map back to correctAnswer

            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'questionOptions';
            radio.id = `option${originalIndex}`; // Use originalIndex for unique ID
            radio.value = originalIndex; // Store original index as value
            radio.classList.add('appearance-none', 'w-4', 'h-4', 'border-2', 'border-slate-400', 'dark:border-slate-500', 'rounded-full', 'checked:bg-indigo-500', 'checked:border-indigo-500', 'dark:checked:bg-blue-400', 'dark:checked:border-blue-400', 'relative', 'flex-shrink-0', 'cursor-pointer');
            radio.style.setProperty('--tw-ring-color', 'rgba(99, 102, 241, 0.5)'); // Custom property for ring color
            radio.style.setProperty('--tw-ring-offset-color', 'var(--bg-slate-100)'); // Custom property for ring offset color

            // Custom checked state indicator
            const checkedIndicator = document.createElement('div');
            checkedIndicator.classList.add('absolute', 'top-1/2', 'left-1/2', '-translate-x-1/2', '-translate-y-1/2', 'w-2', 'h-2', 'bg-white', 'rounded-full', 'pointer-events-none', 'opacity-0', 'transition-opacity', 'duration-150');
            radio.addEventListener('change', () => {
                if (radio.checked) {
                    checkedIndicator.classList.remove('opacity-0');
                } else {
                    checkedIndicator.classList.add('opacity-0');
                }
            });

            const label = document.createElement('label');
            label.htmlFor = `option${originalIndex}`;
            label.classList.add('text-lg', 'font-medium', 'text-slate-800', 'dark:text-slate-200', 'cursor-pointer', 'flex-1');
            label.textContent = option;

            optionDiv.appendChild(radio);
            radio.appendChild(checkedIndicator); // Append indicator inside radio for positioning
            optionDiv.appendChild(label);
            optionsContainer.appendChild(optionDiv);

            optionDiv.addEventListener('click', () => {
                radio.checked = true;
                userAnswers[currentQuestionIndex] = parseInt(optionDiv.dataset.originalIndex); // Store original index of selected option
                updatePaletteButton(currentQuestionIndex, 'attempted');
                highlightSelectedOption(optionDiv);
            });

            // Check if this option was previously selected by the user
            if (userAnswers[currentQuestionIndex] === originalIndex) {
                radio.checked = true;
                highlightSelectedOption(optionDiv);
                checkedIndicator.classList.remove('opacity-0');
            }
        });

        // Update navigation buttons
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.textContent = currentQuestionIndex === shuffledQuestions.length - 1 ? 'Submit Test' : 'Next';
        nextBtn.classList.toggle('bg-indigo-500', currentQuestionIndex < shuffledQuestions.length - 1);
        nextBtn.classList.toggle('hover:bg-indigo-600', currentQuestionIndex < shuffledQuestions.length - 1);
        nextBtn.classList.toggle('bg-green-600', currentQuestionIndex === shuffledQuestions.length - 1);
        nextBtn.classList.toggle('hover:bg-green-700', currentQuestionIndex === shuffledQuestions.length - 1);
    }

    function highlightSelectedOption(selectedDiv) {
        document.querySelectorAll('.option-item').forEach(div => {
            div.classList.remove('border-2', 'border-indigo-500', 'dark:border-blue-400', 'bg-indigo-50', 'dark:bg-slate-700');
            div.classList.add('border', 'border-slate-200', 'dark:border-slate-700', 'bg-slate-100', 'dark:bg-slate-800/50');
        });
        selectedDiv.classList.add('border-2', 'border-indigo-500', 'dark:border-blue-400', 'bg-indigo-50', 'dark:bg-slate-700');
        selectedDiv.classList.remove('border-slate-200', 'dark:border-700', 'bg-slate-100', 'dark:bg-slate-800/50');
    }


    function populateQuestionPalette() {
        questionPalette.innerHTML = '';
        shuffledQuestions.forEach((_, index) => {
            const button = document.createElement('button');
            button.classList.add('w-10', 'h-10', 'rounded-full', 'flex', 'items-center', 'justify-center', 'font-semibold', 'text-sm', 'flex-shrink-0', 'transition-all', 'duration-150', 'ease-in-out');
            button.textContent = index + 1;
            button.dataset.index = index;

            // Initial state: unanswered
            button.classList.add('bg-slate-300', 'text-slate-800', 'dark:bg-slate-700', 'dark:text-slate-200');

            if (index === currentQuestionIndex) {
                button.classList.remove('bg-slate-300', 'dark:bg-slate-700');
                button.classList.add('bg-indigo-500', 'text-white', 'dark:bg-blue-500', 'transform', 'scale-110');
            }

            button.addEventListener('click', () => {
                currentQuestionIndex = index;
                displayQuestion();
                updatePaletteSelection();
            });
            questionPalette.appendChild(button);
        });
    }

    function updatePaletteButton(index, status) {
        const button = questionPalette.querySelector(`button[data-index="${index}"]`);
        if (button) {
            button.classList.remove('bg-slate-300', 'text-slate-800', 'dark:bg-slate-700', 'dark:text-slate-200', 'bg-green-500', 'text-white', 'bg-indigo-500', 'dark:bg-blue-500', 'transform', 'scale-110');
            
            if (status === 'attempted') {
                button.classList.add('bg-green-500', 'text-white', 'dark:bg-green-600');
            } else if (status === 'unattempted') {
                 button.classList.add('bg-slate-300', 'text-slate-800', 'dark:bg-slate-700', 'dark:text-slate-200');
            }
            // Ensure current question is always highlighted
            if (index === currentQuestionIndex) {
                button.classList.remove('bg-slate-300', 'dark:bg-slate-700', 'bg-green-500', 'dark:bg-green-600');
                button.classList.add('bg-indigo-500', 'text-white', 'dark:bg-blue-500', 'transform', 'scale-110');
            } else {
                button.classList.remove('transform', 'scale-110');
            }
        }
    }

    function updatePaletteSelection() {
        questionPalette.querySelectorAll('button').forEach(btn => {
            btn.classList.remove('bg-indigo-500', 'text-white', 'dark:bg-blue-500', 'transform', 'scale-110');
            
            if (userAnswers[parseInt(btn.dataset.index)] === null) {
                btn.classList.add('bg-slate-300', 'text-slate-800', 'dark:bg-slate-700', 'dark:text-slate-200');
                btn.classList.remove('bg-green-500', 'dark:bg-green-600');
            } else {
                 btn.classList.add('bg-green-500', 'text-white', 'dark:bg-green-600');
                 btn.classList.remove('bg-slate-300', 'dark:bg-slate-700');
            }
        });
        const currentButton = questionPalette.querySelector(`button[data-index="${currentQuestionIndex}"]`);
        if (currentButton) {
            currentButton.classList.remove('bg-slate-300', 'dark:bg-slate-700', 'bg-green-500', 'dark:bg-green-600');
            currentButton.classList.add('bg-indigo-500', 'text-white', 'dark:bg-blue-500', 'transform', 'scale-110');
        }
    }

    // Function to update circular progress bars
    function setCircleProgress(circleElement, textElement, percentage) {
        const radius = 15.9155; // This value is derived from the 'd' attribute in your SVG paths
        const circumference = 2 * Math.PI * radius;
        const offset = circumference - (percentage / 100) * circumference;

        circleElement.style.strokeDasharray = `${circumference} ${circumference}`;
        circleElement.style.strokeDashoffset = offset;
        textElement.textContent = `${percentage.toFixed(1)}%`;
    }

    function submitTest() {
        clearInterval(timerInterval);
        showSection('resultSection');
        calculateResults();
    }

    function calculateResults() {
        let correctCount = 0;
        let incorrectCount = 0;
        let attemptedCount = 0;

        shuffledQuestions.forEach((shuffledQuestion, index) => {
            const userAnswer = userAnswers[index];
            if (userAnswer !== null) {
                attemptedCount++;
                // Get the original correct answer index for the current shuffled question
                const originalCorrectAnswerIndex = shuffledQuestion.correctAnswer;
                if (userAnswer === originalCorrectAnswerIndex) {
                    correctCount++;
                } else {
                    incorrectCount++;
                }
            }
        });

        const unattemptedCount = shuffledQuestions.length - attemptedCount;
        const mdcatRawScore = (correctCount * 5) - (incorrectCount * 0); // Assuming 5 marks for correct, 0 for incorrect

        // MDCAT score percentage calculation
        const maxMdcatScore = shuffledQuestions.length * 5;
        const mdcatPercentage = (mdcatRawScore / maxMdcatScore) * 100;

        // Calculate Academic Percentages
        const sscPercentage = (sscObtainedMarks / sscTotalMarks) * 100;
        const fscPercentage = (fscObtainedMarks / fscTotalMarks) * 100;

        // Calculate Aggregate Percentage (MDCAT 70%, F.Sc. 20%, SSC 10%)
        const aggregatePercentage =
            (mdcatPercentage * 0.70) +
            (fscPercentage * 0.20) +
            (sscPercentage * 0.10);

        totalQuestionsResult.textContent = shuffledQuestions.length;
        attemptedQuestionsResult.textContent = attemptedCount;
        correctAnswersResult.textContent = correctCount;
        incorrectAnswersResult.textContent = incorrectCount;
        unattemptedQuestionsResult.textContent = unattemptedCount;
        timeTakenResult.textContent = formatTime(totalTestDuration - timeRemaining);
        
        setCircleProgress(mdcatScoreCircle, mdcatScoreCircleText, mdcatPercentage);
        setCircleProgress(aggregateScoreCircle, aggregateScoreCircleText, aggregatePercentage);

        // Display status messages
        statusContainer.innerHTML = '';
        const statusMessages = getStatusMessages(mdcatPercentage, aggregatePercentage);
        statusMessages.forEach(msg => {
            const statusPill = document.createElement('div');
            statusPill.classList.add('flex', 'items-center', 'gap-2', 'bg-slate-100', 'dark:bg-slate-700', 'p-3', 'rounded-lg');
            statusPill.innerHTML = `<p class="font-medium text-slate-800 dark:text-slate-200 flex items-center gap-2"><i class="fa-solid ${msg.icon} text-${msg.color}-500 dark:text-${msg.color}-400"></i> <strong>${msg.title}:</strong> <span class="flex-1">${msg.message}</span></p>`;
            statusContainer.appendChild(statusPill);
        });
    }

    function getStatusMessages(mdcatScorePercentage, aggregatePercentage) {
        const messages = [];

        // MDCAT Status
        if (mdcatScorePercentage >= 60) {
            messages.push({ title: "MDCAT Status", message: "PASSED", icon: "fa-circle-check", color: "green" });
        } else {
            messages.push({ title: "MDCAT Status", message: "FAILED", icon: "fa-circle-xmark", color: "red" });
        }

        // F.Sc. Status (assuming 50% passing for F.Sc. contribution)
        const fscPercentage = (fscObtainedMarks / fscTotalMarks) * 100;
        if (fscPercentage >= 50) {
            messages.push({ title: "F.Sc. Status", message: "PASSED", icon: "fa-circle-check", color: "green" });
        } else {
            messages.push({ title: "F.Sc. Status", message: "FAILED", icon: "fa-circle-xmark", color: "red" });
        }

        // Overall Admission Status (e.g., Aggregate >= 75%)
        if (aggregatePercentage >= 75) {
            messages.push({ title: "Overall Admission", message: "QUALIFIED", icon: "fa-award", color: "blue" });
        } else {
            messages.push({ title: "Overall Admission", message: "NOT QUALIFIED", icon: "fa-times-circle", color: "red" });
        }

        // General Feedback
        if (aggregatePercentage >= 85) {
            messages.push({ title: "Feedback", message: "Excellent performance! You are well on your way to success.", icon: "fa-star", color: "yellow" });
        } else if (aggregatePercentage >= 70) {
            messages.push({ title: "Feedback", message: "Great job! Keep practicing to achieve even higher scores.", icon: "fa-lightbulb", color: "indigo" });
        } else if (aggregatePercentage >= 50) {
            messages.push({ title: "Feedback", message: "Good effort, but there's room for improvement. Focus on your weaker areas.", icon: "fa-chart-line", color: "orange" });
        } else {
            messages.push({ title: "Feedback", message: "Don't give up! Consistent practice and reviewing concepts will help you improve.", icon: "fa-redo-alt", color: "red" });
        }
        return messages;
    }

    // --- Review Section Functions ---
    function displayReviewQuestion() {
        // Add robust checks for data existence
        if (!shuffledQuestions || shuffledQuestions.length === 0) {
            console.error("No questions available for review.");
            reviewQuestionDisplay.innerHTML = '<p class="text-red-500 dark:text-red-400">No questions to review. Please start and complete a test first.</p>';
            reviewPrevBtn.disabled = true;
            reviewNextBtn.disabled = true;
            return;
        }

        // Ensure currentReviewQuestionIndex is within valid bounds
        if (currentReviewQuestionIndex < 0) {
            currentReviewQuestionIndex = 0;
        } else if (currentReviewQuestionIndex >= shuffledQuestions.length) {
            currentReviewQuestionIndex = shuffledQuestions.length - 1;
        }

        const question = shuffledQuestions[currentReviewQuestionIndex];
        if (!question) {
            console.error("Question at currentReviewQuestionIndex is undefined:", currentReviewQuestionIndex);
            reviewQuestionDisplay.innerHTML = '<p class="text-red-500 dark:text-red-400">Error loading question. Please restart the test.</p>';
            reviewPrevBtn.disabled = true;
            reviewNextBtn.disabled = true;
            return;
        }

        const userAnswerOriginalIndex = userAnswers[currentReviewQuestionIndex]; // This is the original index of the user's selected option
        const correctAnswerOriginalIndex = question.correctAnswer; // This is the original index of the correct answer

        // Get the shuffled options for the current review question
        const shuffledOptionsForReview = shuffledOptionsMap.get(currentReviewQuestionIndex);
        if (!shuffledOptionsForReview || !Array.isArray(shuffledOptionsForReview)) {
            console.error("Shuffled options for review are invalid or missing for index:", currentReviewQuestionIndex);
            reviewQuestionDisplay.innerHTML = '<p class="text-red-500 dark:text-red-400">Error loading options for review. Please restart the test.</p>';
            reviewPrevBtn.disabled = true;
            reviewNextBtn.disabled = true;
            return;
        }

        let optionsHtml = shuffledOptionsForReview.map((optionText) => {
            // Find the original index of this option text in the original question's options array
            const originalQuestionData = originalQuestions[question.originalIndex];
            if (!originalQuestionData || !Array.isArray(originalQuestionData.options)) {
                console.error("Original question data or options are invalid for originalIndex:", question.originalIndex);
                return `<div class="text-red-500">Error loading option.</div>`; // Fallback for option rendering
            }
            const originalIndexForThisOption = originalQuestionData.options.indexOf(optionText);

            let iconClass = 'fa-circle text-slate-400 dark:text-slate-500'; // Default icon
            let optionClasses = 'bg-slate-100 dark:bg-slate-700'; // Default background

            if (originalIndexForThisOption === correctAnswerOriginalIndex) {
                iconClass = 'fa-check-circle text-green-500 dark:text-green-400';
                optionClasses = 'bg-green-100 dark:bg-green-900/50 border border-green-200 dark:border-green-700';
            }

            if (userAnswerOriginalIndex !== null && originalIndexForThisOption === userAnswerOriginalIndex) {
                if (originalIndexForThisOption === correctAnswerOriginalIndex) {
                    // User selected correctly - already handled by correct class
                } else {
                    iconClass = 'fa-times-circle text-red-500 dark:text-red-400';
                    optionClasses = 'bg-red-100 dark:bg-red-900/50 border border-red-200 dark:border-red-700';
                }
            }

            return `
                <div class="flex items-center gap-3 p-3 rounded-lg ${optionClasses}">
                    <i class="fa-solid ${iconClass} text-lg flex-shrink-0"></i>
                    <p class="flex-1 text-slate-800 dark:text-slate-200 ${originalIndexForThisOption === correctAnswerOriginalIndex ? 'font-semibold' : ''}">${optionText}</p>
                </div>
            `;
        }).join('');

        let statusMessageHtml = '';
        if (userAnswerOriginalIndex === null) {
            statusMessageHtml = `<p class="mt-4 font-semibold text-yellow-600 dark:text-yellow-400 flex items-center gap-2"><i class="fa-solid fa-triangle-exclamation"></i> Not Attempted</p>`;
        } else if (userAnswerOriginalIndex !== correctAnswerOriginalIndex) {
            statusMessageHtml = `
                <p class="mt-4 font-semibold text-red-600 dark:text-red-400 flex items-center gap-2"><i class="fa-solid fa-circle-xmark"></i> Your Answer: <span class="font-normal">${originalQuestions[shuffledQuestions[currentReviewQuestionIndex].originalIndex].options[userAnswerOriginalIndex]}</span></p>
                <p class="mt-2 font-semibold text-green-600 dark:text-green-400 flex items-center gap-2"><i class="fa-solid fa-circle-check"></i> Correct Answer: <span class="font-normal">${originalQuestions[shuffledQuestions[currentReviewQuestionIndex].originalIndex].options[correctAnswerOriginalIndex]}</span></p>
            `;
        } else {
            statusMessageHtml = `<p class="mt-4 font-semibold text-green-600 dark:text-green-400 flex items-center gap-2"><i class="fa-solid fa-circle-check"></i> Your Answer is Correct!</p>`;
        }


        reviewQuestionDisplay.innerHTML = `
            <div class="bg-slate-50 dark:bg-slate-700 p-6 rounded-lg border border-slate-200 dark:border-slate-600">
                <p class="text-xl font-semibold text-slate-900 dark:text-slate-50 mb-4">${currentReviewQuestionIndex + 1}. ${question.question}</p>
                <div class="flex flex-col gap-3">
                    ${optionsHtml}
                </div>
                ${statusMessageHtml}
            </div>
        `;

        // More robust disabling conditions
        reviewPrevBtn.disabled = currentReviewQuestionIndex <= 0;
        reviewNextBtn.disabled = currentReviewQuestionIndex >= shuffledQuestions.length - 1;
    }

    // --- Modal Functions ---
    function showConfirmationModal() {
        confirmationModal.classList.add('show');
    }

    function hideConfirmationModal() {
        confirmationModal.classList.remove('show');
    }


    // --- Event Listeners ---
    startTestBtn.addEventListener('click', () => {
        const password = testPasswordInput.value;
        const sscObtained = parseInt(sscObtainedInput.value);
        const sscTotal = parseInt(sscTotalInput.value);
        const fscObtained = parseInt(fscObtainedInput.value);
        const fscTotal = parseInt(fscTotalInput.value);

        let isValid = true;

        // Reset error messages
        passwordError.classList.add('hidden');
        sscError.classList.add('hidden');
        fscError.classList.add('hidden');

        if (password !== quizPassword) {
            passwordError.classList.remove('hidden');
            isValid = false;
        }

        if (isNaN(sscObtained) || isNaN(sscTotal) || sscObtained < 0 || sscTotal <= 0 || sscObtained > sscTotal) {
            sscError.classList.remove('hidden');
            isValid = false;
        }

        if (isNaN(fscObtained) || isNaN(fscTotal) || fscObtained < 0 || fscTotal <= 0 || fscObtained > fscTotal) {
            fscError.classList.remove('hidden');
            isValid = false;
        }

        if (isValid) {
            sscObtainedMarks = sscObtained;
            sscTotalMarks = sscTotal;
            fscObtainedMarks = fscObtained;
            fscTotalMarks = fscTotal;
            
            // Shuffle questions and options when test starts
            // Ensure originalQuestions is correctly truncated to 200 questions here
            const biologyQuestions = originalQuestions.slice(0, 90);
            const chemistryQuestions = originalQuestions.slice(90, 90 + 50);
            const physicsQuestions = originalQuestions.slice(140, 140 + 40);
            const englishQuestions = originalQuestions.slice(180, 180 + 10);
            const logicalReasoningQuestions = originalQuestions.slice(190, 190 + 10);

            const all200Questions = [
                ...biologyQuestions,
                ...chemistryQuestions,
                ...physicsQuestions,
                ...englishQuestions,
                ...logicalReasoningQuestions
            ];

            shuffledQuestions = shuffleArray([...all200Questions].map((q,idx) => ({...q, originalIndex: originalQuestions.indexOf(q)}))); // Keep original index for reference
            shuffledOptionsMap.clear(); // Clear previous shuffled options
            shuffledQuestions.forEach((q, qIndex) => {
                const shuffledOpts = shuffleArray([...q.options]);
                shuffledOptionsMap.set(qIndex, shuffledOpts);
            });

            userAnswers = Array(shuffledQuestions.length).fill(null); // Reset user answers for new shuffled test

            showSection('quizSection');
            populateQuestionPalette();
            displayQuestion();
            startTimer();
            showToast('success', 'Test Started!', 'Good luck with your mock test.');
        } else {
            showToast('error', 'Input Error', 'Please correct the highlighted fields.');
        }
    });

    prevBtn.addEventListener('click', () => {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            displayQuestion();
            updatePaletteSelection();
        }
    });

    nextBtn.addEventListener('click', () => {
        if (currentQuestionIndex < shuffledQuestions.length - 1) {
            currentQuestionIndex++;
            displayQuestion();
            updatePaletteSelection();
        } else {
            showConfirmationModal(); // Show confirmation modal before submitting
        }
    });

    // Modal button event listeners
    cancelSubmissionBtn.addEventListener('click', hideConfirmationModal);
    confirmSubmissionBtn.addEventListener('click', () => {
        hideConfirmationModal();
        submitTest();
        showToast('info', 'Test Submitted', 'Your test results are ready.');
    });


    restartBtn.addEventListener('click', () => {
        // Reset all state variables
        currentQuestionIndex = 0;
        userAnswers = Array(originalQuestions.length).fill(null); // Reset for original length
        shuffledQuestions = []; // Clear shuffled questions
        shuffledOptionsMap.clear(); // Clear shuffled options
        timeRemaining = totalTestDuration;
        clearInterval(timerInterval); // Clear any running timer
        timerDisplay.textContent = formatTime(totalTestDuration); // Reset timer display
        testPasswordInput.value = '';
        sscObtainedInput.value = '';
        sscTotalInput.value = '';
        fscObtainedInput.value = '';
        fscTotalInput.value = '';
        passwordError.classList.add('hidden');
        sscError.classList.add('hidden');
        fscError.classList.add('hidden');
        currentReviewQuestionIndex = 0; // Reset for review section

        showSection('passwordSection');
        showToast('info', 'Test Restarted', 'Please enter password and marks to start again.');
    });

    reviewBtn.addEventListener('click', () => {
        currentReviewQuestionIndex = 0; // Start review from the first question
        showSection('reviewSection');
        displayReviewQuestion();
    });

    reviewPrevBtn.addEventListener('click', () => {
        if (currentReviewQuestionIndex > 0) {
            currentReviewQuestionIndex--;
            displayReviewQuestion();
        }
    });

    reviewNextBtn.addEventListener('click', () => {
        if (currentReviewQuestionIndex < shuffledQuestions.length - 1) {
            currentReviewQuestionIndex++;
            displayReviewQuestion();
        }
    });

    backToResultsBtn.addEventListener('click', () => {
        showSection('resultSection');
    });

    savePdfBtn.addEventListener('click', () => {
        window.print();
    });

    themeToggleBtn.addEventListener('click', toggleTheme);

    fullscreenToggleBtn.addEventListener('click', toggleFullscreen);


    // Initial checks on page load
    checkTheme();
    showSection('passwordSection'); // Show password section by default
});
</script>

</body>
</html>
